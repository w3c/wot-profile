<!DOCTYPE html>
<html lang="en-US">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0">
<meta charset="utf-8">
<meta name="generator" content="ReSpec 32.5.0">
<meta name="viewport" content=
"width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
:is(aside,div).example{border-left-width:.5em;border-left-style:solid;border-color:#e0cb52;background:#fcfaee}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
.example pre{background-color:rgba(0,0,0,.03)}
</style>

<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-width:.2em;border-style:solid;background:#fbe9e9}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>

<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
<link rel="stylesheet" href="testing/atrisk.css">
<title>Web of Things (WoT) Profile</title>

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>

<style>

    .rfc2119-assertion {
      background-color: rgb(230, 230, 230)
    }
  
</style>
<meta name="description" content=
"The WoT Profile Specification defines a Profiling Mechanism and an HTTP Basic Profile, which enables out of the box interoperability among things and devices. Out of the box interoperability implies, that devices can be integrated into various application scenarios without deep level adaptations. Typically only minor configuration operations are necessary (such as entering a network key, or IP address) to use the device in a certain scenario. These actions can be done by anyone without specific training.">
<link rel="canonical" href="https://www.w3.org/TR/wot-profile/">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>

<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>

<script id="initialUserConfig" type="application/json">
{
  "lint": {
    "no-headingless-sections": false
  },
  "specStatus": "WD",
  "maxTocLevel": 6,
  "processVersion": 2019,
  "shortName": "wot-profile",
  "copyrightStart": 2020,
  "group": "wg/wot",
  "wgPublicList": "public-wot-wg",
  "edDraftURI": "https://w3c.github.io/wot-profile/",
  "githubAPI": "https://api.github.com/repos/w3c/wot-profile",
  "issueBase": "https://www.github.com/w3c/wot-profile/issues",
  "previousPublishDate": "2020-11-24",
  "previousMaturity": "FPWD",
  "editors": [
    {
      "name": "Michael Lagally",
      "w3cid": "47166",
      "company": "Oracle Corp.",
      "companyURL": "https://www.oracle.com/"
    },
    {
      "name": "Ben Francis",
      "w3cid": "51527",
      "company": "Invited Expert"
    },
    {
      "name": "Michael McCool",
      "w3cid": "93137",
      "company": "Intel Corp.",
      "companyURL": "https://www.intel.com/"
    },
    {
      "name": "Ryuichi Matsukura",
      "w3cid": "64284",
      "company": "Fujitsu Ltd.",
      "companyURL": "https://www.fujitsu.com/"
    },
    {
      "name": "Sebastian Kaebisch",
      "w3cid": "43064",
      "company": "Siemens AG",
      "companyURL": "https://www.siemens.com/"
    },
    {
      "name": "Tomoaki Mizushima",
      "w3cid": "98915",
      "company": "Internet Research Institute, Inc.",
      "companyURL": "https://www.iri.co.jp/"
    }
  ],
  "otherLinks": [
    {
      "key": "Contributors",
      "data": [
        {
          "value": "In the GitHub repository",
          "href": "https://github.com/w3c/wot-profile/graphs/contributors"
        }
      ]
    },
    {
      "key": "Repository",
      "data": [
        {
          "value": "We are on GitHub",
          "href": "https://github.com/w3c/wot-profile/"
        },
        {
          "value": "File a bug",
          "href": "https://github.com/w3c/wot-profile/issues"
        },
        {
          "value": "Contribute",
          "href": "https://github.com/w3c/wot-profile/pulls"
        }
      ]
    }
  ],
  "localBiblio": {
    "JSON-SCHEMA": {
      "title": "JSON Schema Validation: A Vocabulary for Structural Validation of JSON",
      "href": "https://tools.ietf.org/html/draft-handrews-json-schema-validation-01",
      "authors": [
        "Austin Wright",
        "Henry Andrews",
        "Geraint Luff"
      ],
      "status": "Internet-Draft",
      "date": "19 March 2018",
      "publisher": "IETF"
    },
    "ISO-6709": {
      "title": "ISO-6709:2008 : Standard representation of geographic point location by coordinates",
      "href": "https://www.iso.org/standard/39242.html",
      "status": "Published",
      "date": "2008-07",
      "publisher": "ISO"
    },
    "H2020-CREATE-IoT": {
      "title": "H2020 – CREATE-IoT Project - Recommendations for commonalities and interoperability profiles of IoT platforms",
      "href": "https://european-iot-pilots.eu/wp-content/uploads/2018/11/D06_02_WP06_H2020_CREATE-IoT_Final.pdf",
      "status": "Published",
      "date": "2018-11",
      "publisher": "IoT European Large-Scale Pilots Programme",
      "id": "h2020-create-iot"
    }
  },
  "publishISODate": "2022-12-09T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 09 December 2022"
}
</script>
<link rel="stylesheet" href=
"https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>
<body class="h-entry">
<div class="head">
<p class="logos"><a class="logo" href=
"https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width=
"72"></a></p>
<h1 id="title" class="title">Web of Things (WoT) Profile</h1>
<p id="w3c-state"><a href=
"https://www.w3.org/standards/types#WD">W3C Working Draft</a>
<time class="dt-published" datetime="2022-12-09">09 December
2022</time></p>
<details open="">
<summary>More details about this document</summary>
<dl>
<dt>This version:</dt>
<dd><a class="u-url" href=
"https://www.w3.org/TR/2022/WD-wot-profile-20221209/">https://www.w3.org/TR/2022/WD-wot-profile-20221209/</a></dd>
<dt>Latest published version:</dt>
<dd><a href=
"https://www.w3.org/TR/wot-profile/">https://www.w3.org/TR/wot-profile/</a></dd>
<dt>Latest editor's draft:</dt>
<dd><a href=
"https://w3c.github.io/wot-profile/">https://w3c.github.io/wot-profile/</a></dd>
<dt>History:</dt>
<dd><a href=
"https://www.w3.org/standards/history/wot-profile">https://www.w3.org/standards/history/wot-profile</a></dd>
<dt>Editors:</dt>
<dd class="editor p-author h-card vcard" data-editor-id="47166">
<span class="p-name fn">Michael Lagally</span> (<a class=
"p-org org h-org" href="https://www.oracle.com/">Oracle
Corp.</a>)</dd>
<dd class="editor p-author h-card vcard" data-editor-id="51527">
<span class="p-name fn">Ben Francis</span> (<span class=
"p-org org h-org">Invited Expert</span>)</dd>
<dd class="editor p-author h-card vcard" data-editor-id="93137">
<span class="p-name fn">Michael McCool</span> (<a class=
"p-org org h-org" href="https://www.intel.com/">Intel
Corp.</a>)</dd>
<dd class="editor p-author h-card vcard" data-editor-id="64284">
<span class="p-name fn">Ryuichi Matsukura</span> (<a class=
"p-org org h-org" href="https://www.fujitsu.com/">Fujitsu
Ltd.</a>)</dd>
<dd class="editor p-author h-card vcard" data-editor-id="43064">
<span class="p-name fn">Sebastian Kaebisch</span> (<a class=
"p-org org h-org" href="https://www.siemens.com/">Siemens
AG</a>)</dd>
<dd class="editor p-author h-card vcard" data-editor-id="98915">
<span class="p-name fn">Tomoaki Mizushima</span> (<a class=
"p-org org h-org" href="https://www.iri.co.jp/">Internet Research
Institute, Inc.</a>)</dd>
<dt>Feedback:</dt>
<dd><a href=
"mailto:public-wot-wg@w3.org?subject=%5Bwot-profile%5D%20YOUR%20TOPIC%20HERE">
public-wot-wg@w3.org</a> with subject line <kbd>[wot-profile] <em>…
message topic …</em></kbd> (<a rel="discussion" href=
"https://lists.w3.org/Archives/Public/public-wot-wg">archives</a>)</dd>
<dt>Contributors</dt>
<dd><a href=
"https://github.com/w3c/wot-profile/graphs/contributors">In the
GitHub repository</a></dd>
<dt>Repository</dt>
<dd><a href="https://github.com/w3c/wot-profile/">We are on
GitHub</a></dd>
<dd><a href="https://github.com/w3c/wot-profile/issues">File a
bug</a></dd>
<dd><a href=
"https://github.com/w3c/wot-profile/pulls">Contribute</a></dd>
</dl>
</details>
<p class="copyright"><a href=
"https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
© 2020-2022 <a href="https://www.w3.org/"><abbr title=
"World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href=
"https://www.csail.mit.edu/"><abbr title=
"Massachusetts Institute of Technology">MIT</abbr></a>, <a href=
"https://www.ercim.eu/"><abbr title=
"European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
<a href="https://www.keio.ac.jp/">Keio</a>, <a href=
"https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href=
"https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
<a href=
"https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
and <a rel="license" href=
"https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document"
title="W3C Software and Document Notice and License">permissive
document license</a> rules apply.</p>
<hr title="Separator for header"></div>
<section id="abstract" class="introductory">
<h2>Abstract</h2>
<p>The <em>WoT Profile Specification</em> defines a Profiling
Mechanism and an <em>HTTP Basic Profile</em>, which enables <em>out
of the box interoperability</em> among things and devices. <em>Out
of the box interoperability</em> implies, that devices can be
integrated into various application scenarios without deep level
adaptations. Typically only minor configuration operations are
necessary (such as entering a network key, or IP address) to use
the device in a certain scenario. These actions can be done by
anyone without specific training.</p>
The HTTP Basic Profile defines a set of <em>constraints and
rules</em>, which compliant thing descriptions have to adopt to
guarantee interoperability.
<p></p>
<p>These rules are prescriptive, to ensure that compliant
implementations satisfy the semantic guarantees implied by them. We
call this set of rules a <em>Profile</em>.</p>
<p>The <strong>WoT Profile Specification</strong> as defined in
this document serves two purposes:</p>
<ul>
<li>It defines a generic <strong><a href=
"#profiling-mechanism">Profiling Mechanism</a></strong> which
provides a mechanism to describe a profile in an unambiguous way.
This mechanism can be used to define additional profiles.</li>
<li>In addition, it defines a <strong><a href=
"#http-basic-profile">HTTP Basic Profile</a></strong> of the Thing
Description, which contains protocol binding rules for HTTP.
<p>The <em>normative</em> HTTP Basic Profile is complemented by two
<em>informative profiles for events</em>: The <a href=
"#sec-http-sse-profile">HTTP SSE Profile</a> and the <a href=
"#sec-http-webhook-profile">HTTP Webhook Profile</a>.</p>
<p>In the current version of this document these event bindings are
provided in <em>informative</em> sections, to illustrate how these
event mechanisms could be supported in other profiles.</p>
<p>It is planned that future versions of this document
<em>normatively</em> define these event mechanisms.</p>
<p>This specification defines a set of normative constraints that
apply to <em>all</em> profiles defined by this document.</p>
<p></p>
<p><span class="rfc2119-assertion" id="profile-abstract-1">A TD
that is compliant to the HTTP Basic Profile <em class=
"rfc2119">MUST</em> adhere to both the common constraints and the
protocol binding.</span></p>
</li>
</ul>
<p>Devices that constrain their use of the Thing Description to the
HTTP Basic Profile can interoperate with each other
out-of-the-box.</p>
<p>Note that the HTTP Basic Profile is not exclusive. Device
implementers are free to adopt other features of the Thing
Description that go beyond the constraints of the HTTP Basic
Profile, however the interoperability guarantees of the HTTP Basic
Profile hold only for the HTTP Basic Profile subset.</p>
<p>Future versions of this document may contain other profiles,
e.g. a profile for digital twins and a profile for resource
constrained devices.</p>
<section id="motivation-for-a-profile">
<div class="header-wrapper">
<h3 id="motivation-for-a-profile-0">Motivation for a Profile</h3>
<a class="self-link" href="#motivation-for-a-profile" aria-label=
"Permalink for this Section"></a></div>
</section>
<p></p>
<p id="profile-abstract-2">The <abbr title=
"World Wide Web Consortium">W3C</abbr> WoT Thing Architecture
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-architecture11" title=
"Web of Things (WoT) Architecture 1.1">wot-architecture11</a></cite>]
and WoT Thing Description [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>]
define a powerful description mechanism and a format to describe
myriads of very different devices, which may be connected over
various protocols. The format is very flexible and open and puts
very few normative requirements on devices that implement it.</p>
<p>However, this flexibility de-facto prevents interoperability,
since, without additional <strong>rules</strong>, it allows
implementers to make many choices that do not provide
<strong>guarantees</strong> of common behavior between
implementations.</p>
</section>
<section id="sotd" class="introductory">
<h2>Status of This Document</h2>
<p><em>This section describes the status of this document at the
time of its publication. A list of current <abbr title=
"World Wide Web Consortium">W3C</abbr> publications and the latest
revision of this technical report can be found in the <a href=
"https://www.w3.org/TR/"><abbr title=
"World Wide Web Consortium">W3C</abbr> technical reports index</a>
at https://www.w3.org/TR/.</em></p>
<p>This document was published by the <a href=
"https://www.w3.org/groups/wg/wot">Web of Things Working Group</a>
as a Working Draft using the <a href=
"https://www.w3.org/2021/Process-20211102/#recs-and-notes">Recommendation
track</a>.</p>
<p>Publication as a Working Draft does not imply endorsement by
<abbr title="World Wide Web Consortium">W3C</abbr> and its
Members.</p>
<p>This is a draft document and may be updated, replaced or
obsoleted by other documents at any time. It is inappropriate to
cite this document as other than work in progress.</p>
<p>This document was produced by a group operating under the
<a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title=
"World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
<abbr title="World Wide Web Consortium">W3C</abbr> maintains a
<a rel="disclosure" href=
"https://www.w3.org/groups/wg/wot/ipr">public list of any patent
disclosures</a> made in connection with the deliverables of the
group; that page also includes instructions for disclosing a
patent. An individual who has actual knowledge of a patent which
the individual believes contains <a href=
"https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential
Claim(s)</a> must disclose the information in accordance with
<a href=
"https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section
6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent
Policy</a>.</p>
<p>This document is governed by the <a id="w3c_process_revision"
href="https://www.w3.org/2021/Process-20211102/">2 November 2021
<abbr title="World Wide Web Consortium">W3C</abbr> Process
Document</a>.</p>
</section>
<nav id="toc">
<h2 class="introductory" id="table-of-contents">Table of
Contents</h2>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#abstract">Abstract</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#motivation-for-a-profile">Motivation for a Profile</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href="#sotd">Status of This
Document</a></li>
<li class="tocline"><a class="tocxref" href=
"#introduction"><bdi class="secno">1.</bdi> Introduction</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#deployment-scenarios"><bdi class="secno">1.1</bdi> Deployment
Scenarios</a></li>
<li class="tocline"><a class="tocxref" href=
"#profile-use-cases"><bdi class="secno">1.2</bdi> Summary of Use
Cases and Requirements</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#profile-use-case-MVSE"><bdi class="secno">1.2.1</bdi>
Multi-Vendor System Integration - Out of the box
interoperability</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#why-define-a-profile"><bdi class="secno">1.3</bdi> Why a
<span class="formerLink" data-link-type=
"dfn">Profile</span>?</a></li>
<li class="tocline"><a class="tocxref" href=
"#out-of-the-box-interoperability"><bdi class="secno">1.4</bdi>
Out-of-the-box interoperability</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#out-of-the-box-interoperability-technical-interop"><bdi class=
"secno">1.4.1</bdi> Technical Interoperability</a></li>
<li class="tocline"><a class="tocxref" href=
"#out-of-the-box-interoperability-syntactic-interop"><bdi class=
"secno">1.4.2</bdi> Syntactic Interoperability</a></li>
<li class="tocline"><a class="tocxref" href=
"#out-of-the-box-interoperability-semantic-interop"><bdi class=
"secno">1.4.3</bdi> Semantic Interoperability</a></li>
<li class="tocline"><a class="tocxref" href=
"#out-of-the-box-interoperability-organisational-interop"><bdi class="secno">
1.4.4</bdi> Organisational Interoperability</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#structure-of-this-document"><bdi class="secno">1.5</bdi>
Structure of this document</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#conformance"><bdi class="secno">2.</bdi> Conformance</a></li>
<li class="tocline"><a class="tocxref" href=
"#x3-terminology"><bdi class="secno">3.</bdi> Terminology</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#additional-definitions-"><bdi class="secno">3.1</bdi> Additional
Definitions</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#requirements"><bdi class="secno">4.</bdi> Profile
Requirements</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#interoperability"><bdi class="secno">4.1</bdi>
Interoperability</a></li>
<li class="tocline"><a class="tocxref" href=
"#limit-and-reduce-complexity"><bdi class="secno">4.2</bdi> Limit
and reduce complexity</a></li>
<li class="tocline"><a class="tocxref" href=
"#no-ambiguities-select-single-choice"><bdi class="secno">4.3</bdi>
No Ambiguities, select single choice</a></li>
<li class="tocline"><a class="tocxref" href=
"#developer-guidance"><bdi class="secno">4.4</bdi> Developer
guidance</a></li>
<li class="tocline"><a class="tocxref" href=
"#multiple-profiles-mechanism"><bdi class="secno">4.5</bdi>
Multiple profiles (mechanism)</a></li>
<li class="tocline"><a class="tocxref" href=
"#composable-profiles"><bdi class="secno">4.6</bdi> Composable
profiles</a></li>
<li class="tocline"><a class="tocxref" href=
"#validatible-tds"><bdi class="secno">4.7</bdi> Validatible
TDs</a></li>
<li class="tocline"><a class="tocxref" href=
"#identification-of-profiles"><bdi class="secno">4.8</bdi>
Identification of profiles</a></li>
<li class="tocline"><a class="tocxref" href=
"#finite-set-of-features-and-capabilities"><bdi class=
"secno">4.9</bdi> Finite set of features and capabilities</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#profiling-mechanism"><bdi class="secno">5.</bdi> Profiling
Mechanism</a></li>
<li class="tocline"><a class="tocxref" href=
"#common-constraints"><bdi class="secno">6.</bdi> Common
Constraints</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#accessibility"><bdi class="secno">6.1</bdi>
Accessibility</a></li>
<li class="tocline"><a class="tocxref" href="#units"><bdi class=
"secno">6.2</bdi> Units</a></li>
<li class="tocline"><a class="tocxref" href=
"#date-format"><bdi class="secno">6.3</bdi> Date Format</a></li>
<li class="tocline"><a class="tocxref" href=
"#common-constraints-security"><bdi class="secno">6.4</bdi>
Security</a></li>
<li class="tocline"><a class="tocxref" href=
"#common-constraints-discovery"><bdi class="secno">6.5</bdi>
Discovery</a></li>
<li class="tocline"><a class="tocxref" href=
"#common-constraints-links"><bdi class="secno">6.6</bdi> Links</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#sec-link-relation-types"><bdi class="secno">6.6.1</bdi> Link
Relation Types</a></li>
<li class="tocline"><a class="tocxref" href=
"#sec-link-media-types"><bdi class="secno">6.6.2</bdi> Media Types
for Link Targets</a></li>
</ol>
</li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#error-responses"><bdi class="secno">7.</bdi> Errors</a></li>
<li class="tocline"><a class="tocxref" href=
"#sec-default-language"><bdi class="secno">8.</bdi> Default
Language</a></li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile"><bdi class="secno">9.</bdi> HTTP Basic
Profile</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-identifier"><bdi class="secno">9.1</bdi>
Identifier</a></li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding"><bdi class="secno">9.2</bdi>
Protocol Binding</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-properties"><bdi class=
"secno">9.2.1</bdi> Properties</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-readproperty"><bdi class=
"secno">9.2.1.1</bdi> <code>readproperty</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-writeproperty"><bdi class=
"secno">9.2.1.2</bdi> <code>writeproperty</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-readallproperties"><bdi class="secno">
9.2.1.3</bdi> <code>readallproperties</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-writemultipleproperties"><bdi class="secno">
9.2.1.4</bdi> <code>writemultipleproperties</code></a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-actions"><bdi class=
"secno">9.2.2</bdi> Actions</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-invokeaction"><bdi class=
"secno">9.2.2.1</bdi> <code>invokeaction</code></a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#ActionStatus"><bdi class="secno">9.2.2.1.1</bdi>
<code>ActionStatus</code> object</a></li>
<li class="tocline"><a class="tocxref" href=
"#sync-action-response"><bdi class="secno">9.2.2.1.2</bdi>
Synchronous Action Response</a></li>
<li class="tocline"><a class="tocxref" href=
"#async-action-response"><bdi class="secno">9.2.2.1.3</bdi>
Asynchronous Action Response</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-queryaction"><bdi class=
"secno">9.2.2.2</bdi> <code>queryaction</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-basic-profile-protocol-binding-cancelaction"><bdi class=
"secno">9.2.2.3</bdi> <code>cancelaction</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#queryallactions"><bdi class="secno">9.2.2.4</bdi>
<code>queryallactions</code></a></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#sec-http-sse-profile"><bdi class="secno">10.</bdi> HTTP SSE
Profile</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-identifier"><bdi class="secno">10.1</bdi>
Identifier</a></li>
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding"><bdi class="secno">10.2</bdi>
Protocol Binding</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding-properties"><bdi class=
"secno">10.2.1</bdi> Properties</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#observeproperty"><bdi class="secno">10.2.1.1</bdi>
<code>observeproperty</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#unobserveproperty"><bdi class="secno">10.2.1.2</bdi>
<code>unobserveproperty</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#observeallproperties"><bdi class="secno">10.2.1.3</bdi>
<code>observeallproperties</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#unobserveallproperties"><bdi class="secno">10.2.1.4</bdi>
<code>unobserveallproperties</code></a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding-events"><bdi class=
"secno">10.2.2</bdi> Events</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding-subscribeevent"><bdi class=
"secno">10.2.2.1</bdi> <code>subscribeevent</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding-events-unsubscribeevent"><bdi class="secno">
10.2.2.2</bdi> <code>unsubscribeevent</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding-events-subscribeallevents"><bdi class="secno">
10.2.2.3</bdi> <code>subscribeallevents</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-sse-profile-protocol-binding-events-unsubscribeallevents"><bdi class="secno">
10.2.2.4</bdi> <code>unsubscribeallevents</code></a></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#sec-http-webhook-profile"><bdi class="secno">11.</bdi> HTTP
Webhook Profile</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#sec-http-webhook-profile-intro"><bdi class="secno">11.1</bdi>
Introduction</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#webhook-example"><bdi class="secno">11.1.1</bdi> Webhook
Example</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-identifier"><bdi class="secno">11.2</bdi>
Identifier</a></li>
<li class="tocline"><a class="tocxref" href=
"#sec-http-webhook-profile-message-format"><bdi class=
"secno">11.3</bdi> Message Format</a></li>
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-protocol-binding"><bdi class=
"secno">11.4</bdi> Protocol Binding</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-protocol-binding-events"><bdi class=
"secno">11.4.1</bdi> Operations</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-protocol-binding-subscribeevent"><bdi class=
"secno">11.4.1.1</bdi> <code>subscribeevent</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-protocol-binding-events-unsubscribeevent"><bdi class="secno">
11.4.1.2</bdi> <code>unsubscribeevent</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-protocol-binding-events-subscribeallevents"><bdi class="secno">
11.4.1.3</bdi> <code>subscribeallevents</code></a></li>
<li class="tocline"><a class="tocxref" href=
"#http-webhook-profile-protocol-binding-events-unsubscribeallevents">
<bdi class="secno">11.4.1.4</bdi>
<code>unsubscribeallevents</code></a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#sec-http-webhook-profile-protocol-binding-event-listeners"><bdi class="secno">
11.4.2</bdi> Event Connections</a></li>
</ol>
</li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#privacy-considerations"><bdi class="secno">12.</bdi> Privacy
Considerations</a></li>
<li class="tocline"><a class="tocxref" href=
"#security-considerations"><bdi class="secno">13.</bdi> Security
Considerations</a></li>
<li class="tocline"><a class="tocxref" href="#changes"><bdi class=
"secno">A.</bdi> Recent Specification Changes</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#changes-from-fpwd"><bdi class="secno">A.1</bdi> Changes from the
FPWD published 24 November 2020</a></li>
</ol>
</li>
<li class="tocline"><a class="tocxref" href=
"#references"><bdi class="secno">B.</bdi> References</a>
<ol class="toc">
<li class="tocline"><a class="tocxref" href=
"#normative-references"><bdi class="secno">B.1</bdi> Normative
references</a></li>
<li class="tocline"><a class="tocxref" href=
"#informative-references"><bdi class="secno">B.2</bdi> Informative
references</a></li>
</ol>
</li>
</ol>
</nav>
<section id="intro">
<div class="header-wrapper">
<h2 id="introduction"><bdi class="secno">1.</bdi> Introduction</h2>
<a class="self-link" href="#introduction" aria-label=
"Permalink for Section 1."></a></div>
<p>The <abbr title="World Wide Web Consortium">W3C</abbr> WoT
Architecture [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-architecture11" title=
"Web of Things (WoT) Architecture 1.1">wot-architecture11</a></cite>]
and the WoT Thing Description [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>]
have been developed as a versatile format, that allows describing
the interactions between multiple devices and protocols.</p>
<p>This flexibility permits an easy integration of new device types
and protocols, however it risks interoperability, since there are
<em>no guarantees</em> that two devices which are formally
spec-compliant, will be able to communicate.</p>
<p>To increase adoption of the WoT specifications, interoperability
between on premise devices, edge devices and the cloud is
essential. Even if every manufacturer is implementing the current
Thing Description specification in full flexibility, there is no
interoperability guarantee; many choices are still left to the
implementations and there are very few normative requirements that
a device has to fulfill.</p>
<section id="deployment-scenarios">
<div class="header-wrapper">
<h3 id="x1-1-deployment-scenarios"><bdi class="secno">1.1</bdi>
Deployment Scenarios</h3>
<a class="self-link" href="#deployment-scenarios" aria-label=
"Permalink for Section 1.1"></a></div>
<p>A Thing Description can be used in two fundamentally different
deployment scenarios:</p>
<ul>
<li>a "brown-field" scenario, where it is created to describe the
interactions with existing systems.</li>
<li>a "green-field" scenario, where a device model and a thing
description are developed together.</li>
</ul>
<p>For green field deployments, where the implementations are being
carried out and corresponding thing descriptions are being created,
it is easier to achieve full interoperability by using a small,
extensible <a href="#http-basic-profile">HTTP Basic
Profile</a>.</p>
<p>In the brown field area, due to the nature of existing
deployments and protocols, a broad spectrum of variations and
potentially high complexity of thing descriptions inhibits
interoperability and will most likely lead to additional profiles
of the <a href="#dfn-wot-thing-description" class="internalDFN"
data-link-type="dfn" id="ref-for-dfn-wot-thing-description-1">WoT
Thing Description</a> and domain-specific thing consumer
implementations.</p>
<p>The WoT HTTP Basic Profile can be used by green field
deployments and gives guidance to new implementers of the WoT
specifications.</p>
</section>
<section id="profile-use-cases">
<div class="header-wrapper">
<h3 id="x1-2-summary-of-use-cases-and-requirements"><bdi class=
"secno">1.2</bdi> Summary of Use Cases and Requirements</h3>
<a class="self-link" href="#profile-use-cases" aria-label=
"Permalink for Section 1.2"></a></div>
<p>A set of over 30 use cases for the Web of Things were
contributed by stakeholders from multiple industries for various
application domains. These have been published in the WoT Use Cases
and Requirements document [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-wot-usecases" title=
"Web of Things (WoT): Use Cases and Requirements">wot-usecases</a></cite>].</p>
<p>Based on these use cases a set of requirements have been derived
which drive the development of the <abbr title=
"World Wide Web Consortium">W3C</abbr> Web of Things specification
family. Several of these domains require easy integration of
devices from multiple vendors, in other words, out-of-the-box
interoperability. However, the descriptive approach taken by the
WoT specifications generally leads to a large variety of different
protocols and data formats, which can work against out-of-the box
interoperability.</p>
<p>For example, a WoT Thing Description (TD) can in theory include
a description based on a networking protocol unknown to a device
that wishes to connect to it. To ensure interoperability without
additional customization (e.g. by writing software or performing
complex setup or configuration steps), the range of such choices
needs to be limited to a finite set so that a consumer of a Thing
Description can be sure it will be able to interact with any
possible Thing. A finite set of customization choices is also
important for implementing devices with a fixed code base. Defining
such constraints leads to the profile mechanism and the HTTP Basic
Profile.</p>
<p>In addition to multiple vertical use cases that will use HTTP(S)
for their implementations, there are horizontal use cases that are
addressed by this profile specification. The primary focus is to
enable Multi-Vendor system integration with out of the box
interoperability.</p>
<section id="profile-use-case-MVSE">
<div class="header-wrapper">
<h4 id=
"x1-2-1-multi-vendor-system-integration-out-of-the-box-interoperability">
<bdi class="secno">1.2.1</bdi> Multi-Vendor System Integration -
Out of the box interoperability</h4>
<a class="self-link" href="#profile-use-case-MVSE" aria-label=
"Permalink for Section 1.2.1"></a></div>
Users of devices want to process data from all devices that conform
to a class of devices in a uniform way. They need a guarantee that
they are able to correctly interact with all affordances of the
Thing that complies with this class of devices. Different
interpretations of the same Thing Description, that lead to
different behaviour, should not be possible. Users want to
integrate devices in existing scenarios out of the box, i.e. with
close to zero configuration tasks.</section>
</section>
<section id="why-profile">
<div class="header-wrapper">
<h3 id="why-define-a-profile"><bdi class="secno">1.3</bdi> Why a
<a href="#dfn-profile" class="internalDFN" data-link-type="dfn" id=
"ref-for-dfn-profile-1">Profile</a>?</h3>
<a class="self-link" href="#why-define-a-profile" aria-label=
"Permalink for Section 1.3"></a></div>
<p>During the recent WoT Plugfests there were many de-facto
agreements on the use of a small constrained subset of interaction
patterns and protocol choices. These de-facto agreements select a
common subset of the <a href="#dfn-wot-thing-description" class=
"internalDFN" data-link-type="dfn" id=
"ref-for-dfn-wot-thing-description-2">WoT Thing Description</a>,
based on proven interoperability among manufacturers.</p>
<p><span class="rfc2119-assertion" id=
"profile-why-a-basic-profile-1-x">The <a href=
"#http-basic-profile">HTTP Basic Profile</a> contains additional
normative requirements that <em class="rfc2119">MUST</em> be
satisfied by devices to be compliant to the profile.</span></p>
<figure id="http-basic-Profile-figure"><img src=
"images/WoT-HTTP-Baseline-Profile.png" class="wot-profiles" alt=
"http-baseline-Profile-Picture" height="261" width="801">
<figcaption>Figure <bdi class="figno">1</bdi> <span class=
"fig-title">WoT HTTP Basic Profile - A Subset of
Affordances</span></figcaption>
</figure>
<p>Adoption of the <a href="#http-basic-profile">HTTP Basic
Profile</a> will significantly limit the implementation burden of
device and cloud implementors.</p>
<p>The HTTP Basic Profile was defined with the following main
goals:</p>
<ul>
<li>guarantee interoperability among all implementations of the
profile.</li>
<li>limit the implementation complexity.</li>
</ul>
<p>It makes choices on the required metadata fields as well as the
supported interactions and protocol endpoints. It introduces some
constraints on data schemas for properties and actions which are
required for resource constrained devices in real-world
deployments. The format does not forbid the use of additional
elements of the <a href="#dfn-wot-thing-description" class=
"internalDFN" data-link-type="dfn" id=
"ref-for-dfn-wot-thing-description-3">WoT Thing Description</a> for
vendor specific extensions, however this will impact
interoperability.</p>
</section>
<section id="out-of-the-box-interoperability-0">
<div class="header-wrapper">
<h3 id="out-of-the-box-interoperability"><bdi class=
"secno">1.4</bdi> Out-of-the-box interoperability</h3>
<a class="self-link" href="#out-of-the-box-interoperability"
aria-label="Permalink for Section 1.4"></a></div>
<p>Devices, which implement the <a href="#http-basic-profile">HTTP
Basic Profile</a>, are <strong>out-of-the-box
interoperable</strong> with other HTTP Basic Profile compliant
devices. Furthermore, the HTTP Basic Profile simplifies device
validation and compliance testing since a corresponding conformance
test suite can be defined.</p>
<p>The following classification adopts the terminology as described
in the "H2020 – CREATE-IoT Project - Recommendations for
commonalities and interoperability profiles of IoT platforms"
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-h2020-create-iot" title=
"H2020 – CREATE-IoT Project - Recommendations for commonalities and interoperability profiles of IoT platforms">H2020-CREATE-IoT</a></cite>]
report. The definitions below have been adapted to reflect the
scope of the WoT profile.</p>
<section id="technical-interoperability">
<div class="header-wrapper">
<h4 id="out-of-the-box-interoperability-technical-interop">
<bdi class="secno">1.4.1</bdi> Technical Interoperability</h4>
<a class="self-link" href=
"#out-of-the-box-interoperability-technical-interop" aria-label=
"Permalink for Section 1.4.1"></a></div>
<p><em>Technical Interoperability</em> is usually associated with
communication protocols and the infrastructure needed for those
protocols to operate. This implies agreeing on a common protocol
(e.g. HTTP / TCP/IP) and providing additional clarifications, where
required.</p>
</section>
<section id="syntactic-interoperability">
<div class="header-wrapper">
<h4 id="out-of-the-box-interoperability-syntactic-interop">
<bdi class="secno">1.4.2</bdi> Syntactic Interoperability</h4>
<a class="self-link" href=
"#out-of-the-box-interoperability-syntactic-interop" aria-label=
"Permalink for Section 1.4.2"></a></div>
<p><em>Syntactic Interoperability</em> is usually associated with
data formats and encodings along with techniques for compressing
them. Examples for these formats and encodings in the WoT are JSON,
XML, JSON-LD, UTF-8 payloads.</p>
</section>
<section id="semantic-interoperability">
<div class="header-wrapper">
<h4 id="out-of-the-box-interoperability-semantic-interop">
<bdi class="secno">1.4.3</bdi> Semantic Interoperability</h4>
<a class="self-link" href=
"#out-of-the-box-interoperability-semantic-interop" aria-label=
"Permalink for Section 1.4.3"></a></div>
<p><em>Semantic Interoperability</em> is associated with a common
understanding of the behavior of communication partners. In the
profile context, it includes a common interpretation of
(synchronous and asynchronous) action semantics, a common event
model, how to set/get multiple properties, writable properties, a
common error model and error messages.</p>
<p>Domain specific ontologies, e.g. semantic interop of automotive
and medical devices exceed the scope of the profile.</p>
</section>
<section id="organisational-interoperability">
<div class="header-wrapper">
<h4 id="out-of-the-box-interoperability-organisational-interop">
<bdi class="secno">1.4.4</bdi> Organisational Interoperability</h4>
<a class="self-link" href=
"#out-of-the-box-interoperability-organisational-interop"
aria-label="Permalink for Section 1.4.4"></a></div>
<p><em>Organisational Interoperability</em> in the profile context
implies that any consumer, which conforms with a given profile can
interact with any Thing which conforms with the same profile,
without additional customization.</p>
<p>Organisational Interoperability also requires commonly agreed
approaches to security, trust and privacy, i.e. a consumer is
provided access to Things only, when these common terms and
conditions are applied.</p>
<p>Devices created by various engineers, vendors and SDOs that
satisfy the requirements of the profile specification can be
integrated with compliant consumers without additional
customization. This works across infrastructures, regions and
cultures.</p>
</section>
</section>
<section id="structure-of-this-document">
<div class="header-wrapper">
<h3 id="x1-5-structure-of-this-document"><bdi class=
"secno">1.5</bdi> Structure of this document</h3>
<a class="self-link" href="#structure-of-this-document" aria-label=
"Permalink for Section 1.5"></a></div>
<div class="note" id="issue-container-generatedID">
<div role="heading" class="ednote-title marker" id="h-ednote"
aria-level="4"><span>Editor's note</span></div>
<section class="">to be added.</section>
</div>
</section>
</section>
<section id="conformance">
<div class="header-wrapper">
<h2 id="x2-conformance"><bdi class="secno">2.</bdi>
Conformance</h2>
<a class="self-link" href="#conformance" aria-label=
"Permalink for Section 2."></a></div>
<p>As well as sections marked as non-normative, all authoring
guidelines, diagrams, examples, and notes in this specification are
non-normative. Everything else in this specification is
normative.</p>
<p>The key words <em class="rfc2119">MAY</em>, <em class=
"rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class=
"rfc2119">OPTIONAL</em>, <em class="rfc2119">RECOMMENDED</em>,
<em class="rfc2119">REQUIRED</em>, <em class="rfc2119">SHOULD</em>,
and <em class="rfc2119">SHOULD NOT</em> in this document are to be
interpreted as described in <a href=
"https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc2119" title=
"Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>]
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc8174" title=
"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
when, and only when, they appear in all capitals, as shown
here.</p>
<p>A device or consumer implementation complies with this
specification if it follows the normative statements in the present
document.</p>
</section>
<section id="terminology">
<div class="header-wrapper">
<h2 id="x3-terminology"><bdi class="secno">3.</bdi>
Terminology</h2>
<a class="self-link" href="#x3-terminology" aria-label=
"Permalink for Section 3."></a></div>
<p>The fundamental WoT terminology such as <dfn class="lint-ignore"
id="dfn-thing" tabindex="0" aria-haspopup="dialog" data-dfn-type=
"dfn">Thing</dfn>, <dfn class="lint-ignore" id="dfn-consumer"
tabindex="0" aria-haspopup="dialog" data-dfn-type=
"dfn">Consumer</dfn>, <dfn class="lint-ignore" data-plurals=
"thing descriptions" id="dfn-thing-description" tabindex="0"
aria-haspopup="dialog" data-dfn-type="dfn">Thing Description</dfn>
(<dfn class="lint-ignore" id="dfn-td" tabindex="0" aria-haspopup=
"dialog" data-dfn-type="dfn">TD</dfn>), <dfn class="lint-ignore"
id="dfn-wot-thing-description" tabindex="0" aria-haspopup="dialog"
data-dfn-type="dfn">WoT Thing Description</dfn>, <dfn class=
"lint-ignore" id="dfn-partial-td" tabindex="0" aria-haspopup=
"dialog" data-dfn-type="dfn">Partial TD</dfn>, <dfn class=
"lint-ignore" id="dfn-thing-model" tabindex="0" aria-haspopup=
"dialog" data-dfn-type="dfn">Thing Model</dfn> (<dfn class=
"lint-ignore" id="dfn-tm" tabindex="0" aria-haspopup="dialog"
data-dfn-type="dfn">TM</dfn>), <dfn class="lint-ignore" id=
"dfn-interaction-model" tabindex="0" aria-haspopup="dialog"
data-dfn-type="dfn">Interaction Model</dfn>, <dfn class=
"lint-ignore" id="dfn-interaction-affordance" tabindex="0"
aria-haspopup="dialog" data-dfn-type="dfn">Interaction
Affordance</dfn>, <dfn class="lint-ignore" id="dfn-property"
tabindex="0" aria-haspopup="dialog" data-dfn-type=
"dfn">Property</dfn>, <dfn class="lint-ignore" id="dfn-action"
tabindex="0" aria-haspopup="dialog" data-dfn-type=
"dfn">Action</dfn>, <dfn class="lint-ignore" id="dfn-event"
tabindex="0" aria-haspopup="dialog" data-dfn-type=
"dfn">Event</dfn>, <dfn class="lint-ignore" id=
"dfn-protocol-binding" tabindex="0" aria-haspopup="dialog"
data-dfn-type="dfn">Protocol Binding</dfn>, <dfn class=
"lint-ignore" id="dfn-servient" tabindex="0" aria-haspopup="dialog"
data-dfn-type="dfn">Servient</dfn>, <dfn class="lint-ignore" id=
"dfn-vocabulary" tabindex="0" aria-haspopup="dialog" data-dfn-type=
"dfn">Vocabulary</dfn>, <dfn class="lint-ignore" id="dfn-term"
tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Term</dfn>,
<dfn id="dfn-vocab-term" class="lint-ignore" tabindex="0"
aria-haspopup="dialog" data-dfn-type="dfn">Vocabulary Term</dfn>,
<dfn class="lint-ignore" id="dfn-wot-interface" tabindex="0"
aria-haspopup="dialog" data-dfn-type="dfn">WoT Interface</dfn>, and
<dfn class="lint-ignore" id="dfn-wot-runtime" tabindex="0"
aria-haspopup="dialog" data-dfn-type="dfn">WoT Runtime</dfn> are
defined in <a href=
"https://www.w3.org/TR/wot-architecture11/#terminology">Section
3</a> of the WoT Architecture specification [<cite><a class=
"bibref" data-link-type="biblio" href="#bib-wot-architecture"
title="Web of Things (WoT) Architecture">WOT-ARCHITECTURE</a></cite>].</p>
<p>For convenience of the reader, we use the terms <em>keyword</em>
and <em>field</em> for the linguistic notion <em>vocabulary
term</em> as defined in the <em>Thing Description</em>
Specification.</p>
<p>We use the terms <em>device</em> and <em>thing</em> in an
interchangeable manner.</p>
<section id="additional-definitions">
<div class="header-wrapper">
<h3 id="additional-definitions-"><bdi class="secno">3.1</bdi>
Additional Definitions</h3>
<a class="self-link" href="#additional-definitions-" aria-label=
"Permalink for Section 3.1"></a></div>
<dl>
<dt><dfn class="export" data-export="" id="dfn-profile" tabindex=
"0" aria-haspopup="dialog" data-dfn-type="dfn">Profile</dfn></dt>
<dd>A technical specification which provides a set of assertions
such that any <a href="#dfn-consumer" id=
"ref-for-dfn-consumer-1">Consumer</a> which conforms with the those
assertions is <a href=
"#out-of-the-box-interoperability">out-of-the-box interoperable</a>
with any <a href="#dfn-thing" id="ref-for-dfn-thing-1">Thing</a>
which also conforms with those assertions.</dd>
</dl>
</section>
</section>
<section id="requirements">
<div class="header-wrapper">
<h2 id="x4-profile-requirements"><bdi class="secno">4.</bdi>
Profile Requirements</h2>
<a class="self-link" href="#requirements" aria-label=
"Permalink for Section 4."></a></div>
<p>The following requirements were identified by the WoT profile
task force and are addressed by the Profile 1.0 specification.</p>
<section id="interoperability">
<div class="header-wrapper">
<h3 id="x4-1-interoperability"><bdi class="secno">4.1</bdi>
Interoperability</h3>
<a class="self-link" href="#interoperability" aria-label=
"Permalink for Section 4.1"></a></div>
<p>This is the most important objective of the profile. A TD
Consumer satisfying the requirements of a profile should be able to
process any TD also satisfying the profile and should be able to
correctly interact with all affordances of the Thing such a TD
describes.</p>
This implies that a profile has three parts:
<ul>
<li>Restrictions on TDs</li>
<li>Implementation requirements, constraints and behavioral
assertions for Consumers</li>
<li>Implementation requirements, constraints and behavioral
assertions on Things</li>
</ul>
<div class="note" role="note" id="issue-container-generatedID-0">
<div role="heading" class="note-title marker" id="h-note"
aria-level="3"><span>Note</span></div>
<section class="">Note: The WoT HTTP Basic Profile does not prevent
a TD to have forms for additional protocols, but these can be
ignored by compliant consumers, and could be removed without
affecting profile conformance and compatibility. This may be useful
for consumers that support multiple profiles.</section>
</div>
</section>
<section id="limit-and-reduce-complexity">
<div class="header-wrapper">
<h3 id="x4-2-limit-and-reduce-complexity"><bdi class=
"secno">4.2</bdi> Limit and reduce complexity</h3>
<a class="self-link" href="#limit-and-reduce-complexity"
aria-label="Permalink for Section 4.2"></a></div>
<p>Complexity addresses at least the following two things to
simplify the development and reduce the implementation effort:</p>
<ul>
<li>Implementation complexity on a thing and consumer, e.g.
eliminating the need of RDF processing, but still permitting
semantic annotations.</li>
<li>Simplifying thing description to have fewer variations.</li>
<li>Limiting the effort for JSON implementation.</li>
</ul>
</section>
<section id="no-ambiguities-select-single-choice">
<div class="header-wrapper">
<h3 id="x4-3-no-ambiguities-select-single-choice"><bdi class=
"secno">4.3</bdi> No Ambiguities, select single choice</h3>
<a class="self-link" href="#no-ambiguities-select-single-choice"
aria-label="Permalink for Section 4.3"></a></div>
<p>Get rid of ambiguities, i.e. clarify specifications to define
interpretation of a TD and behavior of the thing and consumer.</p>
<p>Examples are the choice of properties vs. actions, use of PUT or
POST for HTTP, observe protocols.</p>
</section>
<section id="developer-guidance">
<div class="header-wrapper">
<h3 id="x4-4-developer-guidance"><bdi class="secno">4.4</bdi>
Developer guidance</h3>
<a class="self-link" href="#developer-guidance" aria-label=
"Permalink for Section 4.4"></a></div>
<p>A profile should help define what needs to be implemented. This
requirement also includes behavioral goals and recommendations
about best practice for the implementation of Consumers and
Things.</p>
</section>
<section id="multiple-profiles-mechanism">
<div class="header-wrapper">
<h3 id="x4-5-multiple-profiles-mechanism"><bdi class=
"secno">4.5</bdi> Multiple profiles (mechanism)</h3>
<a class="self-link" href="#multiple-profiles-mechanism"
aria-label="Permalink for Section 4.5"></a></div>
<p>The mechanism used to indicate that a TD satisfies a profile
should be general enough to indicate the TD satisfies the
requirements for multiple profiles.</p>
</section>
<section id="composable-profiles">
<div class="header-wrapper">
<h3 id="x4-6-composable-profiles"><bdi class="secno">4.6</bdi>
Composable profiles</h3>
<a class="self-link" href="#composable-profiles" aria-label=
"Permalink for Section 4.6"></a></div>
<p>It should be possible to combine multiple profiles both for
production and consumption:</p>
<p>It should be possible to indicate that a consumer can ingest TDs
that satisfy one or more profiles, even if each TDs individually
only satisfies one profile. For example, a Smart Building may need
to use both "constrained" devices and "unconstrained" devices. A
gateway consuming TDs should be able to ingest TDs designed for
both the constrained and unconstrained contexts.</p>
<p>A Thing that satisfies all the requirements for multiple TDs
(for example, a device using protocols common to two different
usage contexts) should be able to indicate that.</p>
</section>
<section id="validatible-tds">
<div class="header-wrapper">
<h3 id="x4-7-validatible-tds"><bdi class="secno">4.7</bdi>
Validatible TDs</h3>
<a class="self-link" href="#validatible-tds" aria-label=
"Permalink for Section 4.7"></a></div>
<p>Whether or not a TD satisfies the requirements of a given
profile should be verifiable with automated tools. We can use the
existing TD JSDON Schema as a basis and reuse the existing tooling
(TD-playground)</p>
</section>
<section id="identification-of-profiles">
<div class="header-wrapper">
<h3 id="x4-8-identification-of-profiles"><bdi class=
"secno">4.8</bdi> Identification of profiles</h3>
<a class="self-link" href="#identification-of-profiles" aria-label=
"Permalink for Section 4.8"></a></div>
<p>There should be a mechanism to identify which profiles a TD
satisfies. This mechanism should be intrinsic to a TD, i.e. be
in-band.</p>
</section>
<section id="finite-set-of-features-and-capabilities">
<div class="header-wrapper">
<h3 id="x4-9-finite-set-of-features-and-capabilities"><bdi class=
"secno">4.9</bdi> Finite set of features and capabilities</h3>
<a class="self-link" href=
"#finite-set-of-features-and-capabilities" aria-label=
"Permalink for Section 4.9"></a></div>
<p>A profile should limit the number of options, for example the
set of possible protocols, to a finite set, so that a consumer can
consume any TD in a given profile with a finite and static code
base.</p>
</section>
</section>
<section id="profiling-mechanism">
<div class="header-wrapper">
<h2 id="x5-profiling-mechanism"><bdi class="secno">5.</bdi>
Profiling Mechanism</h2>
<a class="self-link" href="#profiling-mechanism" aria-label=
"Permalink for Section 5."></a></div>
<p><span class="rfc2119-assertion" id="profiling-mechanism-1">In
order to conform with a profile, a <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web Thing</a>
<em class="rfc2119">MUST</em> conform with all the normative
statements in the profile's specification.</span></p>
<p><span class="rfc2119-assertion" id="profiling-mechanism-2">In
order to denote that a given <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web Thing</a>
conforms to one or more profiles, its Thing Description <em class=
"rfc2119">MUST</em> include a <a href=
"https://www.w3.org/TR/wot-thing-description11/#thing"><code>profile</code></a>
member [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>].</span>
<span class="rfc2119-assertion" id="profiling-mechanism-3">The
value of the <code>profile</code> member <em class=
"rfc2119">MUST</em> be set to either a valid URI [<cite><a class=
"bibref" data-link-type="biblio" href="#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
identifying a single profile, or an array of valid URIs identifying
multiple profiles.</span></p>
<p><span class="rfc2119-assertion" id="profiling-mechanism-4">In
order to use a <code>profile</code> member in a Thing Description,
the <code>@context</code> member <em class="rfc2119">MUST</em>
contain the anyURI <code>https://www.w3.org/2022/wot/td/v1.1</code>
in order to denote that the document is using version 1.1 of the
Thing Description specification. [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>].</span></p>
<div class="example" id="example-1">
<div class="marker"><a class="self-link" href="#example-1">Example
<bdi>1</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@context"</span>: <span class=
"hljs-string">"https://www.w3.org/2022/wot/td/v1.1"</span>,
  <span class="hljs-string">"id"</span>: <span class=
"hljs-string">"urn:dev:ops:32473-WoTLamp-1234"</span>,
  <span class="hljs-string">"profile"</span>: <span class=
"hljs-string">"https://www.w3.org/2022/wot/profile/http-basic/v1"</span>,
  <span class="hljs-string">"title"</span>: <span class=
"hljs-string">"My Lamp"</span>,
  <span class="hljs-string">"description"</span>: <span class=
"hljs-string">"A web connected lamp"</span>,
  ...
}</code></pre></div>
<div class="example" id="example-2">
<div class="marker"><a class="self-link" href="#example-2">Example
<bdi>2</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@context"</span>: <span class=
"hljs-string">"https://www.w3.org/2022/wot/td/v1.1"</span>,
  <span class="hljs-string">"id"</span>: <span class=
"hljs-string">"urn:dev:ops:32473-WoTLamp-1234"</span>,
  <span class="hljs-string">"profile"</span>: [
    <span class=
"hljs-string">"https://www.w3.org/2022/wot/profile/http-basic/v1"</span>,
    <span class=
"hljs-string">"https://www.w3.org/2022/wot/profile/http-sse/v1"</span>
  ],
  <span class="hljs-string">"title"</span>: <span class=
"hljs-string">"My Lamp"</span>,
  <span class="hljs-string">"description"</span>: <span class=
"hljs-string">"A web connected lamp"</span>,
  ...
}</code></pre></div>
</section>
<section id="common-constraints">
<div class="header-wrapper">
<h2 id="x6-common-constraints"><bdi class="secno">6.</bdi> Common
Constraints</h2>
<a class="self-link" href="#common-constraints" aria-label=
"Permalink for Section 6."></a></div>
<p>The following sections are applicable for all of the HTTP
profiles defined by this document.</p>
<section id="common-constraints-accessibilityy">
<div class="header-wrapper">
<h3 id="accessibility"><bdi class="secno">6.1</bdi>
Accessibility</h3>
<a class="self-link" href="#accessibility" aria-label=
"Permalink for Section 6.1"></a></div>
<p>Authors of <a href="#dfn-thing-description" class="internalDFN"
data-link-type="dfn" id="ref-for-dfn-thing-description-1">Thing
Descriptions</a> must ensure that the things described by them are
accessible to users with disabilities.</p>
<p><span class="rfc2119-assertion" id=
"common-constraints-a11y-1">It is <em class="rfc2119">REQUIRED</em>
to provide a <code>title</code> that can be automatically rendered
in a non-visual way (e.g. using a screen reader) for things that
may be used in deployments with users with disabilities.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-a11y-2">It is highly <em class=
"rfc2119">RECOMMENDED</em> to provide a <code>description</code>
that can be automatically rendered in a non-visual way (e.g. using
a screen reader) for things that may be used in deployments with
users with disabilities.</span></p>
<div class="note" id="issue-container-generatedID-1">
<div role="heading" class="ednote-title marker" id="h-ednote-0"
aria-level="4"><span>Editor's note</span></div>
<section class="">This is just a baseline set of requirements,
which needs additional input from the APA group. It needs to be
clarified which TD elements are used by people with disabilities
and to which these constraints are applied.</section>
</div>
</section>
<section id="sdec-common-constraints-units">
<div class="header-wrapper">
<h3 id="units"><bdi class="secno">6.2</bdi> Units</h3>
<a class="self-link" href="#units" aria-label=
"Permalink for Section 6.2"></a></div>
<p>Authors of <a href="#dfn-thing-description" class="internalDFN"
data-link-type="dfn" id="ref-for-dfn-thing-description-2">Thing
Descriptions</a> should be aware that units that are common in
their geographic region are not globally applicable and may lead to
misinterpretation with drastic consequences.</p>
<p><span class="rfc2119-assertion" id="common-constraints-units">It
is highly <em class="rfc2119">RECOMMENDED</em> to provide a
<code>unit</code>, if a value has a physical quantity.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-units-metric">It is highly <em class=
"rfc2119">RECOMMENDED</em> to use the metric system (SI units) for
devices that are used in global deployments.</span></p>
</section>
<section id="common-constraints-date-format">
<div class="header-wrapper">
<h3 id="date-format"><bdi class="secno">6.3</bdi> Date Format</h3>
<a class="self-link" href="#date-format" aria-label=
"Permalink for Section 6.3"></a></div>
<p><span class="rfc2119-assertion" id=
"common-constraints-date-format-1">All date and time values
<em class="rfc2119">MUST</em> use the <code>date-time</code> format
defined in [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3339" title=
"Date and Time on the Internet: Timestamps">RFC3339</a></cite>].</span></p>
<div class="example" id="example-3">
<div class="marker"><a class="self-link" href="#example-3">Example
<bdi>3</bdi></a></div>
<pre class=""><code aria-busy="false" class=
"hljs">2022-09-21T23:20:50.52Z</code></pre></div>
<div class="note" role="note" id="issue-container-generatedID-2">
<div role="heading" class="note-title marker" id="h-note-0"
aria-level="4"><span>Note</span></div>
<p class="">In order to reduce ambiguity, RFC 3339 only permits an
hour with a value between 00 and 23 (not 24), and time zones
expressed as a numerical offset relative to UTC. The suffix "Z"
when applied to a time denotes a UTC offset of 00:00.</p>
</div>
</section>
<section id="common-constraints-security">
<div class="header-wrapper">
<h3 id="x6-4-security"><bdi class="secno">6.4</bdi> Security</h3>
<a class="self-link" href="#common-constraints-security"
aria-label="Permalink for Section 6.4"></a></div>
<div class="rfc2119-assertion" id="common-constraints-security-1">
<p>Below is a list of <a href=
"https://www.w3.org/TR/wot-thing-description11/#sec-security-vocabulary-definition">
security schemes</a> [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-wot-thing-description" title=
"Web of Things (WoT) Thing Description">wot-thing-description</a></cite>]
which conformant Web Things <em class="rfc2119">MAY</em> use:</p>
<ul>
<li><a href=
"https://www.w3.org/TR/wot-thing-description11/#nosecurityscheme"><code>
NoSecurityScheme</code></a></li>
<li><a href=
"https://www.w3.org/TR/wot-thing-description11/#basicsecurityscheme">
<code>BasicSecurityScheme</code></a></li>
<li><a href=
"https://www.w3.org/TR/wot-thing-description11/#oauth2securityscheme">
<code>OAuth2SecurityScheme</code> with the <code>code</code> or
<code>client</code> flow.</a></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"common-constraints-security-2">Conformant Consumers <em class=
"rfc2119">MUST</em> support all of these security
schemes.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-security-3">A Thing <em class=
"rfc2119">MAY</em> implement multiple security schemes.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-security-6">Conformant Consumers <em class=
"rfc2119">MUST</em> support security bootstrapping for all
implemented security schemes, as defined in <a href=
"https://www.w3.org/TR/wot-discovery/#exploration-secboot">Security
Bootstrapping</a> in the WoT Discovery [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-discovery" title=
"Web of Things (WoT) Discovery">wot-discovery</a></cite>]
specification.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-security-7">Conformant Things which require
authentication in order to retrieve their Thing Description
<em class="rfc2119">MUST</em> implement security bootstrapping, as
defined in <a href=
"https://www.w3.org/TR/wot-discovery/#exploration-secboot">Security
Bootstrapping</a> in the WoT Discovery [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-discovery" title=
"Web of Things (WoT) Discovery">wot-discovery</a></cite>]
specification.</span></p>
</section>
<section id="common-constraints-discovery">
<div class="header-wrapper">
<h3 id="x6-5-discovery"><bdi class="secno">6.5</bdi> Discovery</h3>
<a class="self-link" href="#common-constraints-discovery"
aria-label="Permalink for Section 6.5"></a></div>
<p class="rfc2119-assertion" id="common-constraints-discovery-1">A
Web Thing's Thing Description [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-thing-description" title=
"Web of Things (WoT) Thing Description">wot-thing-description</a></cite>]
<em class="rfc2119">MUST</em> be retrievable from a <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-wot-thing-description-server">
Thing Description Server</a> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-architecture11" title=
"Web of Things (WoT) Architecture 1.1">wot-architecture11</a></cite>]
using an HTTP [<cite><a class="bibref" data-link-type="biblio"
href="#bib-http11" title=
"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">HTTP11</a></cite>]
URL provided by a <a href=
"https://www.w3.org/TR/wot-discovery/#introduction-mech">Direct
Introduction Mechanism</a> [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-wot-discovery" title=
"Web of Things (WoT) Discovery">wot-discovery</a></cite>].</p>
</section>
<section id="common-constraints-links">
<div class="header-wrapper">
<h3 id="x6-6-links"><bdi class="secno">6.6</bdi> Links</h3>
<a class="self-link" href="#common-constraints-links" aria-label=
"Permalink for Section 6.6"></a></div>
<p>Hypermedia links in the HTTP Profiles are significantly
constrained to ensure a common interpretation and interoperability
between things and consumers.</p>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-1">The following keywords are defined for
links in the HTTP profiles and <em class="rfc2119">MAY</em> be
present in profile-compliant TDs with the constraints defined by
this section.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-2">Other keywords for links <em class=
"rfc2119">MAY</em> be present in a TD, however their interpretation
is undefined in the context of the HTTP profiles</span>
<span class="rfc2119-assertion" id=
"common-constraints-links-3">These other link types <em class=
"rfc2119">MAY</em> be ignored by all profile-compliant
consumers.</span></p>
<div class="note" role="note" id="issue-container-generatedID-3">
<div role="heading" class="note-title marker" id="h-note-1"
aria-level="4"><span>Note</span></div>
<section class="">
<p>These links enable consumers to interpret linked content that is
provided by the link target in an unambiguous way. This
interpretation is a "best effort" mechanism, that depends on the
capabilities of the consumer. A consumer with a browser could
render HTML content, a consumer with a PDF engine can display PDF
content, a consumer with a dot-matrix display only can display
icons.</p>
<p>For consumers that can render images or documents this implies
to display appropriate documentation to a human reader.</p>
<p>Consumers that are capable of working with nested things and
thing model structures are able to navigate between things and
thing models in a well defined way.</p>
</section>
</div>
<table class="def">
<thead>
<tr>
<th>Keyword</th>
<th>Type</th>
<th>Constraint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>href</code></td>
<td>IRI of the link target</td>
<td>mandatory,<code>anyURI</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>media type [RFC2046] of the link target</td>
<td>mandatory, the supported set of media types is defined in
<a href="#sec-link-relation-types">Media Types for Link Targets</a>
below.</td>
</tr>
<tr>
<td><code>rel</code></td>
<td>link relation type <a href=
"https://www.iana.org/assignments/link-relations/link-relations.xhtml">
IANA Link Relations</a></td>
<td>mandatory, the supported subset of relation types is described
in <a href="#sec-link-relation-types">Link Relation Types</a>
below.</td>
</tr>
<tr>
<td><code>sizes</code></td>
<td>string with icon dimensions</td>
<td>mandatory for <code>icon</code> link targets, forbidden
otherwise.</td>
</tr>
<tr>
<td><code>hreflang</code></td>
<td><code>array of string</code> with valid language tags according
to [BCP47]</td>
<td>optional.</td>
</tr>
</tbody>
</table>
<section id="sec-link-relation-types">
<div class="header-wrapper">
<h4 id="x6-6-1-link-relation-types"><bdi class="secno">6.6.1</bdi>
Link Relation Types</h4>
<a class="self-link" href="#sec-link-relation-types" aria-label=
"Permalink for Section 6.6.1"></a></div>
<table class="def">
<thead>
<tr>
<th>Relation Type</th>
<th>Constraint</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>icon</code></td>
<td>supported media types: <code>image/png</code>,
<code>image/jpeg</code>.</td>
</tr>
<tr>
<td><code>type</code></td>
<td>link target <em class="rfc2119">MUST</em> be a
profile-compliant <a href="#dfn-thing-model" class="internalDFN"
data-link-type="dfn" id="ref-for-dfn-thing-model-1">Thing
Model</a></td>
<td>No other types are defined in the Profile.</td>
</tr>
<tr>
<td><code>service-doc</code></td>
<td>human readable documentation, supported formats are Unicode
Text, markdown, HTML and PDF.</td>
<td></td>
</tr>
<tr>
<td><code>collection</code></td>
<td>link target is a collection of things or thing models.</td>
<td></td>
</tr>
<tr>
<td><code>item</code></td>
<td>link target is a collection member of the thing or thing
model.</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="sec-link-media-types">
<div class="header-wrapper">
<h4 id="x6-6-2-media-types-for-link-targets"><bdi class=
"secno">6.6.2</bdi> Media Types for Link Targets</h4>
<a class="self-link" href="#sec-link-media-types" aria-label=
"Permalink for Section 6.6.2"></a></div>
<span class="rfc2119-assertion" id=
"common-constraints-links-media-types-1">The following media types
from <a href=
"https://www.iana.org/assignments/media-types/media-types.xhtml">IANA</a>
<em class="rfc2119">MAY</em> be used as the link targets of profile
compliant TDs with the constraints in this section.</span>
<span class="rfc2119-assertion" id=
"common-constraints-links-media-types-2">Other media types
<em class="rfc2119">MAY</em> be present in a TD, however their heir
interpretation is undefined in the context of the HTTP profiles and
they <em class="rfc2119">MAY</em> be ignored by all
profile-compliant consumers.</span>
<table class="def">
<thead>
<tr>
<th>Type</th>
<th>Constraint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text/plain</code></td>
<td>charset=UTF-8</td>
</tr>
<tr>
<td><code>text/html</code></td>
<td></td>
</tr>
<tr>
<td><code>text/markdown</code></td>
<td>charset=UTF-8</td>
</tr>
<tr>
<td><code>text/pdf</code></td>
<td></td>
</tr>
<tr>
<td><code>application/json</code></td>
<td></td>
</tr>
<tr>
<td><code>application/ld+json</code></td>
<td></td>
</tr>
<tr>
<td><code>application/octet-stream</code></td>
<td></td>
</tr>
<tr>
<td><code>image/jpeg</code></td>
<td></td>
</tr>
<tr>
<td><code>image/png</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-media-types-4">If a Consumer encounters a
link with "rel": "icon" and "type": "image/*" and it is capable of
rendering images in the provided format, then it <em class=
"rfc2119">SHOULD</em> interpret the link as an icon for the Thing
and display it to the user.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-media-types-5">If a Consumer encounters a
link with "rel": "alternate" and "type": "text/html" and it is
capable of rendering an HTML page and accepting user input, then it
<em class="rfc2119">SHOULD</em> interpret the link as a user
interface for the Thing and provide a means for the user to follow
that link and view and interact with the HTML page.</span></p>
</section>
<p></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-media-types-6">If a Consumer encounters a
link with "rel": "service-doc" and "type": "text/plain", "type":
"text/html" or "type": "text/pdf", and is capable of rendering
documents in the provided format, then it <em class=
"rfc2119">SHOULD</em> interpret the link as a user manual for the
Thing and provide a means for the user to follow that link and read
the user manual.</span></p>
</section>
<p></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-media-types-7">If a Consumer encounters a
link with "rel": "item" and "type": "application/td+json" and is
capable of rendering a hierarchical tree of Things, then it should
interpret the link as an indication that the target is a sub-Thing
of the current Thing and render this in a meaningful way to the
user.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-links-media-types-8">If a Consumer encounters a
link with "rel": "collection" and "type": "application/td+json" and
is capable of rendering a hierarchical tree of Things, then it
should interpret the link as an indication that the target
describes a Thing (e.g. a group, system of Things or Thing
Directory) which contains the current Thing and render this in a
meaningful way to the user.</span></p>
<section id="common-constraints-errors">
<div class="header-wrapper">
<h2 id="error-responses"><bdi class="secno">7.</bdi> Errors</h2>
<a class="self-link" href="#error-responses" aria-label=
"Permalink for Section 7."></a></div>
<p><span class="rfc2119-assertion" id=
"common-constraints-errors-1">If any of the operations defined in
the protocol bindings of HTTP profiles are unsuccessful then the
Web Thing <em class="rfc2119">MUST</em> send an HTTP response with
an HTTP error code which describes the reason for the
failure.</span></p>
<div class="rfc2119-assertion" id="common-constraints-errors-2">
<p>It is <em class="rfc2119">RECOMMENDED</em> that error responses
use one of the following HTTP error codes:</p>
<ul>
<li><code>400 Bad Request</code></li>
<li><code>401 Unauthorized</code></li>
<li><code>403 Forbidden</code></li>
<li><code>404 Not Found</code></li>
<li><code>500 Internal Server Error</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"common-constraints-errors-3">A Web Thing <em class=
"rfc2119">MAY</em> respond with 3xx status codes for the purposes
of redirection, caching or authentication.</span> <span class=
"rfc2119-assertion" id="common-constraints-errors-4">A Web Thing
<em class="rfc2119">MUST NOT</em> respond with a <code>300 Multiple
Choices</code> status code.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-errors-5">Web Things <em class=
"rfc2119">MAY</em> respond with other valid HTTP error codes (e.g.
<code>418 I'm a teapot</code>).</span> <span class=
"rfc2119-assertion" id="common-constraints-errors-6">Consumers
<em class="rfc2119">MAY</em> interpret other valid HTTP error codes
as a generic <code>4xx</code> or <code>5xx</code> error with no
special defined behaviour.</span></p>
<p><span class="rfc2119-assertion" id=
"common-constraints-errors-7">If an HTTP error response contains a
body, the content of that body <em class="rfc2119">MUST</em>
conform with the Problem Details format [<cite><a class="bibref"
data-link-type="biblio" href="#bib-rfc7807" title=
"Problem Details for HTTP APIs">RFC7807</a></cite>].</span></p>
</section>
<section id="sec-default-language">
<div class="header-wrapper">
<h2 id="x8-default-language"><bdi class="secno">8.</bdi> Default
Language</h2>
<a class="self-link" href="#sec-default-language" aria-label=
"Permalink for Section 8."></a></div>
<p><span class="rfc2119-assertion" id=
"common-constraints-default-language">One Map contained in an
<code>@context Array</code> <em class="rfc2119">MUST</em> contain a
name-value pair that defines the default language for the Thing
Description, where the name is the Term <code>@language</code> and
the value is a well-formed language tag as defined by [BCP47]
(e.g., en, de-AT, gsw-CH, zh-Hans, zh-Hant-HK,
sl-nedis).</span></p>
</section>
<section id="http-basic-profile">
<div class="header-wrapper">
<h2 id="x9-http-basic-profile"><bdi class="secno">9.</bdi> HTTP
Basic Profile</h2>
<a class="self-link" href="#http-basic-profile" aria-label=
"Permalink for Section 9."></a></div>
<p>This section defines the HTTP Basic Profile, which includes a
<a href="#http-basic-profile-protocol-binding">Protocol Binding</a>
for reading and writing properties and invoking, querying and
cancelling actions.</p>
<p>This profile may be used in conjunction with the <a href=
"#sec-http-sse-profile">HTTP SSE Profile</a> or the <a href=
"#sec-http-webhook-profile">HTTP Webhook Profile</a> in order to
provide operations for observing properties and listening for
events.</p>
<p><span class="rfc2119-assertion" id="http-basic-profile-1">In
order to conform with the HTTP Basic Profile, Web Things and
Consumers <em class="rfc2119">MUST</em> also conform with all of
the assertions in the <a href="#common-constraints">Common
Constraints</a> section.</span></p>
<section id="http-basic-profile-identifier">
<div class="header-wrapper">
<h3 id="x9-1-identifier"><bdi class="secno">9.1</bdi>
Identifier</h3>
<a class="self-link" href="#http-basic-profile-identifier"
aria-label="Permalink for Section 9.1"></a></div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-identifier-1">In order to denote that a given
<a href="https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web
Thing</a> conforms to the HTTP Basic Profile, its Thing Description
<em class="rfc2119">MUST</em> have a <a href=
"https://www.w3.org/TR/wot-thing-description11/#thing"><code>profile</code></a>
member [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-thing-description" title=
"Web of Things (WoT) Thing Description">wot-thing-description</a></cite>]
with a value of
<code>https://www.w3.org/2022/wot/profile/http-basic/v1</code>.</span></p>
</section>
<section id="http-basic-profile-protocol-binding">
<div class="header-wrapper">
<h3 id="x9-2-protocol-binding"><bdi class="secno">9.2</bdi>
Protocol Binding</h3>
<a class="self-link" href="#http-basic-profile-protocol-binding"
aria-label="Permalink for Section 9.2"></a></div>
<p>This section defines a protocol binding which describes how a
<a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-consumer">Consumer</a>
communicates with a <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web Thing</a>
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-architecture11" title=
"Web of Things (WoT) Architecture 1.1">wot-architecture11</a></cite>]
using JSON [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-json" title=
"The JavaScript Object Notation (JSON) Data Interchange Format">JSON</a></cite>]
payloads over the HTTP [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-http11" title=
"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">HTTP11</a></cite>]
protocol.</p>
<p><span class="rfc2119-assertion" id=
"profile-5-2-thing-protocol-binding-1">A Consumer or Web Thing
conforming to the HTTP Basic Profile <em class="rfc2119">MUST</em>
implement this protocol binding.</span></p>
<p>The examples provided throughout this section describe how a
Consumer would communicate with a Web Thing which produces the
following Thing Description:</p>
<div class="example" id="example-4">
<div class="marker"><a class="self-link" href="#example-4">Example
<bdi>4</bdi></a></div>
<pre aria-busy="false"><code class="hljs json">{
  <span class="hljs-attr">"@context"</span>: <span class=
"hljs-string">"https://www.w3.org/2022/wot/td/v1.1"</span>,
  <span class="hljs-attr">"id"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/things/lamp"</span>,
  <span class="hljs-attr">"profile"</span>: <span class=
"hljs-string">"https://www.w3.org/2022/wot/profile/http-basic/v1"</span>,
  <span class="hljs-attr">"base"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/things/lamp/"</span>,
  <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"My Lamp"</span>,
  <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"A web connected lamp"</span>,
  <span class="hljs-attr">"securityDefinitions"</span>: {
    <span class="hljs-attr">"oauth2"</span>: {
      <span class="hljs-attr">"scheme"</span>: <span class=
"hljs-string">"oauth2"</span>,
      <span class="hljs-attr">"flow"</span>: <span class=
"hljs-string">"code"</span>,
      <span class="hljs-attr">"authorization"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/oauth/authorize"</span>,
      <span class="hljs-attr">"token"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/oauth/token"</span>
    }
  },
  <span class="hljs-attr">"security"</span>: <span class=
"hljs-string">"oauth2"</span>,
  <span class="hljs-attr">"properties"</span>: {
    <span class="hljs-attr">"on"</span>: {
      <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"boolean"</span>,
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"On/Off"</span>,
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"Whether the lamp is turned on"</span>,
      <span class="hljs-attr">"forms"</span>: [{<span class=
"hljs-attr">"href"</span>: <span class=
"hljs-string">"properties/on"</span>}]
    },
    <span class="hljs-attr">"level"</span> : {
      <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"integer"</span>,
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Brightness"</span>,
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"The level of light from 0-100"</span>,
      <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"percent"</span>,
      <span class="hljs-attr">"minimum"</span> : <span class=
"hljs-number">0</span>,
      <span class="hljs-attr">"maximum"</span> : <span class=
"hljs-number">100</span>,
      <span class="hljs-attr">"forms"</span>: [{<span class=
"hljs-attr">"href"</span>: <span class=
"hljs-string">"properties/level"</span>}]
    }
  },
  <span class="hljs-attr">"actions"</span>: {
    <span class="hljs-attr">"fade"</span>: {
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Fade"</span>,
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"Fade the lamp to a given level"</span>,
      <span class="hljs-attr">"input"</span>: {
        <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"object"</span>,
        <span class="hljs-attr">"properties"</span>: {
          <span class="hljs-attr">"level"</span>: {
            <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Brightness"</span>,
            <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"integer"</span>,
            <span class="hljs-attr">"minimum"</span>: <span class=
"hljs-number">0</span>,
            <span class="hljs-attr">"maximum"</span>: <span class=
"hljs-number">100</span>,
            <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"percent"</span>
          },
          <span class="hljs-attr">"duration"</span>: {
            <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Duration"</span>,
            <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"integer"</span>,
            <span class="hljs-attr">"minimum"</span>: <span class=
"hljs-number">0</span>,
            <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"milliseconds"</span>
          }
        }
      },
      <span class="hljs-attr">"forms"</span>: [{<span class=
"hljs-attr">"href"</span>: <span class=
"hljs-string">"actions/fade"</span>}]
    }
  },
  <span class="hljs-attr">"forms"</span>: [
    {
      <span class="hljs-attr">"op"</span>: [<span class=
"hljs-string">"readallproperties"</span>, <span class=
"hljs-string">"writemultipleproperties"</span>],
      <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"properties"</span>
    },
    {
      <span class="hljs-attr">"op"</span>: <span class=
"hljs-string">"queryallactions"</span>,
      <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"actions"</span>
    }
  ]
}</code></pre></div>
<section id="http-basic-profile-protocol-binding-properties">
<div class="header-wrapper">
<h4 id="x9-2-1-properties"><bdi class="secno">9.2.1</bdi>
Properties</h4>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-properties" aria-label=
"Permalink for Section 9.2.1"></a></div>
<section id="http-basic-profile-protocol-binding-readproperty">
<div class="header-wrapper">
<h5 id="x9-2-1-1-readproperty"><bdi class="secno">9.2.1.1</bdi>
<code>readproperty</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-readproperty" aria-label=
"Permalink for Section 9.2.1.1"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readproperty-1">
<p>The URL of a <code>Property</code> resource to be used when
reading the value of a property <em class="rfc2119">MUST</em> be
obtained from a Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#propertyaffordance">
<code>PropertyAffordance</code></a> for which:</p>
<ul>
<li>After defaults have been applied, its <code>op</code> member
contains the value <code>readproperty</code>.</li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readproperty-3">The resolved
value of the <code>href</code> member <em class="rfc2119">MUST</em>
then be used as the URL of the <code>Property</code>
resource.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readproperty-4">
<p>In order to read the value of a property, a Consumer <em class=
"rfc2119">MUST</em> send an HTTP request to a Web Thing with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the <code>Property</code> resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
</div>
<div class="example" id="example-5">
<div class="marker"><a class="self-link" href="#example-5">Example
<bdi>5</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/properties/on</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>application/json</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readproperty-6">
<p>If a Web Thing receives an HTTP request following the format
above and the Consumer has permission to read the corresponding
property, then upon successfully reading the value of the property
it <em class="rfc2119">MUST</em> send an HTTP response with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body with the value of the property serialized in JSON</li>
</ul>
</div>
<div class="example" id="example-6">
<div class="marker"><a class="self-link" href="#example-6">Example
<bdi>6</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
false</code></pre></div>
</section>
<section id="http-basic-profile-protocol-binding-writeproperty">
<div class="header-wrapper">
<h5 id="x9-2-1-2-writeproperty"><bdi class="secno">9.2.1.2</bdi>
<code>writeproperty</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-writeproperty" aria-label=
"Permalink for Section 9.2.1.2"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writeproperty-1">
<p>The URL of a <code>Property</code> resource to be used when
writing the value of a property <em class="rfc2119">MUST</em> be
obtained from a Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#propertyaffordance">
<code>PropertyAffordance</code></a> for which:</p>
<ul>
<li>After defaults have been applied, its <code>op</code> member
contains the value <code>writeproperty</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writeproperty-3">The resolved
value of the <code>href</code> member <em class="rfc2119">MUST</em>
then be used as the URL of the <code>Property</code>
resource.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writeproperty-4">
<p>In order to write the value of a property, a Consumer <em class=
"rfc2119">MUST</em> send an HTTP request to a Web Thing with:</p>
<ul>
<li>Method set to <code>PUT</code></li>
<li>URL set to the URL of the <code>Property</code> resource</li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body with a requested new value for the property serialized
in JSON</li>
</ul>
</div>
<div class="example" id="example-7">
<div class="marker"><a class="self-link" href="#example-7">Example
<bdi>7</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs javascript">PUT /things/lamp/properties/on HTTP/<span class=
"hljs-number">1.1</span>
<span class="hljs-attr">Host</span>: mythingserver.com
Content-Type: application/json
<span class="hljs-literal">true</span></code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writeproperty-6">
<p>If a Web Thing receives an HTTP request following the format
above and the Consumer has permission to write the corresponding
property, then upon successfully writing the value of the property
it <em class="rfc2119">MUST</em> send an HTTP response with:</p>
<ul>
<li>Status code set to <code>204</code></li>
</ul>
</div>
<div class="example" id="example-8">
<div class="marker"><a class="self-link" href="#example-8">Example
<bdi>8</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class=
"hljs-number">204</span> No Content</code></pre></div>
</section>
<section id=
"http-basic-profile-protocol-binding-readallproperties">
<div class="header-wrapper">
<h5 id="x9-2-1-3-readallproperties"><bdi class=
"secno">9.2.1.3</bdi> <code>readallproperties</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-readallproperties"
aria-label="Permalink for Section 9.2.1.3"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readallproperties-1">
<p>The URL of a <code>Properties</code> resource to be used when
reading the value of all properties at once <em class=
"rfc2119">MUST</em> be obtained from a Thing Description by
locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the top level <a href=
"https://www.w3.org/TR/wot-thing-description11/#form-serialization-json">
<code>forms</code></a> member for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>readallproperties</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readallproperties-3">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the
<code>Properties</code> resource.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readallproperties-4">
<p>In order to read the value of all properties, a Consumer
<em class="rfc2119">MUST</em> send an HTTP request to a Web Thing
with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the <code>Properties</code> resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
</div>
<div class="example" id="example-9">
<div class="marker"><a class="self-link" href="#example-9">Example
<bdi>9</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/properties</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>application/json</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-readallproperties-5">
<p>If a Web Thing receives an HTTP request following the format
above, then upon successfully reading the values of all the
readable properties to which the Consumer has permission to access,
it <em class="rfc2119">MUST</em> send an HTTP response with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body with the values of all readable properties serialized in
JSON, as an object keyed by property name</li>
</ul>
</div>
<div class="example" id="example-10">
<div class="marker"><a class="self-link" href="#example-10">Example
<bdi>10</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
{
  <span class="hljs-string">"on"</span>: false,
  <span class="hljs-string">"level"</span>: <span class=
"hljs-number">100</span>
}</code></pre></div>
</section>
<section id=
"http-basic-profile-protocol-binding-writemultipleproperties">
<div class="header-wrapper">
<h5 id="x9-2-1-4-writemultipleproperties"><bdi class=
"secno">9.2.1.4</bdi> <code>writemultipleproperties</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-writemultipleproperties"
aria-label="Permalink for Section 9.2.1.4"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writemultipleproperties-1">
<p>The URL of a <code>Properties</code> resource to be used when
writing the value of multiple properties at once <em class=
"rfc2119">MUST</em> be obtained from a Thing Description by
locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the top level <a href=
"https://www.w3.org/TR/wot-thing-description11/#form-serialization-json">
<code>forms</code></a> member for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>writemultipleproperties</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-bindings-writemultipleproperties-3">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the
<code>Properties</code> resource.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writemultipleproperties-4">
<p>In order to write the value of multiple properties at once, a
Consumer <em class="rfc2119">MUST</em> send an HTTP request to a
Web Thing with:</p>
<ul>
<li>Method set to <code>PUT</code></li>
<li>URL set to the URL of the <code>Properties</code> resource</li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body with requested new values for the writable properties
serialized in JSON, as an object keyed by property name</li>
</ul>
</div>
<div class="example" id="example-11">
<div class="marker"><a class="self-link" href="#example-11">Example
<bdi>11</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs css">PUT /things/lamp/properties HTTP/<span class=
"hljs-number">1.1</span>
Host: mythingserver.com
Content-Type: application/json
{
  <span class="hljs-string">"on"</span>: true,
  <span class="hljs-string">"level"</span>: <span class=
"hljs-number">50</span>
}</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-writemultipleproperties-6">
<p>If a Web Thing receives an HTTP request following the format
above, then upon successfully writing the values of the requested
writable properties it <em class="rfc2119">MUST</em> send an HTTP
response with:</p>
<ul>
<li>Status code set to <code>204</code></li>
</ul>
</div>
<div class="example" id="example-12">
<div class="marker"><a class="self-link" href="#example-12">Example
<bdi>12</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class=
"hljs-number">204</span> No Content</code></pre></div>
</section>
<div class="note" role="note" id="issue-container-generatedID-4">
<div role="heading" class="note-title marker" id="h-note-2"
aria-level="5"><span>Note</span></div>
<section class="">
<p>The <code>readmultipleproperties</code> operation is excluded
due to the complexities of the request payload format and because
it doesn't add much functionality over <code>readproperty</code>
and <code>readallproperties</code>. <code>writeallproperties</code>
is excluded because it is just a special case of
<code>writemultipleproperties</code>.</p>
</section>
</div>
</section>
<section id="http-basic-profile-protocol-binding-actions">
<div class="header-wrapper">
<h4 id="x9-2-2-actions"><bdi class="secno">9.2.2</bdi> Actions</h4>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-actions" aria-label=
"Permalink for Section 9.2.2"></a></div>
<section id="http-basic-profile-protocol-binding-invokeaction">
<div class="header-wrapper">
<h5 id="x9-2-2-1-invokeaction"><bdi class="secno">9.2.2.1</bdi>
<code>invokeaction</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-invokeaction" aria-label=
"Permalink for Section 9.2.2.1"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-1">
<p>The URL of an <code>Action</code> resource to be used when
invoking an action <em class="rfc2119">MUST</em> be obtained from a
Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#actionaffordance"><code>
ActionAffordance</code></a> for which:</p>
<ul>
<li>After defaults have been applied, the value of its
<code>op</code> member is <code>invokeaction</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-3">The resolved
value of the <code>href</code> member <em class="rfc2119">MUST</em>
then be used as the URL of the <code>Action</code>
resource.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-4">
<p>In order to invoke an action on a Web Thing, a Consumer
<em class="rfc2119">MUST</em> send an HTTP request to the Web Thing
with:</p>
<ul>
<li>Method set to <code>POST</code></li>
<li>URL set to the URL of the <code>Action</code> resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body with an input to the action, if any, serialized in
JSON</li>
</ul>
</div>
<div class="example" id="example-13">
<div class="marker"><a class="self-link" href="#example-13">Example
<bdi>13</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs css">POST /things/lamp/actions/fade HTTP/<span class=
"hljs-number">1.1</span>
Host: mythingserver.com
Content-Type: application/json
Accept: application/json
{
  <span class="hljs-string">"level"</span>: <span class=
"hljs-number">100</span>,
  <span class="hljs-string">"duration"</span>: <span class=
"hljs-number">5</span>
}</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-6">
<p>If a Web Thing receives an HTTP request following the format
above then it <em class="rfc2119">MUST</em> respond with one of
three response formats:</p>
<ol>
<li><a href="#sync-action-response">Synchronous Action
Response</a></li>
<li><a href="#async-action-response">Asynchronous Action
Response</a></li>
<li><a href="#error-responses">Error Response</a></li>
</ol>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-7">If the
<code>synchronous</code> member of the <a href=
"https://www.w3.org/TR/wot-thing-description11/#actionaffordance"><code>
ActionAffordance</code></a> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>]
is set to <code>true</code> then the Web Thing <em class=
"rfc2119">MUST</em> respond with a <a href=
"#sync-action-response">Synchronous Action Response</a>.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-8">If the
<code>synchronous</code> member of the <a href=
"https://www.w3.org/wot-thing-description11/#actionaffordance"><code>
ActionAffordance</code></a> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>]
is set to <code>false</code> then the Web Thing <em class=
"rfc2119">MUST</em> respond with an <a href=
"#async-action-response">Asynchronous Action
Response</a>.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-9">If the
<code>synchronous</code> member of the <a href=
"https://www.w3.org/TR/wot-thing-description11/#actionaffordance"><code>
ActionAffordance</code></a> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-wot-thing-description11" title=
"Web of Things (WoT) Thing Description 1.1">wot-thing-description11</a></cite>]
is <code>undefined</code> then the Web Thing <em class=
"rfc2119">MAY</em> respond with either a <a href=
"#sync-action-response">Synchronous Action Response</a> or <a href=
"#async-action-response">Asynchronous Action
Response</a>.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-10">For
long-running actions which are not expected to finish executing
within the timeout period of an HTTP request (e.g. 30 to 120
seconds), it is <em class="rfc2119">RECOMMENDED</em> that a Web
Thing respond with an Asynchronous Action Response so that a
Consumer may continue to monitor the status of an action request
with a <code>queryaction</code> operation on a dynamically created
<code>ActionStatus</code> resource, after the initial
<code>invokeaction</code> response.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-11">For
short-lived actions which are expected to finish executing within
the timeout period of an HTTP request, a Web Thing <em class=
"rfc2119">MAY</em> wait until the action has completed to send a
Synchronous Action Response.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-12">If a Web
Thing encounters an error in attempting to execute an action before
responding to the <code>invokeaction</code> request, then it
<em class="rfc2119">MUST</em> send an Error Response.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-13">Conforming
Consumers <em class="rfc2119">MUST</em> support all three types of
response to the initial <code>invokeaction</code> request.</span>
<span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-14">After the
initial request, support for subsequent operations on an
<code>ActionStatus</code> resource is <em class=
"rfc2119">OPTIONAL</em>.</span></p>
<section id="actionstatus-object">
<div class="header-wrapper">
<h6 id="ActionStatus"><bdi class="secno">9.2.2.1.1</bdi>
<code>ActionStatus</code> object</h6>
<a class="self-link" href="#ActionStatus" aria-label=
"Permalink for Section 9.2.2.1.1"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-15">
<p>The status of an asynchronous action invocation request is
represented by an <code>ActionStatus</code> object which includes
the following members:</p>
<table class="def">
<thead>
<tr>
<th>Member</th>
<th>Description</th>
<th>Assignment</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="rfc2119-table-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-16">
<td><code>status</code></td>
<td>The status of the action request.</td>
<td>mandatory</td>
<td><a href=
"http://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#string"><code>
string</code></a> (one of <code>pending</code>,
<code>running</code>, <code>completed</code> or
<code>failed</code>)</td>
</tr>
<tr class="rfc2119-table-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-17">
<td><code>output</code></td>
<td>The output data, if any, of a completed action which <em class=
"rfc2119">MUST</em> conform with the <code>output</code> data
schema of the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#actionaffordance"><code>
ActionAffordance</code></a>.</td>
<td>optional</td>
<td>any type</td>
</tr>
<tr class="rfc2119-table-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-18">
<td><code>error</code></td>
<td>An error message, if any, associated with a failed action which
<em class="rfc2119">MUST</em> use the JSON serialization of the
Problem Details format [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-rfc7807" title=
"Problem Details for HTTP APIs">RFC7807</a></cite>] (only needed in
response to a <a href=
"#http-basic-profile-protocol-binding-queryaction"><code>queryaction</code></a>
operation).</td>
<td>optional</td>
<td><code>object</code></td>
</tr>
<tr class="rfc2119-table-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-19">
<td><code>href</code></td>
<td>The [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-url" title="URL Standard">URL</a></cite>] of an
<code>ActionStatus</code> resource which can be used by
<code>queryaction</code> and <code>cancelaction</code> operations,
the <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of which <em class="rfc2119">MUST</em> resolve to <code>http</code>
or <code>https</code> (only needed for an <a href=
"#async-action-response">Asynchronous Action Response</a>).</td>
<td>optional</td>
<td><code>string</code></td>
</tr>
<tr class="rfc2119-table-assertion">
<td><code>timeRequested</code></td>
<td>A timestamp indicating the time at which the Thing received the
request to execute the action. (See <a href="#date-format">Date
Format</a> for date format constraints).</td>
<td>optional</td>
<td><code>string</code></td>
</tr>
<tr class="rfc2119-table-assertion">
<td><code>timeEnded</code></td>
<td>A timestamp indicating the time at which the Thing successfully
completed executing the action, or failed to execute the action.
(See <a href="#date-format">Date Format</a> for date format
constraints).</td>
<td>optional</td>
<td><code>string</code></td>
</tr>
</tbody>
</table>
</div>
<div class="note" role="note" id="issue-container-generatedID-5">
<div role="heading" class="note-title marker" id="h-note-3"
aria-level="6"><span>Note</span></div>
<p class="">It is possible that a Thing's clock may not be set to
the correct time. If timings are important then a Consumer may
therefore choose to treat the <code>timeEnded</code> member of an
<code>ActionStatus</code> object as being relative to the
<code>timeRequested</code> member, but not necessarily as relative
to its own internal clock, or the clocks of other Things.</p>
</div>
</section>
<section id="synchronous-action-response">
<div class="header-wrapper">
<h6 id="sync-action-response"><bdi class="secno">9.2.2.1.2</bdi>
Synchronous Action Response</h6>
<a class="self-link" href="#sync-action-response" aria-label=
"Permalink for Section 9.2.2.1.2"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-20">
<p>If providing a Synchronous Action Response, a Web Thing
<em class="rfc2119">MUST</em> send an HTTP response with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body containing the output of the action, if any, serialized
in JSON</li>
</ul>
</div>
<div class="example" id="example-14">
<div class="marker"><a class="self-link" href="#example-14">Example
<bdi>14</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span><span class=
"hljs-punctuation">: </span>application/json</code></pre></div>
</section>
<section id="asynchronous-action-response">
<div class="header-wrapper">
<h6 id="async-action-response"><bdi class="secno">9.2.2.1.3</bdi>
Asynchronous Action Response</h6>
<a class="self-link" href="#async-action-response" aria-label=
"Permalink for Section 9.2.2.1.3"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-invokeaction-21">
<p>If providing an Asynchronous Action Response, a Web Thing
<em class="rfc2119">MUST</em> send an HTTP response containing the
URL of an <code>ActionStatus</code> resource, the <a href=
"https://tools.ietf.org/html/rfc3986#section-3.1">URI scheme</a>
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of which <em class="rfc2119">MUST</em> resolve to <code>http</code>
or <code>https</code>. The response <em class="rfc2119">MUST</em>
have:</p>
<ul>
<li>Status code set to <code>201</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li><code>Location</code> header set to the URL of the
<code>ActionStatus</code> resource</li>
<li>A body containing an <a href=
"#ActionStatus"><code>ActionStatus</code></a> object serialized in
JSON, with its <code>href</code> member set to the URL of the
<code>ActionStatus</code> resource</li>
</ul>
</div>
<div class="example" id="example-15">
<div class="marker"><a class="self-link" href="#example-15">Example
<bdi>15</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class=
"hljs-number">201</span> CREATED
<span class="hljs-attribute">Content</span>-Type: application/json
Location: /things/lamp/actions/fade/<span class=
"hljs-number">123</span>e4567-e89b-<span class=
"hljs-number">12</span>d3-a456-<span class=
"hljs-number">426655</span>
{
  <span class="hljs-string">"status"</span>: <span class=
"hljs-string">"pending"</span>,
  <span class="hljs-string">"href"</span>: <span class=
"hljs-string">"/things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655"</span>,
  <span class="hljs-string">"timeRequested"</span>: <span class=
"hljs-string">"2021-11-10T11:43:19.135Z"</span>
}</code></pre></div>
</section>
</section>
<section id="http-basic-profile-protocol-binding-queryaction">
<div class="header-wrapper">
<h5 id="x9-2-2-2-queryaction"><bdi class="secno">9.2.2.2</bdi>
<code>queryaction</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-queryaction" aria-label=
"Permalink for Section 9.2.2.2"></a></div>
<p>A <code>queryaction</code> operation is used to query the
current state of an ongoing action request.</p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-1a">A Web Thing
which provides <a href="#async-action-response">Asynchronous Action
Response</a>s to an <code>invokeaction</code> operation on an
<code>Action</code> <em class="rfc2119">MUST</em> also support
<code>queryaction</code> operations on that same
<code>Action</code>.</span> <span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-1b">A Web Thing
which only provides <a href="#sync-action-response">Synchronous
Action Response</a>s to an <code>invokeaction</code> operation on
an <code>Action</code> <em class="rfc2119">SHOULD NOT</em> support
<code>queryaction</code> operations on that same
<code>Action</code>.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-2">The URL of an
<code>ActionStatus</code> resource to be used in a
<code>queryaction</code> operation <em class="rfc2119">MUST</em> be
obtained from the <code>Location</code> header of an <a href=
"#async-action-response">Asynchronous Action Response</a>, or the
<code>href</code> member of the <code>ActionStatus</code> object in
its body.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-3">
<p>In order to query the status of an action request, a Consumer
<em class="rfc2119">MUST</em> send an HTTP request to a Web Thing
with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the <code>ActionStatus</code>
resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
</div>
<div class="example" id="example-16">
<div class="marker"><a class="self-link" href="#example-16">Example
<bdi>16</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs">GET /things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655
Host: mythingserver.com
Accept: application/json</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-5">
<p>If a Web Thing receives an HTTP request following the format
above and the Consumer has permission to query the corresponding
<code>ActionStatus</code> resource, then upon successfully reading
the status of the action request it <em class="rfc2119">MUST</em>
send an HTTP response with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body containing an <code>ActionStatus</code> object
representing the current status of the action request, serialized
in JSON</li>
</ul>
</div>
<div class="example" id="example-17">
<div class="marker"><a class="self-link" href="#example-17">Example
<bdi>17</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
{
  <span class="hljs-string">"status"</span>: <span class=
"hljs-string">"running"</span>,
  <span class="hljs-string">"timeRequested"</span>: <span class=
"hljs-string">"2021-11-10T11:43:19.135Z"</span>
}</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-7a">If the queried
action failed to execute, then the <code>status</code> member of
the <code>ActionStatus</code> object <em class="rfc2119">MUST</em>
be set to <code>"failed"</code>.</span> <span class=
"rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryaction-7b">If the queried
action failed to execute, then the <code>error</code> member
<em class="rfc2119">MAY</em> provide additional error information
conforming to the Problem Details format [<cite><a class="bibref"
data-link-type="biblio" href="#bib-rfc7807" title=
"Problem Details for HTTP APIs">RFC7807</a></cite>].</span></p>
<div class="example" id="example-18">
<div class="marker"><a class="self-link" href="#example-18">Example
<bdi>18</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
{
  <span class="hljs-string">"status"</span>: <span class=
"hljs-string">"failed"</span>,
  <span class="hljs-string">"error"</span>: {
    <span class="hljs-string">"type"</span>: <span class=
"hljs-string">"https://mythingserver.com/docs/errors/invalid-level"</span>,
    <span class="hljs-string">"title"</span>: <span class=
"hljs-string">"Invalid value for level provided"</span>,
    <span class="hljs-string">"invalid-params"</span>: [
      {
        <span class="hljs-string">"name"</span>: <span class=
"hljs-string">"level"</span>,
        <span class="hljs-string">"reason"</span>: <span class=
"hljs-string">"Must be a valid number between 0 and 100"</span>
      }
    ]
  },
  "timeRequested": <span class=
"hljs-string">"2021-11-10T11:43:19.135Z"</span>,
  <span class="hljs-string">"timeEnded"</span>: <span class=
"hljs-string">"2021-11-10T11:43:20.513Z"</span>
}</code></pre></div>
</section>
<section id="http-basic-profile-protocol-binding-cancelaction">
<div class="header-wrapper">
<h5 id="x9-2-2-3-cancelaction"><bdi class="secno">9.2.2.3</bdi>
<code>cancelaction</code></h5>
<a class="self-link" href=
"#http-basic-profile-protocol-binding-cancelaction" aria-label=
"Permalink for Section 9.2.2.3"></a></div>
<p>A <code>cancelaction</code> operation is used to cancel an
ongoing <code>Action</code> request.</p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-cancelaction-1a">A Web Thing
which provides <a href="#async-action-response">Asynchronous Action
Response</a>s to an <code>invokeaction</code> operation on an
<code>Action</code> <em class="rfc2119">MAY</em> also support
<code>cancelaction</code> operations on that same
<code>Action</code>.</span> <span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-cancelaction-1b">A Web Thing
which only provides <a href="#sync-action-response">Synchronous
Action Response</a>s to an <code>invokeaction</code> operation on
an <code>Action</code> <em class="rfc2119">SHOULD NOT</em> support
<code>cancelaction</code> operations on that same
<code>Action</code>.</span></p>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-cancelaction-2">The URL of an
<code>ActionStatus</code> resource to be used in a
<code>cancelaction</code> operation <em class="rfc2119">MUST</em>
be obtained from the <code>Location</code> header of an <a href=
"#async-action-response">Asynchronous Action Response</a>, or the
<code>href</code> member of the <code>ActionStatus</code> object in
its body.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-cancelaction-3">
<p>In order to cancel an action request, a Consumer <em class=
"rfc2119">MUST</em> send an HTTP request to a Web Thing with:</p>
<ul>
<li>Method set to <code>DELETE</code></li>
<li>URL set to the URL of the <code>ActionStatus</code>
resource</li>
</ul>
</div>
<div class="example" id="example-19">
<div class="marker"><a class="self-link" href="#example-19">Example
<bdi>19</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">DELETE</span> <span class=
"hljs-string">/things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-cancelaction-5">
<p>If a Web Thing receives an HTTP request following the format
above and the Consumer has permission to cancel the corresponding
<code>Action</code> request, then upon successfully cancelling
<code>Action</code> it <em class="rfc2119">MUST</em> send an HTTP
response with:</p>
<ul>
<li>Status code set to <code>204</code></li>
</ul>
</div>
<div class="example" id="example-20">
<div class="marker"><a class="self-link" href="#example-20">Example
<bdi>20</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class=
"hljs-number">204</span> No Content</code></pre></div>
</section>
<section id="queryallactions">
<div class="header-wrapper">
<h5 id="x9-2-2-4-queryallactions"><bdi class="secno">9.2.2.4</bdi>
<code>queryallactions</code></h5>
<a class="self-link" href="#queryallactions" aria-label=
"Permalink for Section 9.2.2.4"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryallactions-1">
<p>The URL of an <code>Actions</code> resource to be used when
querying the status of all ongoing action requests <em class=
"rfc2119">MUST</em> be obtained from a Thing Description by
locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the top level <a href=
"https://www.w3.org/TR/wot-thing-description11/#form-serialization-json">
<code>forms</code></a> member for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>queryallactions</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryallactions-3">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the
<code>Actions</code> resource.</span></p>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryallactions-4">
<p>In order to query the status of all ongoing action requests, a
Consumer <em class="rfc2119">MUST</em> send an HTTP request to a
Web Thing with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the <code>Actions</code> resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
</div>
<div class="example" id="example-21">
<div class="marker"><a class="self-link" href="#example-21">Example
<bdi>21</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/actions</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>application/json</code></pre></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryallactions-6a">
<p>If a Web Thing receives an HTTP request following the format
above, then upon successfully retreiving the status of all ongoing
action requests to which the Consumer has permission to access, it
<em class="rfc2119">MUST</em> send an HTTP response with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li>A body containing an object, keyed by <code>Action</code> name,
with the value of each object member being an array of <a href=
"#ActionStatus"><code>ActionStatus</code></a> objects representing
the action requests, serialized in JSON.</li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-queryallactions-6b">Each array
in the result object <em class="rfc2119">MUST</em> be sorted in
reverse chronological order such that the most recent action
request appears first.</span></p>
<div class="example" id="example-22">
<div class="marker"><a class="self-link" href="#example-22">Example
<bdi>22</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
{
  <span class="hljs-string">"fade"</span>: [
    {
      <span class="hljs-string">"status"</span>: <span class=
"hljs-string">"completed"</span>,
      <span class="hljs-string">"href"</span>: <span class=
"hljs-string">"/things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655"</span>,
      <span class=
"hljs-string">"timeRequested"</span>: <span class="hljs-string">"2021-11-10T11:43:19.135Z"</span>,
      <span class="hljs-string">"timeEnded"</span>: <span class=
"hljs-string">"2021-11-10T11:43:20.513Z"</span>
    },
    {
      "status": <span class="hljs-string">"failed"</span>,
      <span class="hljs-string">"href"</span>: <span class=
"hljs-string">"/things/lamp/actions/fade/123e4567-e89b-12d3-a456-558329"</span>,
      <span class=
"hljs-string">"timeRequested"</span>: <span class="hljs-string">"2021-11-10T11:42:15.133Z"</span>,
      <span class="hljs-string">"timeEnded"</span>: <span class=
"hljs-string">"2021-11-10T11:42:22.524Z"</span>
    },
    {
      "status": <span class="hljs-string">"running"</span>,
      <span class="hljs-string">"href"</span>: <span class=
"hljs-string">"/things/lamp/actions/fade/123e4567-e89b-12d3-a457-434656"</span>,
      <span class=
"hljs-string">"timeRequested"</span>: <span class="hljs-string">"2021-11-10T11:41:53.351Z"</span>
    },
    {
      "status": <span class="hljs-string">"pending"</span>,
      <span class="hljs-string">"href"</span>: <span class=
"hljs-string">"/things/lamp/actions/fade/123e4567-e89b-12d3-a457-ea9519"</span>,
      <span class=
"hljs-string">"timeRequested"</span>: <span class="hljs-string">"2021-11-10T11:39:53.651Z"</span>
    }
  ]
}</code></pre></div>
</section>
<div class="note" role="note" id="issue-container-generatedID-6">
<div role="heading" class="note-title marker" id="h-note-4"
aria-level="5"><span>Note</span><span class="issue-label">:
Retention of ActionStatus objects</span></div>
<section class="">When an <code>Action</code> request is cancelled
with a <code>cancelaction</code> operation, its
<code>ActionStatus</code> object is deleted and need not be
retained. For all other <code>Action</code> requests it is assumed
that a Web Thing will store the <code>ActionStatus</code> object so
that its status may later be queried with a
<code>queryaction</code> or <code>queryallactions</code> operation.
It is not expected that <code>ActionStatus</code> objects should be
retained indefinitely, they may be stored in volatile memory and/or
periodically pruned. The length of time for which to retain
<code>ActionStatus</code> objects is expected to be
implementation-specific and may depend on application-specific
requirements or resource constraints.</section>
</div>
</section>
</section>
</section>
<section id="sec-http-sse-profile" class="informative">
<div class="header-wrapper">
<h2 id="x10-http-sse-profile"><bdi class="secno">10.</bdi> HTTP SSE
Profile</h2>
<a class="self-link" href="#sec-http-sse-profile" aria-label=
"Permalink for Section 10."></a></div>
<p><em>This section is non-normative.</em></p>
<p>This section defines the HTTP SSE Profile, including a <a href=
"#http-sse-profile-protocol-binding">Protocol Binding</a> for
observing properties and listening for events using Server-Sent
Events [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</p>
<p>This profile may be used in conjunction with the <a href=
"#http-basic-profile">HTTP Basic Profile</a> in order to provide
operations to read and write properties and invoke, query and
cancel actions.</p>
<p><span class="rfc2119-assertion" id="http-sse-profile-1">In order
to conform with the HTTP SSE Profile, Web Things and Consumers
<em class="rfc2119">MUST</em> also conform with all of the
assertions in the <a href="#common-constraints">Common
Constraints</a> section.</span></p>
<section id="http-sse-profile-identifier">
<div class="header-wrapper">
<h3 id="x10-1-identifier"><bdi class="secno">10.1</bdi>
Identifier</h3>
<a class="self-link" href="#http-sse-profile-identifier"
aria-label="Permalink for Section 10.1"></a></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-identifier-1">In order to denote that a given
<a href="https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web
Thing</a> conforms to the HTTP SSE Profile, its Thing Description
<em class="rfc2119">MUST</em> have a <a href=
"https://www.w3.org/TR/wot-thing-description11/#thing"><code>profile</code></a>
member [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-thing-description" title=
"Web of Things (WoT) Thing Description">wot-thing-description</a></cite>]
with a value of
<code>https://www.w3.org/2022/wot/profile/http-sse/v1</code>.</span></p>
</section>
<section id="http-sse-profile-protocol-binding">
<div class="header-wrapper">
<h3 id="x10-2-protocol-binding"><bdi class="secno">10.2</bdi>
Protocol Binding</h3>
<a class="self-link" href="#http-sse-profile-protocol-binding"
aria-label="Permalink for Section 10.2"></a></div>
<p>This section defines a protocol binding which describes how a
<a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-consumer">Consumer</a>
communicates with a <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web Thing</a>
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-architecture11" title=
"Web of Things (WoT) Architecture 1.1">wot-architecture11</a></cite>]
using Server-Sent Events [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-1">A Consumer or Web Thing
conforming to the HTTP SSE Profile <em class="rfc2119">MUST</em>
implement this protocol binding.</span></p>
<p>The examples provided throughout this section describe how a
Consumer would communicate with a Web Thing which produces the
following Thing Description:</p>
<div class="example" id="example-23">
<div class="marker"><a class="self-link" href="#example-23">Example
<bdi>23</bdi></a></div>
<pre aria-busy="false"><code class="hljs json">{
  <span class="hljs-attr">"@context"</span>: <span class=
"hljs-string">"https://www.w3.org/2022/wot/td/v1.1"</span>,
  <span class="hljs-attr">"id"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/things/lamp"</span>,
  <span class="hljs-attr">"profile"</span>: [
    <span class=
"hljs-string">"https://www.w3.org/2022/wot/profile/http-basic/v1"</span>,
    <span class=
"hljs-string">"https://www.w3.org/2022/wot/profile/http-sse/v1"</span>,
  ],
  <span class="hljs-attr">"base"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/things/lamp/"</span>,
  <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"My Lamp"</span>,
  <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"A web connected lamp"</span>,
  <span class="hljs-attr">"securityDefinitions"</span>: {
    <span class="hljs-attr">"oauth2"</span>: {
      <span class="hljs-attr">"scheme"</span>: <span class=
"hljs-string">"oauth2"</span>,
      <span class="hljs-attr">"flow"</span>: <span class=
"hljs-string">"code"</span>,
      <span class="hljs-attr">"authorization"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/oauth/authorize"</span>,
      <span class="hljs-attr">"token"</span>: <span class=
"hljs-string">"https://mywebthingserver.com/oauth/token"</span>
    }
  },
  <span class="hljs-attr">"security"</span>: <span class=
"hljs-string">"oauth2"</span>,
  <span class="hljs-attr">"properties"</span>: {
    <span class="hljs-attr">"on"</span>: {
      <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"boolean"</span>,
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"On/Off"</span>,
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"Whether the lamp is turned on"</span>,
      <span class="hljs-attr">"forms"</span>: [{<span class=
"hljs-attr">"href"</span>: <span class=
"hljs-string">"properties/on"</span>}]
    },
    <span class="hljs-attr">"level"</span> : {
      <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"integer"</span>,
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Brightness"</span>,
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"The level of light from 0-100"</span>,
      <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"percent"</span>,
      <span class="hljs-attr">"minimum"</span> : <span class=
"hljs-number">0</span>,
      <span class="hljs-attr">"maximum"</span> : <span class=
"hljs-number">100</span>,
      <span class="hljs-attr">"forms"</span>: [{<span class=
"hljs-attr">"href"</span>: <span class=
"hljs-string">"properties/level"</span>}]
    }
  },
  <span class="hljs-attr">"actions"</span>: {
    <span class="hljs-attr">"fade"</span>: {
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Fade"</span>,
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"Fade the lamp to a given level"</span>,
      <span class="hljs-attr">"input"</span>: {
        <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"object"</span>,
        <span class="hljs-attr">"properties"</span>: {
          <span class="hljs-attr">"level"</span>: {
            <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Brightness"</span>,
            <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"integer"</span>,
            <span class="hljs-attr">"minimum"</span>: <span class=
"hljs-number">0</span>,
            <span class="hljs-attr">"maximum"</span>: <span class=
"hljs-number">100</span>,
            <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"percent"</span>
          },
          <span class="hljs-attr">"duration"</span>: {
            <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Duration"</span>,
            <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"integer"</span>,
            <span class="hljs-attr">"minimum"</span>: <span class=
"hljs-number">0</span>,
            <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"milliseconds"</span>
          }
        }
      },
      <span class="hljs-attr">"forms"</span>: [{<span class=
"hljs-attr">"href"</span>: <span class=
"hljs-string">"actions/fade"</span>}]
    }
  },
  <span class="hljs-attr">"events"</span>: {
    <span class="hljs-attr">"overheated"</span>: {
      <span class="hljs-attr">"title"</span>: <span class=
"hljs-string">"Overheated"</span>,
      <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"type"</span>: <span class=
"hljs-string">"number"</span>,
        <span class="hljs-attr">"unit"</span>: <span class=
"hljs-string">"degree celsius"</span>
      },
      <span class="hljs-attr">"description"</span>: <span class=
"hljs-string">"The lamp has exceeded its safe operating temperature"</span>,
      <span class="hljs-attr">"forms"</span>: [{
        <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"events/overheated"</span>,
        <span class="hljs-attr">"subprotocol"</span>: <span class=
"hljs-string">"sse"</span>
      }]
    }
  },
  <span class="hljs-attr">"forms"</span>: [
    {
      <span class="hljs-attr">"op"</span>: [<span class=
"hljs-string">"readallproperties"</span>, <span class=
"hljs-string">"writemultipleproperties"</span>],
      <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"properties"</span>
    },
    {
      <span class="hljs-attr">"op"</span>: [<span class=
"hljs-string">"observeallproperties"</span>, <span class=
"hljs-string">"unobserveallproperties"</span>],
      <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"properties"</span>,
      <span class="hljs-attr">"subprotocol"</span>: <span class=
"hljs-string">"sse"</span>
    },
    {
      <span class="hljs-attr">"op"</span>: <span class=
"hljs-string">"queryallactions"</span>,
      <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"actions"</span>
    },
    {
      <span class="hljs-attr">"op"</span>: [<span class=
"hljs-string">"subscribeallevents"</span>, <span class=
"hljs-string">"unsubscribeallevents"</span>],
      <span class="hljs-attr">"href"</span>: <span class=
"hljs-string">"events"</span>,
      <span class="hljs-attr">"subprotocol"</span>: <span class=
"hljs-string">"sse"</span>
    }
  ]
}</code></pre></div>
<section id="http-sse-profile-protocol-binding-properties">
<div class="header-wrapper">
<h4 id="x10-2-1-properties"><bdi class="secno">10.2.1</bdi>
Properties</h4>
<a class="self-link" href=
"#http-sse-profile-protocol-binding-properties" aria-label=
"Permalink for Section 10.2.1"></a></div>
<section id="observeproperty">
<div class="header-wrapper">
<h5 id="x10-2-1-1-observeproperty"><bdi class=
"secno">10.2.1.1</bdi> <code>observeproperty</code></h5>
<a class="self-link" href="#observeproperty" aria-label=
"Permalink for Section 10.2.1.1"></a></div>
<div class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-1">
<p>The URL of a <code>Property</code> resource to be used when
observing the value of a property <em class="rfc2119">MUST</em> be
obtained from a Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#propertyaffordance">
<code>PropertyAffordance</code></a> for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>observeproperty</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
<li>Its <code>subprotocol</code> member has a value of
<code>sse</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-2">The resolved
value of the <code>href</code> member <em class="rfc2119">MUST</em>
then be used as the URL of the <code>Property</code>
resource.</span></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-3">In order to
observe a property, a Consumer <em class="rfc2119">MUST</em> follow
the Server-Sent Events [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to open
a connection with the Web Thing at the URL of the
<code>Property</code> resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the <code>Property</code> resource</li>
<li><code>Accept</code> header set to
<code>text/event-stream</code></li>
<li><code>Connection</code> header set to
<code>keep-alive</code></li>
</ul>
<div class="example" id="example-24">
<div class="marker"><a class="self-link" href="#example-24">Example
<bdi>24</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/properties/level</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>text/event-stream
<span class="hljs-attribute">Connection</span><span class=
"hljs-punctuation">: </span>keep-alive</code></pre></div>
<div class="note" role="note" id="issue-container-generatedID-7">
<div role="heading" class="note-title marker" id="h-note-5"
aria-level="6"><span>Note</span><span class="issue-label">: Opening
a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be initiated using the <code>EventSource</code>
constructor.</p>
</div>
<div class="example" id="example-25">
<div class="marker"><a class="self-link" href="#example-25">Example
<bdi>25</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript"><span class=
"hljs-keyword">const</span> levelSource = <span class=
"hljs-keyword">new</span> EventSource(<span class=
"hljs-string">'/things/lamp/properties/level'</span>);</code></pre></div>
<p></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-4">If a Web
Thing receives an HTTP request following the format above and the
Consumer has permission to observe the corresponding property, then
it <em class="rfc2119">MUST</em> follow the Server-Sent Events
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to
maintain an open connection with the Consumer and push a property
value to the Consumer each time the value of the specified property
changes.</span></p>
<p>This involves the Web Thing initially sending an HTTP response
to the Consumer with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>text/event-stream</code></li>
</ul>
<div class="example" id="example-26">
<div class="marker"><a class="self-link" href="#example-26">Example
<bdi>26</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span><span class=
"hljs-punctuation">: </span>text/event-stream</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-5a">Whenever the
value of the specified property changes while the Web Thing has an
open connection with a Consumer, the Web Thing <em class=
"rfc2119">MUST</em> send a property value to the Consumer using the
event stream format in the Server-Sent Events [<cite><a class=
"bibref" data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification.</span>
<span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-5b">For each
message sent, the Web Thing <em class="rfc2119">MUST</em> set the
<code>event</code> field to the name of the
<code>PropertyAffordance</code> and populate the <code>data</code>
field with the property value, serialized in JSON and following the
data schema specified in the
<code>PropertyAffordance</code>.</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-5c">The
<code>id</code> field <em class="rfc2119">SHOULD</em> be set to a
unique identifier for the property change, for use when
re-establishing a dropped connection (see below).</span>
<span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-5d">It is
<em class="rfc2119">RECOMMENDED</em> that the identifier is a
timestamp representing the time at which the property
changed</span> (see <a href="#date-format">Date Format</a> for date
format constraints).</p>
<div class="example" id="example-27">
<div class="marker"><a class="self-link" href="#example-27">Example
<bdi>27</bdi></a></div>
<pre aria-busy="false"><code class="hljs">event: level\n
data: 42\n
id: 2021-11-17T15:33:20.827Z\n\n</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-6a">If the
connection between the Consumer and Web Thing drops (except as a
result of the <code>unobserve</code> operation defined below), the
Consumer <em class="rfc2119">MUST</em> re-establish the connection
following the steps outlined in the Server-Sent Events
specification [<cite><a class="bibref" data-link-type="biblio"
href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeproperty-6b">Once the
connection is re-established the Web Thing <em class=
"rfc2119">SHOULD</em>, if possible, send any missed property
changes which occurred since the last change specified by the
Consumer in a <code>Last-Event-ID</code> header.</span></p>
</section>
<section id="unobserveproperty">
<div class="header-wrapper">
<h5 id="x10-2-1-2-unobserveproperty"><bdi class=
"secno">10.2.1.2</bdi> <code>unobserveproperty</code></h5>
<a class="self-link" href="#unobserveproperty" aria-label=
"Permalink for Section 10.2.1.2"></a></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-unobserveproperty-1">In order to
stop observing a property, a Consumer <em class="rfc2119">MUST</em>
terminate the corresponding Server-Sent Events connection with the
Web Thing as specified in the Server-Sent Events specification
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span></p>
<div class="note" role="note" id="issue-container-generatedID-8">
<div role="heading" class="note-title marker" id="h-note-6"
aria-level="6"><span>Note</span><span class="issue-label">:
Terminating a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be terminated using the <code>close()</code> method
on an <code>EventSource</code> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] object.</p>
</div>
<div class="example" id="example-28">
<div class="marker"><a class="self-link" href="#example-28">Example
<bdi>28</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs abnf">levelSource.close()<span class=
"hljs-comment">;</span></code></pre></div>
<p></p>
</section>
<section id="observeallproperties">
<div class="header-wrapper">
<h5 id="x10-2-1-3-observeallproperties"><bdi class=
"secno">10.2.1.3</bdi> <code>observeallproperties</code></h5>
<a class="self-link" href="#observeallproperties" aria-label=
"Permalink for Section 10.2.1.3"></a></div>
<div class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-1">
<p>The URL of a properties resource to be used when observing
changes to all properties of a Web Thing <em class=
"rfc2119">MUST</em> be obtained from a Thing Description by
locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the top level <a href=
"https://www.w3.org/TR/wot-thing-description11/#form-serialization-json">
<code>forms</code></a> member of a Thing Description for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>observeallproperties</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
<li>Its <code>subprotocol</code> member has a value of
<code>sse</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-2">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the properties
resource.</span></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-3">In order
to observe changes to all properties of a Web Thing, a Consumer
<em class="rfc2119">MUST</em> follow the Server-Sent Events
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to open
a connection with the Web Thing at the URL of the properties
resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the properties resource</li>
<li><code>Accept</code> header set to
<code>text/event-stream</code></li>
<li><code>Connection</code> header set to
<code>keep-alive</code></li>
</ul>
<div class="example" id="example-29">
<div class="marker"><a class="self-link" href="#example-29">Example
<bdi>29</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/properties</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>text/event-stream
<span class="hljs-attribute">Connection</span><span class=
"hljs-punctuation">: </span>keep-alive</code></pre></div>
<div class="note" role="note" id="issue-container-generatedID-9">
<div role="heading" class="note-title marker" id="h-note-7"
aria-level="6"><span>Note</span><span class="issue-label">: Opening
a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be initiated using the <code>EventSource</code>
constructor.</p>
</div>
<div class="example" id="example-30">
<div class="marker"><a class="self-link" href="#example-30">Example
<bdi>30</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript"><span class=
"hljs-keyword">const</span> lampPropertiesSource = <span class=
"hljs-keyword">new</span> EventSource(<span class=
"hljs-string">'/things/lamp/properties'</span>);</code></pre></div>
<p></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-4">If a Web
Thing receives an HTTP request following the format above then it
<em class="rfc2119">MUST</em> follow the Server-Sent Events
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to
maintain an open connection with the Consumer and push new property
values to the Consumer for all properties for which it has
permission to observe.</span></p>
<p>This involves the Web Thing initially sending an HTTP response
to the Consumer with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>text/event-stream</code></li>
</ul>
<div class="example" id="example-31">
<div class="marker"><a class="self-link" href="#example-31">Example
<bdi>31</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span><span class=
"hljs-punctuation">: </span>text/event-stream</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-5a">Whenever
a property changes while the Web Thing has an open connection with
a Consumer, the Web Thing <em class="rfc2119">MUST</em> send the
new property value to the Consumer using the event stream format in
the Server-Sent Events [<cite><a class="bibref" data-link-type=
"biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification.</span>
<span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-5b">For
each message sent, the Web Thing <em class="rfc2119">MUST</em> set
the <code>event</code> field to the name of the
<code>PropertyAffordance</code> and populate the <code>data</code>
field with the new property value.</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-5c">The
property data <em class="rfc2119">MUST</em> follow the data schema
specified in the <code>PropertyAffordance</code> and <em class=
"rfc2119">MUST</em> be serialized in JSON.</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-5d">The
<code>id</code> field <em class="rfc2119">SHOULD</em> be set to a
unique identifier for the event, for use when re-establishing a
dropped connection (see below).</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-5e">It is
<em class="rfc2119">RECOMMENDED</em> that the identifier is a
timestamp representing the time at which the property
changed</span> (see <a href="#date-format">Date Format</a> for date
format constraints).</p>
<div class="example" id="example-32">
<div class="marker"><a class="self-link" href="#example-32">Example
<bdi>32</bdi></a></div>
<pre aria-busy="false"><code class="hljs">event: level\n
data: 42\n
id: 2021-11-17T15:33:20.827Z\n\n</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-6a">If the
connection between the Consumer and Web Thing drops (except as a
result of the <code>unobserveallproperties</code> operation defined
below), the Consumer <em class="rfc2119">MUST</em> re-establish the
connection following the steps outlined in the Server-Sent Events
specification [<cite><a class="bibref" data-link-type="biblio"
href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-observeallproperties-6b">Once
the connection is re-established the Web Thing <em class=
"rfc2119">SHOULD</em>, if possible, send any missed property
changes which occurred since the last change specified by the
Consumer in a <code>Last-Event-ID</code> header.</span></p>
</section>
<section id="unobserveallproperties">
<div class="header-wrapper">
<h5 id="x10-2-1-4-unobserveallproperties"><bdi class=
"secno">10.2.1.4</bdi> <code>unobserveallproperties</code></h5>
<a class="self-link" href="#unobserveallproperties" aria-label=
"Permalink for Section 10.2.1.4"></a></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-unobserveallproperties-1">In
order to unobserve all properties, a Consumer <em class=
"rfc2119">MUST</em> terminate the corresponding Server-Sent Events
connection with the properties endpoint of the Web Thing, following
the steps specified in the Server-Sent Events specification
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span></p>
<div class="note" role="note" id="issue-container-generatedID-10">
<div role="heading" class="note-title marker" id="h-note-8"
aria-level="6"><span>Note</span><span class="issue-label">:
Terminating a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be terminated using the <code>close()</code> method
on an <code>EventSource</code> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] object.</p>
</div>
<div class="example" id="example-33">
<div class="marker"><a class="self-link" href="#example-33">Example
<bdi>33</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs abnf">lampPropertiesSource.close()<span class=
"hljs-comment">;</span></code></pre></div>
<p></p>
</section>
</section>
<section id="http-sse-profile-protocol-binding-events">
<div class="header-wrapper">
<h4 id="x10-2-2-events"><bdi class="secno">10.2.2</bdi> Events</h4>
<a class="self-link" href=
"#http-sse-profile-protocol-binding-events" aria-label=
"Permalink for Section 10.2.2"></a></div>
<p>The HTTP SSE Profile uses Server-Sent Events [<cite><a class=
"bibref" data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] as a mechanism for
Consumers to subscribe to events emitted by a Web Thing.</p>
<div class="note" role="note" id="issue-container-generatedID-11">
<div role="heading" class="note-title marker" id="h-note-9"
aria-level="5"><span>Note</span></div>
<p class="">Consumers are not required to implement the <a href=
"https://www.w3.org/TR/eventsource/#the-eventsource-interface"><code>
EventSource</code> JavaScript API</a> from the Server-Sent Events
specification in order to conform with this profile. Any
programming language may be used to consume an event stream.</p>
</div>
<section id="http-sse-profile-protocol-binding-subscribeevent">
<div class="header-wrapper">
<h5 id="x10-2-2-1-subscribeevent"><bdi class="secno">10.2.2.1</bdi>
<code>subscribeevent</code></h5>
<a class="self-link" href=
"#http-sse-profile-protocol-binding-subscribeevent" aria-label=
"Permalink for Section 10.2.2.1"></a></div>
<div class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-1">
<p>The URL of an <code>Event</code> resource to be used when
subscribing to an event <em class="rfc2119">MUST</em> be obtained
from a Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#eventaffordance"><code>
EventAffordance</code></a> for which:</p>
<ul>
<li>After defaults have been applied, its <code>op</code> member
contains the value <code>subscribeevent</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
<li>Its <code>subprotocol</code> member has a value of
<code>sse</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-3">The resolved
value of the <code>href</code> member <em class="rfc2119">MUST</em>
then be used as the URL of the <code>Event</code>
resource.</span></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-4">In order to
subscribe to an event, a Consumer <em class="rfc2119">MUST</em>
follow the Server-Sent Events [<cite><a class="bibref"
data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to open
a connection with the Web Thing at the URL of the
<code>Event</code> resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the <code>Event</code> resource</li>
<li><code>Accept</code> header set to
<code>text/event-stream</code></li>
<li><code>Connection</code> header set to
<code>keep-alive</code></li>
</ul>
<div class="example" id="example-34">
<div class="marker"><a class="self-link" href="#example-34">Example
<bdi>34</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/events/overheated</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>text/event-stream
<span class="hljs-attribute">Connection</span><span class=
"hljs-punctuation">: </span>keep-alive</code></pre></div>
<div class="note" role="note" id="issue-container-generatedID-12">
<div role="heading" class="note-title marker" id="h-note-10"
aria-level="6"><span>Note</span><span class="issue-label">: Opening
a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be initiated using the <code>EventSource</code>
constructor.</p>
</div>
<div class="example" id="example-35">
<div class="marker"><a class="self-link" href="#example-35">Example
<bdi>35</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript"><span class=
"hljs-keyword">const</span> overheatedEventSource = <span class=
"hljs-keyword">new</span> EventSource(<span class=
"hljs-string">'/things/lamp/events/overheated'</span>);</code></pre></div>
<p></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-5">If a Web Thing
receives an HTTP request following the format above and the
Consumer has permission to subscribe to the corresponding event,
then it <em class="rfc2119">MUST</em> follow the Server-Sent Events
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to
maintain an open connection with the Consumer and push event data
to the Consumer as events of the specified type are
emitted.</span></p>
<p>This involves the Web Thing initially sending an HTTP response
to the Consumer with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>text/event-stream</code></li>
</ul>
<div class="example" id="example-36">
<div class="marker"><a class="self-link" href="#example-36">Example
<bdi>36</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span><span class=
"hljs-punctuation">: </span>text/event-stream</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-6a">Whenever an
event of the specified type occurs while the Web Thing has an open
connection with a Consumer, the Web Thing <em class=
"rfc2119">MUST</em> send event data to the Consumer using the event
stream format in the Server-Sent Events [<cite><a class="bibref"
data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification.</span>
<span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-6b">For each
message sent, the Web Thing <em class="rfc2119">MUST</em> set the
<code>event</code> field to the name of the
<code>EventAffordance</code> and populate the <code>data</code>
field with event data, if any.</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-6c">The event
data <em class="rfc2119">MUST</em> follow the data schema specified
in the <code>EventAffordance</code> and be serialized in
JSON.</span> <span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-6d">The
<code>id</code> field <em class="rfc2119">SHOULD</em> be set to a
unique identifier for the event, for use when re-establishing a
dropped connection (see below).</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-6e">It is
<em class="rfc2119">RECOMMENDED</em> that the identifier is a
timestamp representing the time at which the event ocurred</span>
(see <a href="#date-format">Date Format</a> for date format
constraints).</p>
<div class="example" id="example-37">
<div class="marker"><a class="self-link" href="#example-37">Example
<bdi>37</bdi></a></div>
<pre aria-busy="false"><code class="hljs">event: overheated\n
data: 90\n
id: 2021-11-16T16:53:50.817Z\n\n</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-7a">If the
connection between the Consumer and Web Thing drops (except as a
result of the <code>unsubscribe</code> operation defined below),
the Consumer <em class="rfc2119">MUST</em> re-establish the
connection following the steps outlined in the Server-Sent Events
specification [<cite><a class="bibref" data-link-type="biblio"
href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeevent-7b">Once the
connection is re-established the Web Thing <em class=
"rfc2119">SHOULD</em>, if possible, send any missed events which
occurred since the last event specified by the Consumer in a
<code>Last-Event-ID</code> header.</span></p>
</section>
<section id=
"http-sse-profile-protocol-binding-events-unsubscribeevent">
<div class="header-wrapper">
<h5 id="x10-2-2-2-unsubscribeevent"><bdi class=
"secno">10.2.2.2</bdi> <code>unsubscribeevent</code></h5>
<a class="self-link" href=
"#http-sse-profile-protocol-binding-events-unsubscribeevent"
aria-label="Permalink for Section 10.2.2.2"></a></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-unsubscribeevent-1">In order to
unsubscribe from an event, a Consumer <em class="rfc2119">MUST</em>
terminate the corresponding Server-Sent Events connection with the
Web Thing as specified in the Server-Sent Events specification
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span></p>
<div class="note" role="note" id="issue-container-generatedID-13">
<div role="heading" class="note-title marker" id="h-note-11"
aria-level="6"><span>Note</span><span class="issue-label">:
Terminating a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be terminated using the <code>close()</code> method
on an <code>EventSource</code> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] object.</p>
</div>
<div class="example" id="example-38">
<div class="marker"><a class="self-link" href="#example-38">Example
<bdi>38</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs abnf">overheatedEventSource.close()<span class=
"hljs-comment">;</span></code></pre></div>
</section>
<section id=
"http-sse-profile-protocol-binding-events-subscribeallevents">
<div class="header-wrapper">
<h5 id="x10-2-2-3-subscribeallevents"><bdi class=
"secno">10.2.2.3</bdi> <code>subscribeallevents</code></h5>
<a class="self-link" href=
"#http-sse-profile-protocol-binding-events-subscribeallevents"
aria-label="Permalink for Section 10.2.2.3"></a></div>
<div class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-1">
<p>The URL of an events resource to be used when subscribing to all
events emitted by a Web Thing <em class="rfc2119">MUST</em> be
obtained from a Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the top level <a href=
"https://www.w3.org/TR/wot-thing-description11/#form-serialization-json">
<code>forms</code></a> member of a Thing Description for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>subscribeallevents</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
<li>Its <code>subprotocol</code> member has a value of
<code>sse</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-3b">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the events
resource.</span></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-4">In order
to subscribe to all events emitted by a Web Thing, a Consumer
<em class="rfc2119">MUST</em> follow the Server-Sent Events
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to open
a connection with the Web Thing at the URL of the events
resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>GET</code></li>
<li>URL set to the URL of the events resource</li>
<li><code>Accept</code> header set to
<code>text/event-stream</code></li>
<li><code>Connection</code> header set to
<code>keep-alive</code></li>
</ul>
<div class="example" id="example-39">
<div class="marker"><a class="self-link" href="#example-39">Example
<bdi>39</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">GET</span> <span class=
"hljs-string">/things/lamp/events</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>text/event-stream
<span class="hljs-attribute">Connection</span><span class=
"hljs-punctuation">: </span>keep-alive</code></pre></div>
<div class="note" role="note" id="issue-container-generatedID-14">
<div role="heading" class="note-title marker" id="h-note-12"
aria-level="6"><span>Note</span><span class="issue-label">: Opening
a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be initiated using the <code>EventSource</code>
constructor.</p>
</div>
<div class="example" id="example-40">
<div class="marker"><a class="self-link" href="#example-40">Example
<bdi>40</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript"><span class=
"hljs-keyword">const</span> lampEventsSource = <span class=
"hljs-keyword">new</span> EventSource(<span class=
"hljs-string">'/things/lamp/events'</span>);</code></pre></div>
<p></p>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-3">If a Web
Thing receives an HTTP request following the format above then it
<em class="rfc2119">MUST</em> follow the Server-Sent Events
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification to
maintain an open connection with the Consumer and push event data
to the Consumer for all event types for which it has permission to
subscribe.</span></p>
<p>This involves the Web Thing initially sending an HTTP response
to the Consumer with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>text/event-stream</code></li>
</ul>
<div class="example" id="example-41">
<div class="marker"><a class="self-link" href="#example-41">Example
<bdi>41</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span><span class=
"hljs-punctuation">: </span>text/event-stream</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-4a">Whenever
an event occurs while the Web Thing has an open connection with a
Consumer, the Web Thing <em class="rfc2119">MUST</em> send event
data to the Consumer using the event stream format in the
Server-Sent Events [<cite><a class="bibref" data-link-type="biblio"
href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] specification.</span>
<span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-4b">For each
message sent, the Web Thing <em class="rfc2119">MUST</em> set the
<code>event</code> field to the name of the
<code>EventAffordance</code> and populate the <code>data</code>
field with event data, if any.</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-4c">The event
data <em class="rfc2119">MUST</em> follow the data schema specified
in the <code>EventAffordance</code> and be serialized in
JSON.</span> <span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-4d">The
<code>id</code> field <em class="rfc2119">SHOULD</em> be set to a
unique identifier for the event, for use when re-establishing a
dropped connection (see below).</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-4e">It is
<em class="rfc2119">RECOMMENDED</em> that the identifier is a
timestamp representing the time at which the event ocurred</span>
(see <a href="#date-format">Date Format</a> for date format
constraints).</p>
<div class="example" id="example-42">
<div class="marker"><a class="self-link" href="#example-42">Example
<bdi>42</bdi></a></div>
<pre aria-busy="false"><code class="hljs">event: overheated\n
data: 90\n
id: 2021-11-16T16:53:50.817Z\n\n</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-5a">If the
connection between the Consumer and Web Thing drops (except as a
result of the <code>unsubscribeallevents</code> operation defined
below), the Consumer <em class="rfc2119">MUST</em> re-establish the
connection following the steps outlined in the Server-Sent Events
specification [<cite><a class="bibref" data-link-type="biblio"
href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span> <span class=
"rfc2119-assertion" id=
"http-sse-profile-protocol-binding-subscribeallevents-5b">Once the
connection is re-established the Web Thing <em class=
"rfc2119">SHOULD</em>, if possible, send any missed events which
occurred since the last event specified by the Consumer in a
<code>Last-Event-ID</code> header.</span></p>
</section>
<section id=
"http-sse-profile-protocol-binding-events-unsubscribeallevents">
<div class="header-wrapper">
<h5 id="x10-2-2-4-unsubscribeallevents"><bdi class=
"secno">10.2.2.4</bdi> <code>unsubscribeallevents</code></h5>
<a class="self-link" href=
"#http-sse-profile-protocol-binding-events-unsubscribeallevents"
aria-label="Permalink for Section 10.2.2.4"></a></div>
<p><span class="rfc2119-assertion" id=
"http-sse-profile-protocol-binding-unsubscribeallevents-1">In order
to unsubscribe from all events, a Consumer <em class=
"rfc2119">MUST</em> terminate the corresponding Server-Sent Events
connection with the events endpoint of the Web Thing, following the
steps specified in the Server-Sent Events specification
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>].</span></p>
<div class="note" role="note" id="issue-container-generatedID-15">
<div role="heading" class="note-title marker" id="h-note-13"
aria-level="6"><span>Note</span><span class="issue-label">:
Terminating a connection using JavaScript</span></div>
<p class="">For Consumers implemented in JavaScript
[<cite><a class="bibref" data-link-type="biblio" href=
"#bib-ecmascript" title=
"ECMAScript Language Specification">ECMASCRIPT</a></cite>] and
executed in a runtime which exposes the <a href=
"https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
<code>EventSource</code></a> interface, a Server-Sent Events
connection can be terminated using the <code>close()</code> method
on an <code>EventSource</code> [<cite><a class="bibref"
data-link-type="biblio" href="#bib-eventsource" title=
"Server-Sent Events">EVENTSOURCE</a></cite>] object.</p>
</div>
<div class="example" id="example-43">
<div class="marker"><a class="self-link" href="#example-43">Example
<bdi>43</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs abnf">lampEventsSource.close()<span class=
"hljs-comment">;</span></code></pre></div>
<p></p>
</section>
</section>
</section>
</section>
<section id="sec-http-webhook-profile" class="informative">
<div class="header-wrapper">
<h2 id="x11-http-webhook-profile"><bdi class="secno">11.</bdi> HTTP
Webhook Profile</h2>
<a class="self-link" href="#sec-http-webhook-profile" aria-label=
"Permalink for Section 11."></a></div>
<p><em>This section is non-normative.</em></p>
<p>This section defines the <em>HTTP Webhook Profile</em>,
including a <a href=
"#http-webhook-profile-protocol-binding">Protocol Binding</a> for
observing properties and listening for events using <a href=
"#sec-http-webhook-profile">WebHooks</a>.</p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-general-1">The <em>HTTP
Webhook profile</em> <em class="rfc2119">MAY</em> be used in
conjunction with the <a href="#http-basic-profile">HTTP Basic
Profile</a> in order to provide operations to read and write
properties and invoke, query and cancel actions.</span></p>
<p>The <em>HTTP Webhook profile</em> may be used as an alternative
event mechanism to the <a href="#sec-http-sse-profile">HTTP SSE
Profile</a>.</p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-general-3">In order to
conform with the HTTP Webhook Profile, Web Things and Consumers
<em class="rfc2119">MUST</em> also conform with all of the
assertions in the <a href="#common-constraints">Common
Constraints</a> section.</span></p>
<section id="sec-http-webhook-profile-intro">
<div class="header-wrapper">
<h3 id="x11-1-introduction"><bdi class="secno">11.1</bdi>
Introduction</h3>
<a class="self-link" href="#sec-http-webhook-profile-intro"
aria-label="Permalink for Section 11.1"></a></div>
<p>Webhooks are a mechanism for Consumers to subscribe to events
emitted by a Web Thing.</p>
<p>The mechanism is scalable and supports Consumers that receive
events from multiple Things. Consumers implement a Webhook listener
that is handling the event streams generated by Things.</p>
<p>A Webhook is similar to a callback mechanism in programming
languages. Consumers can subscribe to events they are interested in
by registering a listener with the event endpoint. When the event
condition occurs, the WebThing is notifying all listeners with a
corresponding event message, which is transmitted over HTTP(s). The
event message contains details about the event, such as timestamp,
event type, event source etc. in the data payload.</p>
<p>Depending on the deployment scenarios and integration
requirements for existing consumers, it may be required to use
specific data payload formats (e.g. Cloud Events). When a listener
receives an event message in a data payload, in many cases it just
acknowledges the successful reception of the event. Additionally,
it may provide a dataResponse payload, which provides a
back-channel that can be used to communicate further details from
the consumer to the WebThing.</p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-events-1">Depending on the
use case, a single listener for multiple things and multiple event
types <em class="rfc2119">MAY</em> be used.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-events-2">To minimize
network traffic, the same listerner <em class="rfc2119">MUST
NOT</em> perform multiple subscriptions to the same
listener.</span></p>
<section id="webhook-example">
<div class="header-wrapper">
<h4 id="x11-1-1-webhook-example"><bdi class="secno">11.1.1</bdi>
Webhook Example</h4>
<a class="self-link" href="#webhook-example" aria-label=
"Permalink for Section 11.1.1"></a></div>
<p>The following sequence diagram illustrates the flow of messages
between a Consumer and a Web Thing when subscribing to,
unsubscribing from and receiving events.</p>
<figure id="sequence-diagram-webhook"><img src=
"images/Sequence-Diagram-WebHook.png" class="wot-profiles" alt=
"Webhook example - sequence diagram" height="871" width="767">
<figcaption>Figure <bdi class="figno">2</bdi> <span class=
"fig-title">HTTP Webhook Profile - Sequence of operations and
notifications</span></figcaption>
</figure>
<p>The following example contains a snippet from a TD that
illustrates how a Webhook event can be described.</p>
<div class="example" id="example-44">
<div class="marker"><a class="self-link" href="#example-44">Example
<bdi>44</bdi></a></div>
<pre aria-busy="false"><code class="hljs javascript">...

{
    <span class="hljs-string">"events"</span>: {
        <span class="hljs-string">"fireAlarm"</span>: {
            <span class="hljs-string">"title"</span>: <span class=
"hljs-string">"Fire Alarm"</span>
            <span class=
"hljs-string">"description"</span>: <span class=
"hljs-string">"Critical Condition - Fire!"</span>,
            <span class="hljs-string">"subscription"</span>: {
                <span class=
"hljs-string">"type"</span>: <span class=
"hljs-string">"object"</span>,
                <span class="hljs-string">"properties"</span>: {
                  <span class="hljs-string">"callbackURL"</span>: {
                      <span class=
"hljs-string">"type"</span>: <span class=
"hljs-string">"string"</span>,
                      <span class=
"hljs-string">"format"</span>: <span class=
"hljs-string">"uri"</span>,
                      <span class=
"hljs-string">"description"</span>: <span class=
"hljs-string">"Callback URL provided by subscriber for Webhook notifications."</span>,
                      <span class=
"hljs-string">"writeOnly"</span>: <span class=
"hljs-literal">true</span>
                  },
                  ...
                }
            <span class="hljs-string">"data"</span>: {
                <span class=
"hljs-string">"type"</span>: <span class=
"hljs-string">"boolean"</span>,
                <span class=
"hljs-string">"description"</span>: <span class=
"hljs-string">"true, if the alert button has been pushed, false, if the button was armed again."</span>
            },
            <span class="hljs-string">"dataResponse"</span>: {
                <span class=
"hljs-string">"type"</span>: <span class=
"hljs-string">"string"</span>,
                <span class=
"hljs-string">"description"</span>: <span class=
"hljs-string">"sprinkler status"</span>
            },

            <span class="hljs-string">"cancellation"</span>: {
              <span class="hljs-string">"type"</span>: <span class=
"hljs-string">"object"</span>,
              <span class="hljs-string">"properties"</span>: {
                  <span class=
"hljs-string">"subscriptionID"</span>: {
                      <span class=
"hljs-string">"type"</span>: <span class=
"hljs-string">"integer"</span>,
                      <span class=
"hljs-string">"description"</span>: <span class=
"hljs-string">"subscription ID to cancel"</span>,
                      <span class=
"hljs-string">"writeOnly"</span>: <span class=
"hljs-literal">true</span>
                  }
              }
          },
          <span class="hljs-string">"forms"</span>: [
                {
                    <span class=
"hljs-string">"op"</span>: <span class=
"hljs-string">"subscribeevent"</span>,
                    <span class=
"hljs-string">"href"</span>: <span class=
"hljs-string">"http://192.168.0.124:8080/events/fireAlarm/subscribe"</span>,
                    <span class=
"hljs-string">"contentType"</span>: <span class=
"hljs-string">"application/json"</span>,
                    <span class=
"hljs-string">"htv:methodName"</span>: <span class=
"hljs-string">"POST"</span>
                },
                {
                    <span class=
"hljs-string">"op"</span>: <span class=
"hljs-string">"unsubscribeevent"</span>,
                    <span class=
"hljs-string">"href"</span>: <span class=
"hljs-string">"http://192.168.0.124:8080/events/fireAlarm/unsubscribe"</span>,
                    <span class=
"hljs-string">"htv:methodName"</span>: <span class=
"hljs-string">"POST"</span>
                }
            ]
        },
        <span class="hljs-string">"batteryLow"</span>: {
            ...
        }
    }
}</code></pre></div>
</section>
</section>
<section id="http-webhook-profile-identifier">
<div class="header-wrapper">
<h3 id="x11-2-identifier"><bdi class="secno">11.2</bdi>
Identifier</h3>
<a class="self-link" href="#http-webhook-profile-identifier"
aria-label="Permalink for Section 11.2"></a></div>
<p><span class="rfc2119-assertion" id="http-webhook-profile-1">In
order to denote that a given <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web Thing</a>
conforms to the HTTP Webhook Profile, its Thing Description
<em class="rfc2119">MUST</em> have a <a href=
"https://www.w3.org/TR/wot-thing-description11/#thing"><code>profile</code></a>
member [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-wot-thing-description" title=
"Web of Things (WoT) Thing Description">wot-thing-description</a></cite>]
with a value of
<code>https://www.w3.org/2022/wot/profile/http-webhook/v1</code>.</span></p>
<div class="note" role="note" id="issue-container-generatedID-16">
<div role="heading" class="note-title marker" id="h-note-14"
aria-level="4"><span>Note</span></div>
<section class="">
<p>Note that the <code>profile</code> member is an array that may
contain multiple profile entries, which indicates that a Web Thing
conforms to all of the profiles in that array.</p>
</section>
</div>
</section>
<section id="sec-http-webhook-profile-message-format">
<div class="header-wrapper">
<h3 id="x11-3-message-format"><bdi class="secno">11.3</bdi> Message
Format</h3>
<a class="self-link" href=
"#sec-http-webhook-profile-message-format" aria-label=
"Permalink for Section 11.3"></a></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-message-format-1">Event notification messages
<em class="rfc2119">MUST</em> comply with the following data
schema.</span></p>
<div class="note" id="issue-container-generatedID-17">
<div role="heading" class="ednote-title marker" id="h-ednote-1"
aria-level="4"><span>Editor's note</span></div>
<p class="">TODO: Describe data and dataResponse schemas.</p>
</div>
</section>
<section id="http-webhook-profile-protocol-binding">
<div class="header-wrapper">
<h3 id="x11-4-protocol-binding"><bdi class="secno">11.4</bdi>
Protocol Binding</h3>
<a class="self-link" href="#http-webhook-profile-protocol-binding"
aria-label="Permalink for Section 11.4"></a></div>
<p>This section defines a protocol binding which describes how a
<a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-consumer">Consumer</a>
and a <a href=
"https://www.w3.org/TR/wot-architecture11/#dfn-thing">Web Thing</a>
communicate using Webhook Events.</p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-1">A Consumer or Web Thing
conforming to the HTTP Webhook Profile <em class=
"rfc2119">MUST</em> implement this protocol binding.</span></p>
<section id="http-webhook-profile-protocol-binding-events">
<div class="header-wrapper">
<h4 id="x11-4-1-operations"><bdi class="secno">11.4.1</bdi>
Operations</h4>
<a class="self-link" href=
"#http-webhook-profile-protocol-binding-events" aria-label=
"Permalink for Section 11.4.1"></a></div>
<section id="http-webhook-profile-protocol-binding-subscribeevent">
<div class="header-wrapper">
<h5 id="x11-4-1-1-subscribeevent"><bdi class="secno">11.4.1.1</bdi>
<code>subscribeevent</code></h5>
<a class="self-link" href=
"#http-webhook-profile-protocol-binding-subscribeevent" aria-label=
"Permalink for Section 11.4.1.1"></a></div>
<div class="rfc2119-assertion" id=
"http-basic-profile-protocol-binding-subscribeevent-1">
<p>The URL of an <code>Event</code> resource to be used when
subscribing to an event <em class="rfc2119">MUST</em> be obtained
from a Thing Description by locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the corresponding <a href=
"https://www.w3.org/TR/wot-thing-description11/#eventaffordance"><code>
EventAffordance</code></a> for which:</p>
<ul>
<li>After defaults have been applied, its <code>op</code> member
contains the value <code>subscribeevent</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
<li>Its <code>subprotocol</code> member has a value of
<code>webhook</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeevent-3">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the
<code>Event</code> resource.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeevent-4">In order
to subscribe to an event, a Consumer <em class="rfc2119">MUST</em>
provide the listener URL in the request payload of the
<code>subscribe</code> operation of the <code>Event</code>
resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>POST</code></li>
<li>URL set to the URL of the <code>Event</code> resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
<li>A body with a subscription request payload, serialized in
JSON.</li>
<p>The subscription payload contains the URI for the event message
listener in the field with the <code>callbackURI</code> key.</p>
</ul>
<div class="example" id="example-45">
<div class="marker"><a class="self-link" href="#example-45">Example
<bdi>45</bdi></a></div>
<pre aria-busy="false"><code class=
"hljs css">  POST /things/lamp/events/overheated HTTP/<span class=
"hljs-number">1.1</span>
  Host: mythingserver.com
  Content-Type: application/json
  Accept: application/json
  {
    callbackURI: <span class=
"hljs-string">"http://myConsumer.com/myEventListener"</span>
}</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeevent-5">If a Web
Thing receives an HTTP request following the format above and the
Consumer has permission to subscribe to the corresponding event,
then it <em class="rfc2119">MUST</em> send <em>event messages</em>
to the Consumer as events of the specified type are
emitted.</span></p>
<p>This involves the Web Thing initially sending an HTTP response
to the Consumer with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
<div class="example" id="example-46">
<div class="marker"><a class="self-link" href="#example-46">Example
<bdi>46</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
{
    subscriptionId: <span class=
"hljs-number">1234</span>-<span class=
"hljs-number">4544</span>-<span class="hljs-number">1211</span>
}</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeevent-6">Whenever
an event of the specified type occurs, the Web Thing <em class=
"rfc2119">MUST</em> send event data to the Consumer using the event
payload format defined in section
["#sec-http-webhook-profile-protocol-binding-events-notification"].</span></p>
</section>
<section id=
"http-webhook-profile-protocol-binding-events-unsubscribeevent">
<div class="header-wrapper">
<h5 id="x11-4-1-2-unsubscribeevent"><bdi class=
"secno">11.4.1.2</bdi> <code>unsubscribeevent</code></h5>
<a class="self-link" href=
"#http-webhook-profile-protocol-binding-events-unsubscribeevent"
aria-label="Permalink for Section 11.4.1.2"></a></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeevent-4b">In order
to unsubscribe to an event, a Consumer <em class=
"rfc2119">MUST</em> provide the <code>subscriptionID</code> in the
data payload of the <code>unsubscribe</code> operation of the
<code>Event</code> resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>DELETE</code></li>
<li>URL set to the URL of the <code>Event</code> resource followed
by the <code>subscriptionId</code> of a valid subscription</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
<div class="example" id="example-unsubscribe-using-subscriptionid">
<div class="marker"><a class="self-link" href=
"#example-unsubscribe-using-subscriptionid">Example
<bdi>47</bdi></a><span class="example-title">: Unsubscribe using
subscriptionId</span></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">DELETE</span> <span class=
"hljs-string">/things/lamp/events/overheated/1234-4544-1211</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com</code></pre></div>
</section>
<section id=
"http-webhook-profile-protocol-binding-events-subscribeallevents">
<div class="header-wrapper">
<h5 id="x11-4-1-3-subscribeallevents"><bdi class=
"secno">11.4.1.3</bdi> <code>subscribeallevents</code></h5>
<a class="self-link" href=
"#http-webhook-profile-protocol-binding-events-subscribeallevents"
aria-label="Permalink for Section 11.4.1.3"></a></div>
<div class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-1">
<p>The URL of an <code>Events</code> resource to be used when
subscribing to all events emitted by a Web Thing <em class=
"rfc2119">MUST</em> be obtained from a Thing Description by
locating a <a href=
"https://www.w3.org/TR/wot-thing-description11/#form"><code>Form</code></a>
inside the top level <a href=
"https://www.w3.org/TR/wot-thing-description11/#form-serialization-json">
<code>forms</code></a> member of a Thing Description for which:</p>
<ul>
<li>Its <code>op</code> member contains the value
<code>subscribeallevents</code></li>
<li>After being resolved against a base URL where applicable, the
<a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
scheme</a> [<cite><a class="bibref" data-link-type="biblio" href=
"#bib-rfc3986" title=
"Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]
of the value of its <code>href</code> member is <code>http</code>
or <code>https</code></li>
<li>Its <code>subprotocol</code> member has a value of
<code>webhook</code></li>
</ul>
</div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-3">The
resolved value of the <code>href</code> member <em class=
"rfc2119">MUST</em> then be used as the URL of the events
resource.</span></p>
<div class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-4">
<p>In order to subscribe to <em>all</em> events emitted by a Web
Thing, a Consumer <em class="rfc2119">MUST</em> send an HTTP
request to the Web Thing with:</p>
<ul>
<li>Method set to <code>POST</code></li>
<li>URL set to the URL of the events resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
<li><code>Request Payload</code> contains a <code>JSON</code>
object with a subscription request payload.</li>
</ul>
</div>
<div class="example" id="example-48">
<div class="marker"><a class="self-link" href="#example-48">Example
<bdi>48</bdi></a></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">POST</span> <span class=
"hljs-string">/things/lamp/events</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com
<span class="hljs-attribute">Accept</span><span class=
"hljs-punctuation">: </span>application/json

<span class="css">{
  callbackURI: <span class=
"hljs-string">"http://myConsumer.com/myEventListener"</span>
}</span></code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-5">If a
Web Thing receives an HTTP request following the format above, then
it <em class="rfc2119">MUST</em> send <em>event messages</em> to
the Consumer for all event types for which it has permission to
subscribe.</span></p>
<p>This involves the Web Thing initially sending an HTTP response
to the Consumer with:</p>
<ul>
<li>Status code set to <code>200</code></li>
<li><code>Content-Type</code> header set to
<code>application/json</code></li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
<li>Response payload contains a JSON object with a
<code>subscriptionId</code>.</li>
</ul>
<div class="example" id="example-49">
<div class="marker"><a class="self-link" href="#example-49">Example
<bdi>49</bdi></a></div>
<pre aria-busy="false"><code class="hljs css">HTTP/<span class=
"hljs-number">1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content</span>-Type: application/json
{
  subscriptionId: <span class=
"hljs-number">1234</span>-<span class="hljs-number">4544</span>-<span class="hljs-number">1211</span>
}</code></pre></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-6">Whenever
an event occurs, the Web Thing <em class="rfc2119">MUST</em> send
event data to the Consumer using the event payload format defined
in section <a href=
"#sec-http-webhook-profile-message-format">Message
Format</a>.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-7">If the
connection between the Web Thing and the Consumer drops, the Web
Thing <em class="rfc2119">MUST</em> re-establish the
connection.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-subscribeallevents-8">Once
the connection is re-established the Web Thing <em class=
"rfc2119">SHOULD</em>, if possible, send any missed events which
occurred since the last successful event notification.</span></p>
</section>
<section id=
"http-webhook-profile-protocol-binding-events-unsubscribeallevents">
<div class="header-wrapper">
<h5 id="x11-4-1-4-unsubscribeallevents"><bdi class=
"secno">11.4.1.4</bdi> <code>unsubscribeallevents</code></h5>
<a class="self-link" href=
"#http-webhook-profile-protocol-binding-events-unsubscribeallevents"
aria-label="Permalink for Section 11.4.1.4"></a></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-unsubscribeallevents-1">In
order to unsubscribe from all events, a Consumer <em class=
"rfc2119">MUST</em> invoke the <code>unsubscribe</code> operation
of the <code>Event</code> resource.</span></p>
<p>This involves the Consumer sending an HTTP request to the Web
Thing with:</p>
<ul>
<li>Method set to <code>DELETE</code></li>
<li>URL set to the URL of the <code>Event</code> resource</li>
<li><code>Accept</code> header set to
<code>application/json</code></li>
</ul>
<div class="example" id=
"example-unsubscribe-all-using-callbackuri">
<div class="marker"><a class="self-link" href=
"#example-unsubscribe-all-using-callbackuri">Example
<bdi>50</bdi></a><span class="example-title">: Unsubscribe all
using callbackURI</span></div>
<pre aria-busy="false"><code class="hljs http"><span class=
"hljs-keyword">DELETE</span> <span class=
"hljs-string">/things/lamp/events</span> <span class=
"hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class=
"hljs-punctuation">: </span>mythingserver.com</code></pre></div>
</section>
</section>
<section id=
"sec-http-webhook-profile-protocol-binding-event-listeners">
<div class="header-wrapper">
<h4 id="x11-4-2-event-connections"><bdi class="secno">11.4.2</bdi>
Event Connections</h4>
<a class="self-link" href=
"#sec-http-webhook-profile-protocol-binding-event-listeners"
aria-label="Permalink for Section 11.4.2"></a></div>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-1">A
HTTP(s) connection to the event listener of a Consumer <em class=
"rfc2119">MUST</em> be initiated and managed by the Web
Thing.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-2">A
Consumer <em class="rfc2119">MUST</em> terminate the subscription
with the events endpoint of the Web Thing.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-3">If a
Consumer becomes unavailable and the Web Thing cannot successfully
transmit event messages to the consumer, it <em class=
"rfc2119">SHOULD</em> attempt several retries at increasing
intervals.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-4">After
the maximum number of retries was reached, the Web Thing <em class=
"rfc2119">MAY</em> terminate the subscription without having
received an <code>unsubscribe</code> or <code>unsubscribeall</code>
operation.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding--event-connections-5">If the
connection between the Web Thing and the Consumer drops, the Web
Thing <em class="rfc2119">MUST</em> attempt to re-establish the
connection.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-6">Once
the connection is re-established, the Web Thing <em class=
"rfc2119">SHOULD</em>, if possible, send any missed events which
occurred since the last successful event notification.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-7">The Web
Thing <em class="rfc2119">MAY</em> reuse an existing connection to
a listener for subsequent message traffic, or it <em class=
"rfc2119">MAY</em> establish a new connection for each
message.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding--event-connections-8">When
an event message has been received, the Consumer <em class=
"rfc2119">MUST</em> respond with a "HTTP 200 OK"
message.</span></p>
<p><span class="rfc2119-assertion" id=
"http-webhook-profile-protocol-binding-event-connections-9">An
(optional) JSON payload <em class="rfc2119">MAY</em> be provided to
return a response back to the Web Thing via the same communication
channel.</span></p>
</section>
</section>
</section>
<section id="privacy-considerations">
<div class="header-wrapper">
<h2 id="x12-privacy-considerations"><bdi class="secno">12.</bdi>
Privacy Considerations</h2>
<a class="self-link" href="#privacy-considerations" aria-label=
"Permalink for Section 12."></a></div>
<p><span class="rfc2119-assertion" id=
"privacy-considerations-1">The privacy considerations of the
<a href=
"https://www.w3.org/TR/wot-architecture11/#sec-privacy-considerations">
WoT Architecture</a> and <a href=
"https://www.w3.org/TR/wot-thing-description11/#sec-privacy-consideration">
WoT Thing Description</a> <em class="rfc2119">MUST</em> be adopted
by compliant implementations.</span></p>
</section>
<section id="security-considerations">
<div class="header-wrapper">
<h2 id="x13-security-considerations"><bdi class="secno">13.</bdi>
Security Considerations</h2>
<a class="self-link" href="#security-considerations" aria-label=
"Permalink for Section 13."></a></div>
<p><span class="rfc2119-assertion" id=
"security-considerations-1">The security considerations of the
<a href=
"https://www.w3.org/TR/wot-architecture11/#sec-security-consideration">
WoT Architecture</a> and <a href=
"https://www.w3.org/TR/wot-thing-description11/#sec-security-considerations">
WoT Thing Description</a> <em class="rfc2119">MUST</em> be adopted
by compliant implementations.</span></p>
<div class="note" role="note" id="issue-container-generatedID-18">
<div role="heading" class="note-title marker" id="h-note-15"
aria-level="3"><span>Note</span></div>
<p class="">Please see <a href=
"https://www.w3.org/TR/wot-security-best-practices/">WoT Security
Best Practices</a> for implementation advice.</p>
</div>
</section>
<section id="changes" class="appendix">
<div class="header-wrapper">
<h2 id="a-recent-specification-changes"><bdi class="secno">A.</bdi>
Recent Specification Changes</h2>
<a class="self-link" href="#changes" aria-label=
"Permalink for Appendix A."></a></div>
<section id="changes-from-the-fpwd-published-24-november-2020">
<div class="header-wrapper">
<h3 id="changes-from-fpwd"><bdi class="secno">A.1</bdi> Changes
from the FPWD published 24 November 2020</h3>
<a class="self-link" href="#changes-from-fpwd" aria-label=
"Permalink for Appendix A.1"></a></div>
<ul>
<li>Constrain allowed OAuth2 flows.</li>
<li>Define webhook subscription mechanism.</li>
<li>Add common constraints for accessibility.</li>
<li>Define allowed link relation types.</li>
<li>Allow only a subset of the security schemes defined in the TD
specification.</li>
<li>Add Ben Francis as co-editor.</li>
<li>Make security bootstrapping mandatory for Discovery.</li>
<li>Allow security metadata on Forms.</li>
<li>Remove empty Semantic Annotations section.</li>
<li>Use RFC3339 for date-time references.</li>
<li>Make hreflang optional.</li>
<li>Define behavior and payloads of asynchronous and synchronous
actions.</li>
<li>Add example TDs for event mechanisms.</li>
<li>Define sub-profiles (extending HTTP Basic Profile) for SSE and
Webhook event mechanisms.</li>
<li>Constrain initial profile to HTTP and use term "HTTP Basic
Profile".</li>
<li>Define error reporting and behavior.</li>
<li>Update to use TD v1.1; update context references in
examples.</li>
<li>Define subprotocol usages: observeallproperties,
unobserveallproperties, queryallactions.</li>
<li>Require specification of a default language.</li>
<li>Define protocol binding for observing properties.</li>
<li>Refine definition of out-of-the-box interoperability and
profile purpose.</li>
<li>Specify JSON serialization of Problem Details format.</li>
<li>Reorganize security and privacy considerations sections.</li>
<li>Add discovery section to baseline (HTTP Basic) profile.</li>
<li>Add identifier section to baseline (HTTP Basic) profile.</li>
<li>Remove Canonical TD dependency.</li>
<li>Revise terminology.</li>
</ul>
</section>
</section>
<section id="references" class="appendix">
<div class="header-wrapper">
<h2 id="b-references"><bdi class="secno">B.</bdi> References</h2>
<a class="self-link" href="#references" aria-label=
"Permalink for Appendix B."></a></div>
<section id="normative-references">
<div class="header-wrapper">
<h3 id="b-1-normative-references"><bdi class="secno">B.1</bdi>
Normative references</h3>
<a class="self-link" href="#normative-references" aria-label=
"Permalink for Appendix B.1"></a></div>
<dl class="bibliography">
<dt id="bib-http11">[HTTP11]</dt>
<dd><a href="https://httpwg.org/specs/rfc7230.html"><cite>Hypertext
Transfer Protocol (HTTP/1.1): Message Syntax and
Routing</cite></a>. R. Fielding, Ed.; J. Reschke, Ed.. IETF. June
2014. Proposed Standard. URL: <a href=
"https://httpwg.org/specs/rfc7230.html">https://httpwg.org/specs/rfc7230.html</a></dd>
<dt id="bib-json">[JSON]</dt>
<dd><a href="https://www.rfc-editor.org/rfc/rfc8259"><cite>The
JavaScript Object Notation (JSON) Data Interchange
Format</cite></a>. T. Bray, Ed.. IETF. December 2017. Internet
Standard. URL: <a href=
"https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a></dd>
<dt id="bib-rfc2119">[RFC2119]</dt>
<dd><a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key
words for use in RFCs to Indicate Requirement Levels</cite></a>. S.
Bradner. IETF. March 1997. Best Current Practice. URL: <a href=
"https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a></dd>
<dt id="bib-rfc3339">[RFC3339]</dt>
<dd><a href="https://www.rfc-editor.org/rfc/rfc3339"><cite>Date and
Time on the Internet: Timestamps</cite></a>. G. Klyne; C. Newman.
IETF. July 2002. Proposed Standard. URL: <a href=
"https://www.rfc-editor.org/rfc/rfc3339">https://www.rfc-editor.org/rfc/rfc3339</a></dd>
<dt id="bib-rfc3986">[RFC3986]</dt>
<dd><a href="https://www.rfc-editor.org/rfc/rfc3986"><cite>Uniform
Resource Identifier (URI): Generic Syntax</cite></a>. T.
Berners-Lee; R. Fielding; L. Masinter. IETF. January 2005. Internet
Standard. URL: <a href=
"https://www.rfc-editor.org/rfc/rfc3986">https://www.rfc-editor.org/rfc/rfc3986</a></dd>
<dt id="bib-rfc7807">[RFC7807]</dt>
<dd><a href="https://www.rfc-editor.org/rfc/rfc7807"><cite>Problem
Details for HTTP APIs</cite></a>. M. Nottingham; E. Wilde. IETF.
March 2016. Proposed Standard. URL: <a href=
"https://www.rfc-editor.org/rfc/rfc7807">https://www.rfc-editor.org/rfc/rfc7807</a></dd>
<dt id="bib-rfc8174">[RFC8174]</dt>
<dd><a href=
"https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of
Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.
IETF. May 2017. Best Current Practice. URL: <a href=
"https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a></dd>
<dt id="bib-url">[URL]</dt>
<dd><a href="https://url.spec.whatwg.org/"><cite>URL
Standard</cite></a>. Anne van Kesteren. WHATWG. Living Standard.
URL: <a href=
"https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a></dd>
<dt id="bib-wot-architecture11">[wot-architecture11]</dt>
<dd><a href="https://www.w3.org/TR/wot-architecture11/"><cite>Web
of Things (WoT) Architecture 1.1</cite></a>. Michael Lagally;
Ryuichi Matsukura; Kunihiko Toumura. W3C. 7 September 2022. W3C
Working Draft. URL: <a href=
"https://www.w3.org/TR/wot-architecture11/">https://www.w3.org/TR/wot-architecture11/</a></dd>
<dt id="bib-wot-discovery">[wot-discovery]</dt>
<dd><a href="https://www.w3.org/TR/wot-discovery/"><cite>Web of
Things (WoT) Discovery</cite></a>. Andrea Cimmino; Michael McCool;
Farshid Tavakolizadeh; Kunihiko Toumura. W3C. 10 August 2022. W3C
Working Draft. URL: <a href=
"https://www.w3.org/TR/wot-discovery/">https://www.w3.org/TR/wot-discovery/</a></dd>
<dt id="bib-wot-thing-description">[wot-thing-description]</dt>
<dd><a href=
"https://www.w3.org/TR/wot-thing-description/"><cite>Web of Things
(WoT) Thing Description</cite></a>. Sebastian Käbisch; Takuki
Kamiya; Michael McCool; Victor Charpenay; Matthias Kovatsch. W3C. 9
April 2020. W3C Recommendation. URL: <a href=
"https://www.w3.org/TR/wot-thing-description/">https://www.w3.org/TR/wot-thing-description/</a></dd>
<dt id="bib-wot-thing-description11">[wot-thing-description11]</dt>
<dd><a href=
"https://www.w3.org/TR/wot-thing-description11/"><cite>Web of
Things (WoT) Thing Description 1.1</cite></a>. Sebastian Käbisch;
Takuki Kamiya; Michael McCool; Victor Charpenay. W3C. 3 August
2022. W3C Working Draft. URL: <a href=
"https://www.w3.org/TR/wot-thing-description11/">https://www.w3.org/TR/wot-thing-description11/</a></dd>
<dt id="bib-wot-usecases">[wot-usecases]</dt>
<dd><a href="https://www.w3.org/TR/wot-usecases/"><cite>Web of
Things (WoT): Use Cases and Requirements</cite></a>. Michael
Lagally; Michael McCool; Ryuichi Matsukura; Tomoaki Mizushima. W3C.
7 March 2022. W3C Working Group Note. URL: <a href=
"https://www.w3.org/TR/wot-usecases/">https://www.w3.org/TR/wot-usecases/</a></dd>
</dl>
</section>
<section id="informative-references">
<div class="header-wrapper">
<h3 id="b-2-informative-references"><bdi class="secno">B.2</bdi>
Informative references</h3>
<a class="self-link" href="#informative-references" aria-label=
"Permalink for Appendix B.2"></a></div>
<dl class="bibliography">
<dt id="bib-ecmascript">[ECMASCRIPT]</dt>
<dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript
Language Specification</cite></a>. Ecma International. URL:
<a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a></dd>
<dt id="bib-eventsource">[EVENTSOURCE]</dt>
<dd><a href="https://www.w3.org/TR/eventsource/"><cite>Server-Sent
Events</cite></a>. Ian Hickson. W3C. 28 January 2021. W3C
Recommendation. URL: <a href=
"https://www.w3.org/TR/eventsource/">https://www.w3.org/TR/eventsource/</a></dd>
<dt id="bib-h2020-create-iot">[H2020-CREATE-IoT]</dt>
<dd><a href=
"https://european-iot-pilots.eu/wp-content/uploads/2018/11/D06_02_WP06_H2020_CREATE-IoT_Final.pdf">
<cite>H2020 – CREATE-IoT Project - Recommendations for
commonalities and interoperability profiles of IoT
platforms</cite></a>. IoT European Large-Scale Pilots Programme.
2018-11. Published. URL: <a href=
"https://european-iot-pilots.eu/wp-content/uploads/2018/11/D06_02_WP06_H2020_CREATE-IoT_Final.pdf">
https://european-iot-pilots.eu/wp-content/uploads/2018/11/D06_02_WP06_H2020_CREATE-IoT_Final.pdf</a></dd>
<dt id="bib-wot-architecture">[WOT-ARCHITECTURE]</dt>
<dd><a href="https://www.w3.org/TR/wot-architecture/"><cite>Web of
Things (WoT) Architecture</cite></a>. Matthias Kovatsch; Ryuichi
Matsukura; Michael Lagally; Toru Kawaguchi; Kunihiko Toumura; Kazuo
Kajimoto. W3C. 9 April 2020. W3C Recommendation. URL: <a href=
"https://www.w3.org/TR/wot-architecture/">https://www.w3.org/TR/wot-architecture/</a></dd>
</dl>
</section>
</section>
<p role="navigation" id="back-to-top"><a href="#title"><abbr title=
"Back to Top">↑</abbr></a></p>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-thing" aria-label=
"Links in this document to definition: Thing"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-thing" aria-label=
"Permalink for definition: Thing. Activate to close this dialog.">Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li><a href="#ref-for-dfn-thing-1" title=
"§ 3.1 Additional Definitions">§ 3.1 Additional
Definitions</a></li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-consumer" aria-label=
"Links in this document to definition: Consumer"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-consumer" aria-label=
"Permalink for definition: Consumer. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li><a href="#ref-for-dfn-consumer-1" title=
"§ 3.1 Additional Definitions">§ 3.1 Additional
Definitions</a></li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-thing-description" aria-label=
"Links in this document to definition: Thing Description">
<span class="caret"></span>
<div><a class="self-link" href="#dfn-thing-description" aria-label=
"Permalink for definition: Thing Description. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li><a href="#ref-for-dfn-thing-description-1" title=
"§ 6.1 Accessibility">§ 6.1 Accessibility</a></li>
<li><a href="#ref-for-dfn-thing-description-2" title=
"§ 6.2 Units">§ 6.2 Units</a></li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-td" aria-label=
"Links in this document to definition: TD"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-td" aria-label=
"Permalink for definition: TD. Activate to close this dialog.">Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-wot-thing-description" aria-label=
"Links in this document to definition: WoT Thing Description">
<span class="caret"></span>
<div><a class="self-link" href="#dfn-wot-thing-description"
aria-label=
"Permalink for definition: WoT Thing Description. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li><a href="#ref-for-dfn-wot-thing-description-1" title=
"§ 1.1 Deployment Scenarios">§ 1.1 Deployment Scenarios</a></li>
<li><a href="#ref-for-dfn-wot-thing-description-2" title=
"§ 1.3 Why a Profile?">§ 1.3 Why a Profile?</a> <a href=
"#ref-for-dfn-wot-thing-description-3" title=
"Reference 2">(2)</a></li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-partial-td" aria-label=
"Links in this document to definition: Partial TD"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-partial-td" aria-label=
"Permalink for definition: Partial TD. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-thing-model" aria-label=
"Links in this document to definition: Thing Model"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-thing-model" aria-label=
"Permalink for definition: Thing Model. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li><a href="#ref-for-dfn-thing-model-1" title=
"§ 6.6.1 Link Relation Types">§ 6.6.1 Link Relation Types</a></li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-tm" aria-label=
"Links in this document to definition: TM"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-tm" aria-label=
"Permalink for definition: TM. Activate to close this dialog.">Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-interaction-model" aria-label=
"Links in this document to definition: Interaction Model">
<span class="caret"></span>
<div><a class="self-link" href="#dfn-interaction-model" aria-label=
"Permalink for definition: Interaction Model. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-interaction-affordance" aria-label=
"Links in this document to definition: Interaction Affordance">
<span class="caret"></span>
<div><a class="self-link" href="#dfn-interaction-affordance"
aria-label=
"Permalink for definition: Interaction Affordance. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-property" aria-label=
"Links in this document to definition: Property"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-property" aria-label=
"Permalink for definition: Property. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-action" aria-label=
"Links in this document to definition: Action"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-action" aria-label=
"Permalink for definition: Action. Activate to close this dialog.">Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-event" aria-label=
"Links in this document to definition: Event"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-event" aria-label=
"Permalink for definition: Event. Activate to close this dialog.">Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-protocol-binding" aria-label=
"Links in this document to definition: Protocol Binding">
<span class="caret"></span>
<div><a class="self-link" href="#dfn-protocol-binding" aria-label=
"Permalink for definition: Protocol Binding. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-servient" aria-label=
"Links in this document to definition: Servient"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-servient" aria-label=
"Permalink for definition: Servient. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-vocabulary" aria-label=
"Links in this document to definition: Vocabulary"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-vocabulary" aria-label=
"Permalink for definition: Vocabulary. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-term" aria-label=
"Links in this document to definition: Term"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-term" aria-label=
"Permalink for definition: Term. Activate to close this dialog.">Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-vocab-term" aria-label=
"Links in this document to definition: Vocabulary Term">
<span class="caret"></span>
<div><a class="self-link" href="#dfn-vocab-term" aria-label=
"Permalink for definition: Vocabulary Term. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-wot-interface" aria-label=
"Links in this document to definition: WoT Interface"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-wot-interface" aria-label=
"Permalink for definition: WoT Interface. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-wot-runtime" aria-label=
"Links in this document to definition: WoT Runtime"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-wot-runtime" aria-label=
"Permalink for definition: WoT Runtime. Activate to close this dialog.">
Permalink</a></div>
<p><b>Referenced in:</b></p>
<ul>
<li>Not referenced in this document.</li>
</ul>
</div>
<div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
id="dfn-panel-for-dfn-profile" aria-label=
"Links in this document to definition: Profile"><span class=
"caret"></span>
<div><a class="self-link" href="#dfn-profile" aria-label=
"Permalink for definition: Profile. Activate to close this dialog.">
Permalink</a> <span class="marker dfn-exported" title=
"Definition can be referenced by other specifications">exported</span></div>
<p><b>Referenced in:</b></p>
<ul>
<li><a href="#ref-for-dfn-profile-1" title="§ 1.3 Why a Profile?">§
1.3 Why a Profile?</a></li>
</ul>
</div>
<script id="respec-dfn-panel">
(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()
</script>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
</body>
</html>
