<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <title>Web of Things (WoT) Profile</title>
  <script class="remove" src="https://www.w3.org/Tools/respec/respec-w3c"></script>
  <script class="remove">
    var respecConfig = {
      lint: {
        "no-headingless-sections": false,
      },
      specStatus: "ED",
      maxTocLevel: 6,
      processVersion: 2019,
      shortName: "wot-profile",
      copyrightStart: 2020,
      group: "wg/wot",
      wgPublicList: "public-wot-wg",
      edDraftURI: "https://w3c.github.io/wot-profile/",
      githubAPI: "https://api.github.com/repos/w3c/wot-profile",
      issueBase: "https://www.github.com/w3c/wot-profile/issues",
      previousPublishDate: "2020-11-24",
      previousMaturity: "FPWD",
      editors: [{
        name: "Michael Lagally",
        w3cid: "47166",
        company: "Oracle Corp.",
        companyURL: "https://www.oracle.com/"
      },
      {
        name: "Michael McCool",
        w3cid: "93137",
        company: "Intel Corp.",
        companyURL: "https://www.intel.com/"
      },
      {
        name: "Ryuichi Matsukura",
        w3cid: "64284",
        company: "Fujitsu Ltd.",
        companyURL: "https://www.fujitsu.com/"
      },
      {
        name: "Sebastian Kaebisch",
        w3cid: "43064",
        company: "Siemens AG",
        companyURL: "https://www.siemens.com/"
      },
      {
        name: "Tomoaki Mizushima",
        w3cid: "98915",
        company: "Internet Research Institute, Inc.",
        companyURL: "https://www.iri.co.jp/"
      }],

      otherLinks: [
        {
          key: "Contributors",
          data: [{
            value: "In the GitHub repository",
            href: "https://github.com/w3c/wot-profile/graphs/contributors"
          }]
        }, {
          key: "Repository",
          data: [{
            value: "We are on GitHub",
            href: "https://github.com/w3c/wot-profile/"
          }, {
            value: "File a bug",
            href: "https://github.com/w3c/wot-profile/issues"
          }, {
            value: "Contribute",
            href: "https://github.com/w3c/wot-profile/pulls"
          }]
        }],
      localBiblio: {
        "JSON-SCHEMA": {
          title: "JSON Schema Validation: A Vocabulary for Structural Validation of JSON",
          href: "https://tools.ietf.org/html/draft-handrews-json-schema-validation-01",
          authors: ["Austin Wright", "Henry Andrews", "Geraint Luff"],
          status: "Internet-Draft",
          date: "19 March 2018",
          publisher: "IETF"
        },
        "ISO-6709": {
          title: "ISO-6709:2008 : Standard representation of geographic point location by coordinates",
          href: "https://www.iso.org/standard/39242.html",
          status: "Published",
          date: "2008-07",
          publisher: "ISO"
        },
        "H2020-CREATE-IoT": {
          title: "H2020 â€“ CREATE-IoT Project - Recommendations for commonalities and interoperability profiles of IoT platforms",
          href: "https://european-iot-pilots.eu/wp-content/uploads/2018/11/D06_02_WP06_H2020_CREATE-IoT_Final.pdf",
          status: "Published",
          date: "2018-11",
          publisher: "IoT European Large-Scale Pilots Programme"
        }


      }
    };
  </script>
  <style>
    .rfc2119-assertion {
      background-color: rgb(230, 230, 230)
    }
  </style>

</head>

<body>
  <section id="abstract">
    <p>
      The <em>WoT Profile Specification</em> defines a Profiling Mechanism and a <em>HTTP Baseline Profile</em>,
      which enables <em>out of the box interoperability</em>
      among things and devices. <em>Out of the box interoperability</em> implies,
      that devices can be integrated into various application scenarios without
      deep level adaptations. Typically only minor configuration operations are
      necessary (such as entering a network key, or IP address)
      to use the device in a certain scenario.
      These actions can be done by anyone without specific training.
    </p>
    The <a>HTTP Baseline Profile</a> defines a set of <em>constraints
      and rules</em>, which compliant thing descriptions have to adopt
    to guarantee interoperability.
    </p>
    <p>
      These rules are prescriptive, to ensure that
      compliant implementations satisfy the semantic guarantees
      implied by them. We call this set of rules a <em>Profile</em>.
    </p>
    <p>
      The <strong>WoT Profile Specification</strong> as defined in
      this document serves two purposes:
    </p>
    <ul>
      <li>It defines a generic <strong>Profiling
          Mechanism</strong> which provides a mechanism to describe a
        profile in an unambiguous way. This mechanism can be
        used to define additional profiles.
      </li>
      <li>In addition, it defines a <strong><a>HTTP Baseline
            Profile</a></strong> of the Thing Description, which
        consists of a baseline information model and protocol
        binding rules. The <a>HTTP Baseline
          Profile</a> formalizes the results of several PlugFests
        that were conducted by the WoT Interest Group and of
        tests that were conducted as part of the development.
        <p>
          This document incudes a binding of the baseline information model to
          HTTP(S) and selected notification sub-protocols.
          The baseline information model can be bound to other protocols -
          it is expected that bindings to other protocols (e.g. MQTT, CoAP)
          will be defined in the near future.
        </p>
        <p>
          <span class="rfc2119-assertion" id="profile-abstract-1">
            A TD that is compliant to the <a>HTTP baseline profile</a> MUST adhere to
            both the constraints on the information model and the protocol binding.
          </span>
        </p>
      </li>
    </ul>
    <p>
      Devices that constrain their use of the Thing Description to
      the <a>HTTP Baseline Profile</a> can interoperate with each other
      out-of-the-box.
    </p>
    <p>Note that the baseline profile is not exclusive. Device implementers are free to adopt
      other features of the thing description that go beyond the constraints
      of the baseline profile, however the interoperability guarantees of the baseline profile
      hold only for the <a>HTTP Baseline Profile</a> subset.



    <section>
      <h3>Motivation for a Profile</h3>
    </section>

    <p>
      <span class="rfc2119-assertion" id="profile-abstract-2">
        The W3C WoT Thing Architecture [[wot-architecture]] and
        WoT Thing Description [[wot-thing-description]] define a
        powerful description mechanism and a format to describe
        myriads of very different devices, which may be connected
        over various protocols.
        </span>
        The format is very flexible and open
        and puts very few normative requirements on devices that
        implement it.</p>
  
    <p>
      However, this flexibility de-facto prevents
      interoperability, since, without additional <strong>rules</strong>,
      it allows implementers to make many choices that do not
      provide <strong>guarantees</strong> of common behavior
      between implementations.
    </p>

  </section>

  <section id='sotd'></section>

  <section id="intro">
    <h1 id="introduction">Introduction</h1>
    <p>
      The W3C WoT Architecture [[wot-architecture11]] and the WoT
      Thing Description [[wot-thing-description11]]
      have been developed as a versatile format, that allows
      describing the interactions between multiple devices and
      protocols.

    </p>
    <p>
      This flexibility permits an easy integration of new device
      types and protocols, however it risks interoperability,
      since there are <em>no guarantees</em> that two devices
      which are formally spec-compliant, will be able to
      communicate.
    </p>
    <p>To increase adoption of the WoT specifications,
      interoperability between on premise devices, edge devices
      and the cloud is essential. Even if every manufacturer is
      implementing the current Thing Description specification in
      full flexibility, there is no interoperability guarantee;
      many choices are still left to the implementations and there
      are very few normative requirements that a device has to
      fulfill.</p>

    <section>
      <h3>Deployment Scenarios</h3>

      <p>A Thing Description can be used in two fundamentally
        different deployment scenarios:</p>
      <ul>
        <li>a "brown-field" scenario, where it is created
          to describe the interactions with existing systems.</li>

        <li>a "green-field" scenario, where a device model
          and a thing description are developed together.</li>
      </ul>

      <p>
        For green field deployments, where the implementations
        are being carried out and corresponding thing
        descriptions are being created, it is easier to achieve
        full interoperability by using a small, extensible <a>Baseline
          Profile</a>.
      </p>

      <p>In the brown field area, due to the nature of
        existing deployments and protocols, a broad spectrum of
        variations and potentially high complexity of thing
        descriptions inhibits interoperability and will most
        likely lead to additional profiles of the <a>WoT Thing Description</a>
        and domain-specific thing consumer implementations.</p>

      <p>
        The WoT <a>Baseline Profile</a> can be used by green field
        deployments and gives guidance to new implementers of
        the WoT specifications. It has already proved in
        brown-field scenarios in the PlugFests, where existing
        devices, that already existed as products, prototypes or
        demonstrators, were described with Thing Descriptions
        that are constrained to the <a>Baseline Profile</a>.
      </p>
    </section>

    <!-- Use Cases -->
    <section id="profile-use-cases">
      <h2>Use Cases and Requirements</h2>
      <p>
        A set of over 30 use cases for the Web of Things were contributed by stakeholders
        from multiple industries for various application domains.
        These have been published in the WoT Use Cases and Requirements document [[wot-usecases]].
      </p>
      <p>
        Based on these use cases a set of requirements have been derived which drive the development
        of the W3C Web of Things specification family.
        Several of these domains require easy integration of devices from multiple vendors,
        in other words, out-of-the-box interoperability.
        However, the descriptive approach taken by the WoT specifications generally leads
        to a large variety of different protocols and data formats,
        which can work against out-of-the box interoperability.
      </p>
      <p>
        For example, a WoT Thing Description (TD) can in theory include a description based on a
        networking protocol unknown to a device that wishes to connect to it.
        To ensure interoperability without additional customization (e.g. by writing software or
        performing complex setup or configuration steps),
        the range of such choices needs to be limited to a finite set so that a consumer
        of a Thing Description can be sure it will be able to interact with any possible Thing.
        A finite set of customization choices is also important for implementing devices with a fixed code base.
        Defining such constraints leads to the profile mechanism and the HTTP Baseline profile.
      </p>
      <p>
        In addition to multiple vertical use cases that will use HTTP(S) for their implementations,
        there are horizontal use cases that are addressed by this profile specification.
        The primary focus is to enable Multi-Vendor system integration with out of the box interoperability:
      </p>
      <section id="profile-use-case-MVSE">
        <h2>Multi-Vendor System Integration - Out of the box interoperability</h2>
        Users of devices want to process data from all devices that conform to a class of devices in a uniform way.
        They need a guarantee that they are able to correctly interact with all affordances of the Thing
        that complies with this class of devices.
        Different interpretations of the same Thing Description, that lead to different behaviour, should not be
        possible.
        Users want to integrate devices in existing scenarios out of the box, i.e. with close to zero configuration
        tasks.
      </section>
    </section>

    <section id="why-profile">
      <h2 id="why-define-a-baseline-profile">
        Why a <a>Baseline Profile</a>?
      </h2>

      <p>
        During the recent WoT PlugFests there were many
        de-facto agreements on the use of a small constrained
        subset of interaction patterns and protocol choices.
        These de-facto agreements select a common subset of the
        <a>WoT Thing Description</a>, based on
        proven interoperability among manufacturers.
      </p>
      <p>
        The aim of this specification is to formalize these
        agreements by defining a <strong><a>HTTP Baseline
            Profile</a></strong> based on the choices that were made by
        the implementers of PlugFest devices.
      </p>
      <p>
        <span class="rfc2119-assertion" id="profile-1.2-why-a-baseline-profile-1">
          The <a>HTTP Baseline Profile</a> contains additional
          normative requirements that MUST be satisfied by devices
          to be compliant to the profile.
        </span>
      </p>
      <figure id="http-baseline-Profile-figure">
        <img src="images/WoT Baseline Profile.png" class="wot-profiles" alt="http-baseline-Profile-Picture" />
        <figcaption>WoT Baseline Profile - A Subset of Affordances</figcaption>
      </figure>
      <p>
        Adoption of the <a>HTTP Baseline Profile</a> will
        significantly limit the implementation burden of device
        and cloud implementors.
      </p>
      <p>
        The <a>HTTP Baseline Profile</a> was defined with the
        following main goals:
      </p>
      <ul>
        <li>guarantee interoperability among all
          implementations of the profile.</li>
        <li>limit the implementation complexity.</li>
      </ul>

      <p>It makes choices on the required metadata fields as
        well as the supported interactions and protocol
        endpoints. It introduces some constraints on data
        schemas for properties and actions which are required
        for resource constrained devices in real-world
        deployments. The format does not forbid the use of
        additional elements of the <a>WoT Thing Description</a> for vendor specific
        extensions, however this will impact interoperability.</p>
    </section>
    <section>
      <h2 id="out-of-the-box-interoperability">Out-of-the-box
        interoperability</h2>
      <p>
        Devices, which implement the <a>Baseline Profile</a>, are <strong>out-of-the-box
          interoperable</strong> with other <a>Baseline Profile</a>
        compliant devices. Furthermore, the <a>Baseline Profile</a>
        simplifies device validation and compliance testing
        since a corresponding conformance test suite can be
        defined.
      </p>
      <p>
        The following classification adopts the terminology as described in the
        "H2020 â€“ CREATE-IoT Project - Recommendations for commonalities and
        interoperability profiles of IoT platforms" [[?H2020-CREATE-IoT]]
        report.
        The definitions below have been adapted to reflect the scope of the WoT profile.
      </p>
      <h3 id="out-of-the-box-interoperability-technical-interop">Technical Interoperability</h3>
      <p><em>Technical Interoperability</em> is usually associated with communication protocols and the
        infrastructure needed for those protocols to operate. This implies agreeing on a common protocol
        (e.g. HTTP / TCP/IP) and providing additional clarifications, where required.
      </p>

      <h3 id="out-of-the-box-interoperability-syntactic-interop">Syntactic Interoperability</h3>
      <p><em>Syntactic Interoperability</em> is usually associated with data formats and encodings along with
        techniques for compressing them. Examples for these formats and encodings in the WoT are JSON,
        XML, JSON-LD, UTF-8 payloads.
      </p>
      <h3 id="out-of-the-box-interoperability-technical-interop">Semantic Interoperability</h3>
      <p>
        <em>Semantic Interoperability</em> is associated with a common understanding of the behavior of communication
        partners.
        In the profile context, it includes a common interpretation of (synchronous and asynchronous) action semantics,
        a common event model, how to set/get multiple properties, writable properties,
        a common error model and error messages.
      </p>
      <p>
        Domain specific ontologies, e.g. semantic interop of automotive and medical devices exceed the scope of the
        profile.
      </p>
      <h3 id="out-of-the-box-interoperability-organisational-interop">Organisational Interoperability</h3>
      <p>
        <em>Organisational Interoperability</em> in the profile context implies that any consumer,
        which conforms with a given profile can interact with any Thing which conforms
        with the same profile, without additional customization.
      </p>
      <p>
        Organisational Interoperability also requires commonly agreed approaches to security,
        trust and privacy, i.e. a consumer is provided access to Things only, when these
        common terms and conditions are applied.
      </p>
      <p>
        Devices created by various engineers, vendors and SDOs that satisfy the requirements
        of the profile spec can be integrated with compliant consumers without additional customization.
        This works across infrastructures, regions and cultures.
      </p>
    </section>
    <section>
      <h2>Structure of this document</h2>
      <section class="ednote">to be added.</section>
    </section>
  </section>
  <section id="conformance">
    <p>
      A device or consumer implementation complies with this specification if it follows
      the normative statements in the present document.
    <p>
      A JSON Schema [[?JSON-SCHEMA]] to validate the compliance of a Thing Description
      with the baseline profile is provided in Appendix <a href="#baseline-profile-json-schema"></a>.
    </p>
  </section>

  <section id="terminology">
    <h2 id="x3-terminology">Terminology</h2>

    <p>The fundamental WoT terminology such as
      <dfn class="lint-ignore">Thing</dfn>,
      <dfn class="lint-ignore">Consumer</dfn>,
      <dfn class="lint-ignore">Thing Description</dfn> (<dfn class="lint-ignore">TD</dfn>),
      <dfn class="lint-ignore">WoT Thing Description</dfn>,
      <dfn class="lint-ignore">Partial TD</dfn>,
      <dfn class="lint-ignore">Thing Model</dfn> (<dfn class="lint-ignore">TM</dfn>),
      <dfn class="lint-ignore">Interaction Model</dfn>,
      <dfn class="lint-ignore">Interaction Affordance</dfn>,
      <dfn class="lint-ignore">Property</dfn>,
      <dfn class="lint-ignore">Action</dfn>,
      <dfn class="lint-ignore">Event</dfn>,
      <dfn class="lint-ignore">Protocol Binding</dfn>,
      <dfn class="lint-ignore">Servient</dfn>,
      <dfn class="lint-ignore">Vocabulary</dfn>,
      <dfn class="lint-ignore">Term</dfn>,
      <dfn id="dfn-vocab-term" class="lint-ignore">Vocabulary Term</dfn>,
      <dfn class="lint-ignore">WoT Interface</dfn>, and
      <dfn class="lint-ignore">WoT Runtime</dfn>
      are defined in <a href="https://www.w3.org/TR/wot-architecture/#terminology">Section 3</a>
      of the WoT Architecture specification [[?WOT-ARCHITECTURE]].

    <p>
      For convenience of the reader, we use the terms <em>keyword</em>
      and <em>field</em> for the linguistic notion <em>vocabulary term</em>
      as defined in the <em>Thing Description</em> Specification.
    </p>
    <p>
      We use the terms <em>device</em> and <em>thing</em> in an
      interchangeable manner.
    </p>

    <h4 id="additional-definitions-">Additional Definitions</h4>
    <dl>
      <dt>
        <dfn class="export">Profile</dfn>
      </dt>
      <dd>A set of prescriptive rules, to ensure that
        compliant implementations satisfy the semantic
        guarantees that are implied by them.
      </dd>
      <dt>
        <dfn>HTTP Baseline Profile</dfn>
      </dt>
      <dd>The subset of the Thing Description
        defined by the present document.</dd>
      <dt>
        <dfn>Baseline Profile</dfn>
      </dt>
      <dd>
        Synonym for <a>HTTP Baseline Profile</a>.
      </dd>

      <dfn>Baseline Information Model</dfn>
      </dt>
      <dd>
        A set of constraints and requirements on the Information Model of the Thing
        Description specification as
        defined in section <a href="#http-baseline-information-model"></a>.
      </dd>
    </dl>
  </section>


  <section id="requirements">
    <h2>Profile Requirements</h2>
    <p>
      The following requirements were identified by the WoT profile task force and are addressed by the
      Profile 1.0 specification.
    </p>
    <h3>Interoperability</h3>
    <!-- Supporters: Oracle, Intel, Siemens, Fujitsu, Ben, Cristano -->
    <p>
      This is the most important objective of the profile.
      A TD Consumer satisfying the requirements of a profile should be able to process any TD also satisfying the
      profile
      and should be able to correctly interact with all affordances of the Thing such a TD describes.
    </p>

    This implies that a profile has three parts:
    <ul>
      <li>Restrictions on TDs</li>
      <li>Implementation requirements, constraints and behavioral assertions for Consumers</li>
      <li>Implementation requirements, constraints and behavioral assertions on Things</li>
    </ul>

    <section class="note">
      Note: The WoT HTTP baseline profile does not prevent a TD to have forms for additional protocols,
      but these can be ignored by compliant consumers, and could be removed without
      affecting profile comformance and compatibility.
      This may be useful for consumers that support multiple profiles.
    </section>

    <h3>Limit and reduce complexity</h3>
    <!-- Supporters: Oracle, Siemens, Ben, Cristiano -->
    <p>
      Complexity addresses at least the follwing two things to simplify the development and
      reduce the implementation effort:
    </p>
    <ul>
      <li>Implementation complexity on a thing and consumer, e.g. eliminating the need of RDF processing,
        but still permitting semantic annotations.</li>
      <li>Simplifying thing description to have fewer variations.</li>
      <li>Limiting the effort for JSON implementation.</li>
    </ul>
    <!-- 
    Note:
    Siemens: There should be multiple forms permitted, concerns on size limits on TDs, there may be edge devices with huge TDs. 
    We should not limit the length of a TD. Context extensions (e.g. for units) may need RDF processing, 
    semantic annotations are needed for that purpose. For simple semantic annotations, a JSON parser is sufficient. 
    It is not required for all uses cases of the profile to implement RDF processing. 
    It is hard to find these numbers for limitations, in some cases you have to do a specific agreement with a 
    customer to agree on their constaints / system limits, need to discuss with the customer, 
    identify frameworks, background, we cannot find a consensus. 
    Each IoT project is different, each customer uses a different framework.
    
    Ben: agree with all points of Sebastian, not all profiles should impose storage size and bandwidth limits.
    
    Cristiano: Disagree with limit storage and bandwidth requirements and Use finite (maximum) resources.
    
    Ege: agree on the requirement, we need to determine what we exactly mean with "complexity"
    
    Oracle: Complexity applies to all potential adopters, i.e. things, gateways, edge, cloud
    -->

    <h3>No Ambiguities, select single choice</h3>
    <!-- Supporters: Oracle, Fujitsu, Intel, Ben, Cristiano, Ege -->
    <p>
      Get rid of ambiguities, i.e. clarify specifications to define interpretation of a TD and behavior of the thing and
      consumer.
    </p>
    <p>
      Examples are the choice of properties vs. actions, use of PUT or POST for HTTP, observe protocols.
    </p>
    <!--
    Notes: 
    Intel: If something is really ambiguous, it needs to be updated in the TD, if there are multiple choices, 
    Profile can narrow down to one choice. 
    Ben: broadly support the requirement, however requiring that all profiles adopt the same ontology. 
    Choice of actions vs. properties should be done in the TD.
    This will probably create new requirements for the TD spec.
    -->

    <h3>Developer guidance</h3>
    <!-- Supporters: Fujitsu, Siemens, Intel, Oracle, Ben, Cristiano-->
    <p>
      A profile should help define what needs to be implemented. This requirement also includes behavioral goals and
      recommendations about best practice for the implementation of Consumers and Things.
    </p>
    <h3>Multiple profiles (mechanism)</h3>
    <!-- Supporters: Intel, Siemens, Ben, Cristiano, Hitachi -->
    <p>
      The mechanism used to indicate that a TD satisfies a profile should be general enough to indicate
      the TD satisfies the requirements for multiple profiles.
    </p>
    <!--
      Some people are concerned about fragmentation, if multiple profiles would be defined.
      However this requirement is about the mechanism to identify the profile in use.
  
    Discussion: 
    Does this mean a thing can support multiple profiles? 
    TD already supports multiple profiles Profiling mechanism is described in the profile spec, 
    may need to be polished
    -->

    <h3>Composable profiles</h3>
    <!-- Proposer: Intel, Hitachi, Siemens, Ben(*)-->
    <p>
      It should be possible to combine multiple profiles both for production and consumption:
    </p>
    <p>
      It should be possible to indicate that a consumer can ingest TDs that satisfy one or more profiles, even if each
      TDs
      individually only satisfies one profile. For example, a Smart Building may need to use both "constrained" devices
      and
      "unconstrained" devices. A gateway consuming TDs should be able to ingest TDs designed for both the constrained
      and unconstrained
      contexts.
    </p>
    <p>
      A Thing that satisfies all the requirements for multiple TDs (for example, a device using protocols common to two
      different usage contexts) should be able to indicate that.
    </p>

    <h3>Validatible TDs</h3>
    <!-- Supporters: Intel, Oracle, Ben, Cristiano -->
    <p>
      Whether or not a TD satisfies the requirements of a given profile should be verifiable with automated tools.
      We can use the existing TD JSDON Schema as a basis and reuse the existing tooling (TD-playground)
    </p>
    <h3>Identification of profiles</h3>
    <!-- Supporters: Intel, Siemens, Fujitsu, Hitachi, Ben, Oracle -->
    <p>
      There should be a mechanism to identify which profiles a TD satisfies. This mechanism should be intrinsic to a TD,
      i.e. be in-band.
    </p>

    <h3>Profile should define a finite set of features and capabilities to implement by the consumer</h3>
    <!-- Supporters: Intel, Oracle, Fujitsu, Ben(*), IRI -->
    <p>
      A profile should limit the number of options, for example the set of possible protocols, to a finite set, so that
      a
      consumer can consume any TD in a given profile with a finite and static code base.
    </p>
    <!--
    Notes: Ben: A profile should not rule out other protocols. Things should be permitted to support other protocols, e.g.
    CoAP. Websockets are another example, these should be allowed in the same TD
    -->
    <!--
      
    <h3>Limit resource consumption</h3>
    Supporters: Oracle, Siemens (-), Fujitsu, Ben (-), Cristiano (-)
    
    Profiles should limit the maximum amount of resources necessary to generate and consume a TD.
    
    Notes: 
    
    Sebastian: We do not want limits in a profile for non-resource constrained devices. 
    I don't see the need for the current profile. 
    
    Ben: Agree that it is fine to have a profile for resource constrained devices, but should not be here. 
    
    Cristiano: Goal overlaps with limit and reduce complexity, this is use case specific, for a set of constrained devices 
    
    Oracle: All devices have resource limits. Reasonable limits increase interop, because they can be supported by a wide population of things. This will increase the likeliness of profile adoption/WoT adoption.
    
    <h3>Follow Security and Privacy Best Practices</h3>
    Proposers: Intel, Ben(*)
    
    Profiles should not specify security and protocol combinations that do not satisfy security best practices as described in the WoT Security Best Practices document.
    
    New security schemes may be added, others may be deprecated. McCool: Security best practices / guidelines are not published yet, no single scheme can be recommended, we cannot implement it across the use cases. Profile should follow best practices, we should discourage usage of insecure protocol. This could be a note to an informative document. Ben: subject to review of the actual best practices
    
    <h3>Developer Mode</h3>
    Proposers: Intel, Ben(-)
    
    There should be a mechanism to allow the "nosec" security scheme but only in a Developer context. Nosec may still be useful in a closed network even for production.
    
    Notes: this overlaps with previous section Cristiano: We can make this just a recommendation.
    -->
  </section>

  <!-- Profiling mechanism -->
  <section id="profiling-mechanism">
    <h2>Profiling Mechanism</h2>
    <p>
      In order to conform with a profile, a
      <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
      MUST conform with all the normative statements in the profile's specification.
    </p>
    <p>
      In order to denote that a given
      <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
      conforms to one or more profiles, its Thing Description MUST include a
      <a href="https://w3c.github.io/wot-thing-description/#thing">
        <code>profile</code></a> member [[wot-thing-description11]]. The value of
      the <code>profile</code> member MUST be set to either a valid URI
      [[RFC3986]] identifying a single profile, or an array of valid URIs
      identifying multiple profiles.
    </p>
    <pre class="example">
    {
      "@context": "https://www.w3.org/2019/wot/td/v1",
      "id": "urn:dev:ops:32473-WoTLamp-1234",
      "profile": "https://www.w3.org/2022/wot/profile/http-baseline/v1",
      "title": "My Lamp",
      "description": "A web connected lamp",
      ...
    }
    </pre>
    <pre class="example">
    {
      "@context": "https://www.w3.org/2019/wot/td/v1",
      "id": "urn:dev:ops:32473-WoTLamp-1234",
      "profile": [
        "https://www.w3.org/2022/wot/profile/http-baseline/v1",
        "https://www.w3.org/2022/wot/profile/http-sse/v1"
      ],
      "title": "My Lamp",
      "description": "A web connected lamp",
      ...
    }
    </pre>
  </section>

  <!-- HTTP Baseline Protocol -->
  <section id="http-baseline-profile">
    <h2>HTTP Baseline Profile</h2>
    <p>This section defines the HTTP Baseline Profile, which includes a
      <a href="#http-baseline-information-model">Information Model</a>
      and a <a href="#http-baseline-profile-protocol-binding">Protocol Binding</a>
      for reading and writing properties and invoking, querying and cancelling
      actions.
    </p>
    <p>This profile may be used in conjunction with the
      <a href="#sec-http-sse-profile">HTTP SSE Profile</a> or the
      <a href="#sec-http-webhook-profile">HTTP Webhook Profile</a> in order to provide
      operations for observing properties and listening for events.
    </p>

    <!-- Identifier -->
    <section id="http-baseline-profile-identifier">
      <h2>Identifier</h2>
      <p class="rfc2119-assertion" id="http-baseline-profile-identifier-1">
        In order to denote that a given
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
        conforms to the HTTP Baseline Profile, its Thing Description MUST have a
        <a href="https://w3c.github.io/wot-thing-description/#thing">
          <code>profile</code></a> member [[wot-thing-description]] with a value
        of <code>https://www.w3.org/2022/wot/profile/http-baseline/v1</code>.
      </p>
    </section>

    <section id="http-baseline-information-model">
      <h2>Baseline Information Model</h2>
      <p>
        The baseline information model of the HTTP profile incorporates the information model defined by chapter 5 of
        the Thing Description specification.
        The normative rules defined by that model
        are the baseline for the definition of the baseline information model
        and are normative.
      </p>
        <span class="rfc2119-assertion" id="profile-http-baseline-information-model-1">
        A baseline profile compliant implementation MUST be compliant to the Thing Description and 
        MUST additionally satisfy the requirements of this chapter.
        </span>

      <section id="general">
        <h3 id="x5-general">General</h3>
        <p>
          The profile enables to create generic consumers that can present a common UI
          from the data of the Thing Description without further out of band information.
          For this purpose a minimum set of information is required to be present in all <a>Thing Descriptions</a>.
          A common way to display IoT device data are dashboards that are constructed from various UI widgets.
          Typical elements are gauges, graphs, labels, histograms and labeled text fileds that display a value of properties.
          Actions are typically triggered by labeled buttons.            
        </p>
        <p>
        It is common for UIs to have an information button or a hovering text box on fields, 
        that shows the human user an additional description, when needed.
      </p>
        <p>
          The profile contains a few length limitations on fields to ensure that automaticall generated UIs 
          are possible. 
          For numeric values the range (minimum, maximum) should be provided to enable the display of graphs and gauges.
          Values with have a metric unit should contain a unit field to ensure a common interpretation by consumers.
        </p>
        <p>
          The following constraints and rules are applicable to multiple
          classes of the <a>WoT Thing Description</a> Specification, as they
          define interaction semantics and enable common processing of Web Things
          that are created by different manufacturers and authors.
        </p>

        <section>
          <h4>Mandatory fields</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-title-mandatory"></span>
            The field
            <code>title</code> is 
            MANDATORY for Things, Property Affordances,
            Action Affordances, Event Affordances and Data
            Schemas.
          </p>
        </section>

        <section>
          <h4>Recommended fields</h4>
          <span class="rfc2119-assertion" id="profile-description-recommended">
          The field
          <code>description</code> is 
          RECOMMENDED for Things, Property Affordances,
          Action Affordances, Event Affordances and Data
          Schemas.
        </span>
        <p>
          This recommendation enables generic UIs and provides additional 
          documentation for development and maintenance activities.
        </p>
      </section>

      <section>
        <h4>Type and Value Constraints</h4>
        <section class="ednote">
          <p>TODO:</p>
          <p>define constraints for</p>
          <p>- id</p>
          <p>- date and time values</p>
          <p>- units</p>
          <p>- geolocation</p>
          <p>- charset constraints for UI elements</p>
        </section>

          <h4>Date format</h4>
	        <p>
            <span class="rfc2119-assertion" 
                   id="profile-date-format-1">
            All date and time values MUST use the canonical dateTime representation format defined in section 3.2.7 of [xmlschema-2].
	        </span>
	        As described by this section the following constraints must be observed:
	        <span class="rfc2119-assertion" 
          id="profile-date-format-2">
            All dateTime values MUST use UTC as the time zone and use the 'Z' identifier.
          </span>
	        <span class="rfc2119-assertion" 
                id="profile-date-format-3">
	          A time value of 24:00 is not permitted; the value 00:00 MUST be used instead.
	        </span>
        </p>		

        <section>
          <h4>Length and Value Limits</h4>
          <span class="rfc2119-assertion" id="profile-title-max-length">
            The length of
            <code>title</code>
            and
            <code>titles</code>
            values is limited to 64 characters.
          </span>

          <span class="rfc2119-assertion" id="profile-description-max-length">
            The length of
            <code>id</code>, <code>description</code> and
            <code>descriptions</code>
            values MUST NOT exceed to 512 characters.
          </span>
        </section>

      <!-- TODO: later 
          <p>
            The length of
            <code>title</code>
            and
            <code>titles</code>
            values is limited to 64 characters.
          </p>
          <p>
        </section>
      -->

        <p>
          <span class="rfc2119-assertion"
            id="profile-wot-http-baseline-profile-data-model-length-and-value-Limits-1">
            Where a type permits using an
            <code>array of string</code>
            or a
            <code>string</code>
            , an
            <code>array of string</code>
            MUST be used.
          </span>

          <span class="rfc2119-assertion"
              id="profile-wot-http-baseline-profile-data-model-length-and-value-Limits-2">
              The only exception to this rule are <code>@context</code> and <code>@type</code> annotations,
              where both <code>string</code> or <code>array of string</code> MAY be used.
            </span>
        </section>

        </p>

        <p>
          <span class="rfc2119-assertion"
            id="profile-wot-http-baseline-profile-data-model-length-and-value-Limits-3">
            Where a type permits using an
            <code>array of DataSchema</code>
            or a
            <code>DataSchema</code>
            , an
            <code>array of DataSchema</code>
            MUST be used.
          </span>
        </p>
        <p>
          <span class="rfc2119-assertion"
            id="profile-wot-http-baseline-profile-data-model-length-and-value-Limits-4">
            All elements of an
            <code>enum</code>
            MUST be either
            <code>string</code>
            or
            <code>number</code>
            .
          </span>
          <span class="rfc2119-assertion"
            id="profile-wot-http-baseline-profile-data-model-length-and-value-Limits-5">
            Different types in a single
            <code>enum</code>
            are NOT PERMITTED.
          </span>
        </p>

      </section>

      <!-- Thing -->
      <section>
        <h2 id="thing">Thing</h2>
        The <a>Baseline Information Model</a> applies the following
        constraints and rules to the Thing class of the <a>WoT Thing Description</a> specification.
        <section>
          <h3>Mandatory fields</h3>
          <p>
            <span class="rfc2119-assertion" id="profile-thing-mandatory-fields-1">
              To provide minimum interoperability, the
              following metadata fields of a <a>Thing</a> MUST
              be contained in a compliant Thing Description:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>Keyword</th>
                <th>Type</th>
                <th>Constraints</th>
                <th>Rationale</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>title</td>
                <td><code>string</code></td>
                <td>max length: 64 characters</td>
                <td>generic UI</td>
              </tr>
              <tr>
                <td>base</td>
                <td><code>anyURI</code></td>
                <td></td>
                  <td>discovery</td>
              </tr>
              <tr>
                <td>id</td>
                <td><code>urn_type</code></td>
                <td>a Globally unique urn of the
                  thing</td>
                  <td>large scale deployments</td>
              </tr>
              <tr>
                <td>profile</td>
                <td><code>string</code></td>
                <td>value: "https://www.w3.org/2021/wot/profile/baseline-json-http11"</td>
              </tr>
              <tr>
                <td>version</td>
                <td><code>VersionInfo</code></td>
                <td>semantic versioning as defined by [SEMVER]</td>
                <td>enforce versioning, easy to
                  distinguish different versions of the same TD</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section>
          <h3 id="recommended-fields-thing">Recommended fields</h3>
            <p>
              <span class="rfc2119-assertion" id="profile-thing-recommended-fields-1">
              The following metadata fields of a <a>Thing</a> SHOULD be contained in a compliant
              Thing Description:
              </span>
            </p>

            <table class="def">
              <thead>
                <tr>
                  <th>Keyword</th>
                  <th>Type</th>
                  <th>Constraints</th>
                  <th>Rationale</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>description</td>
                  <td><code>string</code></td>
                  <td>Descriptive text that explains the title.</td>
                  <td>generated UI, maintenance, developer documentation</td>
                </tr>
                <tr>
                  <td>created</td>
                  <td><code>date</code></td>
                  <td>Creation date of the TD</td>
                  <td>maintenance and developer documentation</td>
                </tr>
                <tr>
                  <td>modified</td>
                  <td><code>date</code></td>
                  <td>Date when the TD was last modified</td>
                  <td>maintenance and developer documentation</td>
                </tr>
                <tr>
                  <td>support</td>
                  <td><code>anyURI</code></td>
                  <td>Contact information to obtain further help on the TD. 
                    This could be a company website or an email address of customer support.</td>
                  <td>maintenance and developer documentation</td>
                </tr>
              </tbody>
            </table>
          </section>

          <section>
            <h5 id="recommended-practice-">Recommended practice</h5>
         
            <span class="rfc2119-assertion" id="profile-5.1.2.1-thing-mandatory-fields-1">
              It is RECOMMENDED to use the value
              &quot;&quot; for strings, where the
              value cannot be determined.
           </span>

            <p>
            <span class="rfc2119-assertion" id="profile-thing-recommended-fields-2">
              If a Thing Description is used solely within
              a company, the email address of the developer
              SHOULD be used in the support field,
            </span>
            <span class="rfc2119-assertion" id="profile-thing-recommended-fields-3">
              if the Thing Description is provided externally, a support email
              address SHOULD be used.
            </span>
          </p>

          <section class="note">
            <p>
              <span id="profile-thing-mandatory-fields-4">
                It will be evaluated whether the profile also defines a new context  for 
                some new TD terms that may be introduced in TD 2.0.
              </span>
              Currently the following terms are discussed: serialNumber,
              hardwareRevision, softwareRevision, loc_latitude, loc_longitude
              loc_altitude, loc_height, and loc_depth.
            </p>
          </section>
        </section>
      </section>


      <!-- Data Schemas-->
      <section>
        <h3 id="data-schema">Data Schema</h3>
        <p>
          Data Schemas are used for the values of Properties,
          Action input and output parameters and Event message
          payloads. The value of a <em>Data Schema</em> can be
          a simple type (boolean, integer, number, string) or
          an instance of a structured type (array and object).
        </p>

        <section class="ednote" TODO>
          The <code>format</code> field permits to define new schema types.
          The profile needs to define, how mismatching types 
          that are passed in as parameters or returned objects
          are handled, i.e. specify an error behavior.
        </section>

        <p>
        The <a>Baseline Information Model</a> applies the following
        constraints and rules to the
        <code>DataSchema</code>
        class of the <a>WoT Thing Description</a>
        Specification</a>.
        </p>

        <!-- TODO: cleanup
        <h4 id="constraints-against-the-td-specification">Data
          Schema Constraints</h4>
        <p>
          The <a>Baseline Information Model</a> restricts the use of
          arrays and objects to the <strong>top level</strong>
          of Data Schemas, i.e. only a one-level hierarchy is
          permitted.
          <span class="rfc2119-assertion" id="profile-5.1.3-thing-data-schema-1">
            The members of a top level
            <code>object</code>
            or
            <code>array</code>
            MUST NOT be array or object types.
          </span>
        </p>
        <section class="note" title="RATIONALE">
          <p>
            <span id="profile-5.1.3-thing-data-schema-2">
              This may appear as a severe limitation,
              however it is motivated by integrating with
              multiple cloud services.
            </span>
            Many enterprise services and applications are based on
            (relational) databases, where individual
            property values are stored. Of course databases
            can also store objects (e.g. encoded as a JSON
            string), however this will prevent processing by
            other enterprise applications.
          </p>
          <p>
            If a property conceptually has a deeper
            structure, such as grid of lamps with RGB
            colors, the structure can be represented in the
            keyword of the property, i.e. lamp1_color_r,
            lamp1_color_g and lamp1_color_b. A similar
            mapping can be done for arrays and hierarchical
            objects. This constraint leads to simpler Thing
            Descriptions that can be handled by very
            limited devices.
          </p>
        </section>
        <p>
          <span class="rfc2119-assertion" id="profile-5.1.3-thing-data-schema-3">
          The following fields MUST be contained in a
          DataSchema:
          </span>
        </p>
        <table class="def">
          <thead>
            <tr>
              <th>keyword</th>
              <th>type</th>
              <th>constraints</th>
            </tr>
          </thead>
          <tbody>
            <tr class="rfc2119-table-assertion" id="profile-5.1.3-thing-data-schema-3--description">
              <td>description</td>
              <td>human readable description</td>
            </tr>
            <tr class="rfc2119-table-assertion" id="profile-5.1.3-thing-data-schema-3--type">
              <td>type</td>
              <td>string</td>
              <td>one of boolean, integer, number,
                string, array or object</td>
            </tr>
          </tbody>
        </table>
        <p>
          <span class="rfc2119-assertion" id="profile-5.1.3-thing-data-schema-4">
            The values
            <code> object </code>
            ,
            <code> array </code> MAY only be used at the top level of a Data Schema.
          </span>
          <span class="rfc2119-assertion" id="profile-5.1.3-thing-data-schema-5">
            The type value MUST NOT be <code> null </code>.
          </span>
        </p>
      -->
      </section>


      <!-- Properties -->

      <section>
        <h3 id="x5-property-affordance">Property Affordance</h3>
        The <a>Baseline Information Model</a> applies the following
        constraints and rules to the
        <code>PropertyAffordance</code>
        class of the <a>WoT Thing Description</a> Specification.
        <section>
          <h4>Mandatory fields</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-thing-property-affordance-mandatory-fields-1">
              The following property fields MUST be contained
              in the
              <code>properties</code>
              element of a <em>Profile compliant TD</em>:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>Keyword</th>
                <th>Type</th>
                <th>Constraints</th>
                <th>Rationale</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>title</td>
                <td><code>string</code></td>
                <td>unique name among all
                  properties</td>
                  <td>unambigous UI labels</td>
                  </tr>
               <tr>
                <td>type</td>
                <td><code>string</code></td>
                <td>
                  <span class="rfc2119-assertion" id="profile-thing-property-affordance-mandatory-fields-2">
                    one of <code>boolean</code>,
                    <code> string </code>, <code>
                                          number </code>, <code> integer
                                      </code>, <code> object </code> or <code>
                                          array </code>. The type value <code>
                                          null </code> MUST NOT be used.
                    </span>
                </td>
                <td>well defined types</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section>
          <h4>Additional Constraints</h4>
          <!--Consider also DTDL constraints -->
          <p>
            The <em>Thing Description</em> permits arbitrary
            object depths for properties. Parsing of a
            deeply nested structure may cause significant implementation complexity.
            <span class="rfc2119-assertion" id="profile-thing-property-affordance-additional-constraints-1">
            Therefore each
            property MUST NOT exceed a maximum depth
	          of 5 levels of nested
            <code>array</code>
            or
            <code>object</code>
            elements. 
	          </span>
            <span class="rfc2119-assertion" id="profile-thing-property-affordance-additional-constraints-1b">
	          It is RECOMMENDED to keep the nesting
	          of 
            <code>array</code>
            or
            <code>object</code>
		  elements below 4.
            </span>
          </p>

          <p>
              <span class="rfc2119-assertion" id="profile-thing-property-affordance-additional-constraints-2">
              The following additional constraints MUST be
              applied to the Property Affordances of a <em>Thing
                Description</em> conforming to the <a>Baseline
                Profile</a>:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>Keyword</th>
                <th>Type</th>
                <th>Constraint</th>
                <th>Rationale</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>const</td>
                <td>anyType</td>
                <td>
                  <span class="rfc2119-assertion"
                    id="profile-5.1.4.2-thing-property-affordance-additional-constraints-3">
                    MUST NOT be used
                  </span>
                </td>
              </tr>
              <tr>
                <td>enum</td>
                <td>array of simple type</td>
                <td>
                  <span class="rfc2119-assertion"
                    id="profile-5.1.4.2-thing-property-affordance-additional-constraints-4">
                    <em>Values</em> of enums MAY
                    only be simple types. Handling of <em>any
                      type</em> is too complex to implement
                    on resource constrained devices
                  </span>
                </td>
              </tr>
                <td>forms</td>
                <td><code>array</code> of Forms</td>
                <td>
                  <p>
                  <span class="rfc2119-assertion" id="profile-thing-property-affordance-additional-constraints-5">
                  For a single protocol the <code>Array of Form</code>
                  of each property MUST contain only a
                  <em>single endpoint</em> for each
                  operation <code>readproperty</code>, 
                  <code>writeproperty</code>, <code>observeproperty</code>,
                  <code>unobserveproperty</code>.
                  </span>
                  </p><p>                  
                  <span class="rfc2119-assertion" id="profile-thing-action-affordance-form-constraints-2">
                    The value of <code>op</code> MUST be a single value.
                    Arrays with combinations of these values are NOT PERMITTED.
                  </span>
                <!-- /p>
                </td>
                <td><p>If multiple endpoints for the same protocol are present, 
                  a common selection algorithm has to be defined. 
                  This may imply invoking form elements in sequence with 
                  a trial and error method that can lead to significant 
                  delays due to timeout handling obligations. 
                </p>
                <p>
                  Combination of operations are ambiguous and have very
                  complex interaction semantics.
                </p-->
              </td>
              </tr>
              <tr>
                <td>format</td>
                <td><code>string</code></td>
                <td>
                  <span class="rfc2119-assertion" id="profile-thing-property-affordance-additional-constraints-6">
                  If the field <code>format</code>
                  is used, only formats defined in
                  section 7.3.1-7.3.6 of
                  [[JSON-SCHEMA]] MUST be used.
                  </span>
                </td>
                <td>Predictive finite set of choices.</td>
              </tr>
              <tr>
                <td>oneOf</td>
                <td>string</td>
                <td>
                  <span class="rfc2119-assertion"
                    id="profile-5.1.4.2-thing-property-affordance-additional-constraints-7">
                    The DataSchema field <code>oneOf</code>
                    does not make sense for properties
                    and MUST NOT be used.
                  </span>
                </td>
              </tr>
              <tr>
                <td>uriVariables</td>
                <td>Map of DataSchema</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-thing-property-affordance-additional-constraints-8">
                  <code>uriVariables</code> MUST
                  NOT be used.
                  </span>
                  <td>The semantic meaning of URI variables cannot be described in a TD in an unambiguous way.</td>
                </td>
              </tr>

            </tbody>
          </table>
          <span class="rfc2119-assertion" id="profile-thing-action-affordance-additional-constraints-7">
            The DataSchema fields <code>default</code> and
            <code>oneOf</code>
            are undefined for properties and MUST NOT be used.
          </span>
          </section>

        <section>
          <h4>Recommended Practice</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-property-recommended-practice">
              The following property fields SHOULD be contained in the <code>properties</code>
              element of a <em>Profile compliant TD</em>:
              </span>
            </p>
            <table class="def">
              <thead>
                <tr>
                  <th>Keyword</th>
                  <th>Type</th>
                  <th>Constraints</th>
                  <th>Rationale</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>description</td>
                  <td><code>string</code></td>
                  <td>max length</td>
                  <td>generated UI, maintenance, developer documentation</td>
                </tr>
              </tbody>
            </table>
            <p>
              <span class="rfc2119-assertion" id="profile-thing-property-recommended-fields-2">
                It is highly RECOMMENDED to always specify a
                <code>unit</code>, if a value has a metric.
              </span>
                Authors of <em>Thing Descriptions</em> should be aware, that units
                that are common in their geographic region are
            not globally applicable and may lead to
            misinterpretation with drastic consequences.
          </p>
          <p>
            The field
            <code>unit</code>
            could be used for non-decimal numeric types as
            well, e.g. a string value with binary or hex
            data (
            <code>0xCAFEBABE</code>
            ,
            <code>0b01000010</code>
            ), where the unit is
            <code>hex</code>
            or
            <code>bin</code>
            ,
            to indicate how the value should be
            interpreted. 
            <span class="rfc2119-assertion" id="profile-thing-properties-recommended-practice-2">
              It is strongly RECOMMENDED to use
              the values
              <code>hex</code>
              ,
              <code>oct</code>
              or
              <code>bin</code>
              in the <code>unit</code> for string values with binary or hex data to achieve interoperability.
            </span>
            </p>
            <!-- TODO: consider how to indicate specific types such as char, signed/unsigned short, ... -->
        </section>
      </section>


      <!-- Actions -->
      <section>
        <h3 id="x5-action-affordances">Action Affordances</h3>
        The <a>Baseline Information Model</a> applies the following
        constraints and rules to the
        <code>ActionAffordance</code>
        class of the <a>WoT Thing Description</a> Specification.

        <section>
          <h4>Mandatory fields</h4>

          <p>
            <span class="rfc2119-assertion" id="profile-thing-action-affordances-mandatory-fields-1">
              The following fields MUST be contained in an
              action element of an <a>Baseline Profile</a> compliant TD:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>Keyword</th>
                <th>Type</th>
                <th>Constraints</th>
                <th>Rationale</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>title</td>
                <td><code>string</code></td>
                <td>unique name among all actions</td>
                <td>unambigous UI labels</td>
               </tr>
               <!-- TODO: revisit 
               <tr class="rfc2119-table-assertion" id="profile-5.1.5.1-thing-action-affordances-mandatory-fields-1-input">
              <tr>
                <td>input</td>
                <td>array of DataSchema</td>
                <td>schemas describing the input to an action
		</td>
              </tr>
              <tr class="rfc2119-table-assertion" id="profile-5.1.5.1-thing-action-affordances-mandatory-fields-1-output">
                <td>output</td>
                <td>array of DataSchema</td>
                <td>schemas describing the output of an action
                </td>
              </tr>
            -->
            </tbody>
          </table>
          <!-- TODO: revisit
                  <span class="rfc2119-assertion" id="profile-5.1.5.1-thing-action-affordances-mandatory-fields-2">
		  In the <code>input</code> field,
                  all elements of the subclasses
                  objectSchema and dataSchema MUST
                  only contain simple types.
                  </span>
                  <span class="rfc2119-assertion" id="profile-5.1.5.1-thing-action-affordances-mandatory-fields-3">
		  In the <code>output</code> field,
                  all elements of the subclasses
                  objectSchema and dataSchema MUST
                  only contain simple types.
                  </span>
                -->
        </section>

        <section>
          <h4>Additional Constraints</h4>
          <!-- TODO: REVISIT 
          <p>
            The elements of the DataSchema subclasses
            ArraySchema and ObjectSchema for the fields
            <code>input</code>
            and
            <code>output</code>
            are restricted to simple types in a <a>Thing
              Description</a> conforming to the <a>Baseline
              Information Model</a>. Without this limitation a higher
            implementation burden would be put on resource
            constrained devices (arbitrary cascaded arrays
            and multi-level objects) which cannot be
            satisfied by all consuming devices.
          </p>
        -->

          <p>
            <span class="rfc2119-assertion" id="profile-thing-action-affordance-additional-constraints-1">
            The following additional constraints MUST be
            applied to the indicated fields of the Interaction Affordances of a <a>Thing
              Description</a> conforming to the <a>Baseline
              Information Model</a>:
            </span>
          </p>
                <td>forms</td>
                <td>array of Forms</td>
                <td>
                  <p><span class="rfc2119-assertion" id="profile-thing-action-affordance-form-constraints-1">
                    For a single protocol the <code>array of Form</code>
                    of each property MUST contain only a
                    <em>single endpoint</em> for each
                    operation.
                    </span>
                  </p><p>
                    <span class="rfc2119-assertion" id="profile-thing-action-affordance-form-constraints-2">
                      The value of <code>op</code> MUST be a single value.
                      Arrays with combinations of these values are NOT PERMITTED.
                    </span>
                    </p>
                </td>
                <!--td>
                  <p>If multiple endpoints for the same protocol would be present, 
                  a common selection algorithm has to be defined. 
                  This may imply invoking form elements in sequence with 
                  a trial and error method that can lead to significant 
                  delays due to timeout handling obligations. 
                  </p>
                  <p>
                    Combination of operations are ambiguous and have very 
                    complex interaction semantics.
                  </p>
                </td-->              
                </tr>
                <tr>
                  <td>format</td>
                  <td><code>string</code></td>
                  <td>
                    <span class="rfc2119-assertion" id="profile-thing-action-affordance-format-constraints">
                    If the field <code>format</code>
                    is used, only formats defined in
                    section 7.3.1-7.3.6 of
                    [[JSON-SCHEMA]] MUST be used.
                    </span>
                  </td>
                  <td>Predictive finite set of choices.</td>
                  <!-- TODO: revisit
                </td>
              </tr>
              <tr>
                <td>format</td>
                <td>string</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-5.1.5.2-thing-action-affordance-additional-constraints-1_format">
                  If the field <code>format</code>
                  is used, formats defined in
                  section 7.3.1-7.3.6 of
                  [[JSON-SCHEMA]] MUST be used.
                  </span>
                </td>
              </tr>
              <tr>
                <td>oneOf</td>
                <td>string</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-5.1.5.2-thing-action-affordance-additional-constraints-1_oneOf">
                  The DataSchema field <code>oneOf</code>
                  does not make sense for properties
                  and MUST NOT be used.
                  </span>
                </td>
              -->
              </tr>
              <tr>
                <td>uriVariables</td>
                <td>Map of DataSchema</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-thing-action-affordance-uri-variables">
                    <code>uriVariables</code> MUST
                    NOT be used.
                    </span>
                    <td>The semantic meaning of URI variables cannot be described in a TD in an unambiguous way.</td>
                  </td>
              </tr>
            </tbody>
          </table>
   
        <!-- TODO: span class="rfc2119-assertion" id="profile-thing-action-affordance-additional-constraints-7">
          The DataSchema fields <code>const</code>, <code>default</code>, 
               <code>unit</code>, <code>oneOf</code> and <code>enum</code>
              are undefined for actions and MUST NOT be used.
          </span-->
           </section>


        <section>
          <h4>Recommended Practice</h4>
          <!-- TODO -->
        </section>
      </section>


      <!-- Events -->
      <section>
        <h3 id="x5-event-affordance">Event Affordance</h3>
        The <a>Baseline Information Model</a> applies the following
        constraints and rules to the
        <code>EventAffordance</code>
        class of the <a>WoT Thing Description</a> Specification.

        <p>
          <span class="rfc2119-assertion" id="profile-thing-event-affordance-1">
            A <a>Thing</a> MAY define more than one event
            mechanism to enable a variety of consumers.
          </span>
        </p>

        <!-- TODO: discuss
          The "type" relationship as defined in chapter 6 of
          [[RFC6903]] is reserved for indicating an instance
          relationship between a thing and a thing template.
          The <a>Baseline Information Model</a> does not put additional
          constraints or requirements on links. The
          interpretation of a link is out of scope.
        </p-->

        <section>
          <h4>Mandatory fields</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-5.1.6.1-thing-event-affordance-mandatory-fields-1">
              The following fields MUST be present in an event
              element of a <em>Baseline TD</em>:
            </span>
          </p>
          <!-- TODO: add rationale
          <table class="def">
            <thead>
              <tr>
                <th>keyword</th>
                <th>type</th>
                <th>constraints</th>

                <th>rationale</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>title</td>
                <td>string</td>
                <td>unique name among all events</td>
              </tr>
              <tr>
                <td>description</td>
                <td>string</td>
                <td>human readable description</td>
              </tr>
              <tr>
                <td>data</td>
                <td>set of DataSchema instances in
                  a JSON object</td>
                <td>only the DataSchema subclasses
                  booleanSchema, IntegerSchema,
                  NumberSchema, StringSchema are
                  permitted</td>
              </tr>
            </tbody>
          </table>
        -->
        </section>
        <section>
          <h4>Additional Constraints</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-5.1.6.2-thing-event-affordance-additional-constrains-1">
              The following additional constraints MUST be
              applied to the Event Affordances of a <a>WoT Thing
                Description</a> conforming to the profile:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>keyword</th>
                <th>type</th>
                <th>constraint</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>forms</td>
                <td>array of Forms</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-5.1.6.2-thing-event-affordance-additional-constrains-2">
                    The <code>Array of Form</code>
                    of each event MUST contain only a <em>single</em>
                    endpoint.
                  </span>
                </td>
              </tr>
              <tr>
                <td>uriVariables</td>
                <td>Map of DataSchema</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-5.1.6.2-thing-event-affordance-additional-constrains-3">
                    <code>uriVariables</code> MUST
                    NOT be used.
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>

      <!-- Forms -->
      <section>
        <h3 id="forms">Forms</h3>
        <p>
          <span class="rfc2119-assertion" id="profile-thing-forms-1">
            A <a>Thing</a> MAY provide more than one event
            mechanism to enable a variety of consumers.
          </span>
        </p>
        <section>
          <h4>Mandatory fields</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-thing-forms-mandatory-fields-1">
              The following fields MUST be present in a form
              element of a <em>Baseline TD</em>:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>keyword</th>
                <th>type</th>
                <th>constraints</th>
              </tr>
            </thead>
            <tbody>
              <tr class="rfc2119-table-assertion" id="profile-thing-forms-mandatory-fields-1-title">
                <td>title</td>
                <td>string</td>
                <td>unique name among all events</td>
              </tr>
              <tr class="rfc2119-table-assertion" id="profile-thing-forms-mandatory-fields-1-description">
                <td>description</td>
                <td>string</td>
                <td>human readable description</td>
              </tr>
              <tr class="rfc2119-table-assertion" id="profile-thing-forms-mandatory-fields-1-data">
                <td>data</td>
                <td>set of DataSchema instances in
                  a JSON object</td>
                <td>
	  	  only the DataSchema subclasses
                  BooleanSchema, IntegerSchema,
                  NumberSchema, StringSchema are
                  permitted</td>
              </tr>
            </tbody>
          </table>
        </section>
        <section>
          <h4>Additional Constraints</h4>
          <p>
            <span class="rfc2119-assertion" id="profile-5.1.7.2-thing-forms-additional-constraints-1">
              The following additional constraints MUST be
              applied to the Form elements of a <a>WoT Thing
                Description</a> conforming to the <a>Baseline
                profile</a>:
            </span>
          </p>
          <table class="def">
            <thead>
              <tr>
                <th>keyword</th>
                <th>type</th>
                <th>constraint</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>security</td>
                <td>stringÂ orÂ ArrayÂ ofÂ string</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-5.1.7.2-thing-forms-additional-constraints-1_security">
                  A <code>security</code> field at the form
                  level MUST NOT be used.
                  </span>
                </td>
              </tr>
              <tr>
                <td>scopes</td>
                <td>stringÂ orÂ ArrayÂ ofÂ string</td>
                <td>
                  <span class="rfc2119-assertion" id="profile-5.1.7.2-thing-forms-additional-constraints-1_scopes">
                  A <code>scopes</code> field MUST NOT be
                  used.
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>

      <!-- Links -->
      <section>
        <h3 id="links">Links</h3>
        <section class="ednote">
          <!-- TODO --> TODO: Consider
          selecting a defined set from [[RFC8288]].
        </section>

        <p>
          The "type" relationship as defined in chapter 6 of
          [[RFC6903]] is reserved for indicating an instance
          relationship between a thing and a thing template.
          The <a>Baseline Information Model</a> does not put additional
          constraints or requirements on links. The
          interpretation of a link is out of scope.
        </p>

          <!-- TODO 
          <h3 id="links-ednote">TODO</h3>THIS SECTION STILL NEEDS TO BE REWORKED.</section>
          <p>
          <span class="rfc2119-assertion" id="profile-thing-security-1">
          The <a>Baseline Information Model</a> defines a subset of the
          security schemes that MAY be implemented on resource
          constrained devices.
          </span>
          <span class="rfc2119-assertion" id="profile-thing-security-2">
          A security scheme MUST be
          defined at the thing level.
          </span>
          <span class="rfc2119-assertion" id="profile-thing-security-3">
          The security scheme is
          applied to the thing as a whole, a thing may adopt
          multiple security schemes.
          </span>
        </p>
        <p>
          The set of security schemes supported in the <a>Baseline
            Information Model</a> is based on the PlugFest results.
            <span class="rfc2119-assertion" id="profile-thing-security-4">
              To ensure interoperability, a TD consumer, which
              compliant with the <a>Baseline Information Model</a> MUST
              support <strong>all</strong> of the following security schemes:
            </span>
        </p>

        <ul>
          <li>no security</li>
          <li>Basic Auth</li>
          <li>Digest</li>
          <li>Bearer Token</li>
          <li>Oauth2</li>
        </ul>

        <section>
          <h4>Recommended Practice</h4>
          <p>When using the "no security" or "Basic Auth"
            security schemes it is strongly recommended to
            use transport layer encryption.</p>
        </section-->
      </section>
    </section>

    <!-- Protocol Binding -->
    <section id="http-baseline-profile-protocol-binding">
      <h3>Protocol Binding</h3>
      <p>
        This section defines a protocol binding which describes how a
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-consumer">Consumer</a>
        communicates with a
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
        [[wot-architecture11]] using JSON [[JSON]] payloads over
        the HTTP [[HTTP11]] protocol.
      </p>
      <p>
        <span class="rfc2119-assertion" id="profile-5.2-thing-protocol-binding-1">
          A Consumer or Web Thing conforming to the HTTP Baseline Profile
          MUST implement this protocol binding.
        </span>
      </p>

      <p>
        The examples provided throughout this section describe how a Consumer
        would communicate with a Web Thing which produces the following Thing
        Description:
      </p>

      <pre class="example">
        {
          "@context": "https://www.w3.org/2019/wot/td/v1",
          "id": "https://mywebthingserver.com/things/lamp",
          "profile": "https://www.w3.org/2022/wot/profile/http-baseline/v1",
          "base": "https://mywebthingserver.com/things/lamp/",
          "title": "My Lamp",
          "description": "A web connected lamp",
          "securityDefinitions": {
            "oauth2": {
              "scheme": "oauth2",
              "flow": "code",
              "authorization": "https://mywebthingserver.com/oauth/authorize",
              "token": "https://mywebthingserver.com/oauth/token"
            }
          },
          "security": "oauth2",
          "properties": {
            "on": {
              "type": "boolean",
              "title": "On/Off",
              "description": "Whether the lamp is turned on",
              "forms": [{"href": "properties/on"}]
            },
            "level" : {
              "type": "integer",
              "title": "Brightness",
              "description": "The level of light from 0-100",
              "unit": "percent",
              "minimum" : 0,
              "maximum" : 100,
              "forms": [{"href": "properties/level"}]
            }
          },
          "actions": {
            "fade": {
              "title": "Fade",
              "description": "Fade the lamp to a given level",
              "input": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 100,
                    "unit": "percent"
                  },
                  "duration": {
                    "type": "integer",
                    "minimum": 0,
                    "unit": "milliseconds"
                  }
                }
              },
              "forms": [{"href": "actions/fade"}]
            }
          },
          "forms": [
            {
              "op": ["readallproperties", "writemultipleproperties"],
              "href": "properties"
            },
            {
              "op": "queryallactions",
              "href": "actions"
            }
          ]
        }
      </pre>

      <section id="http-baseline-profile-protocol-binding-properties">
        <h4>Properties</h4>
        <section id="http-baseline-profile-protocol-binding-readproperty">
          <h5><code>readproperty</code></h5>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-properties-readproperty-1">
            The URL of a <code>Property</code> resource to be used when reading
            the value of a property MUST be obtained from a Thing Description by
            locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the corresponding
            <a href="https://www.w3.org/TR/wot-thing-description/#propertyaffordance">
              <code>PropertyAffordance</code></a>
            for which:
	  <em>
	  FIX: this should have sub-assertions, at least.
	  </em>
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-properties-readproperty-2">
	 <ul>
            <li>
              After defaults have been applied, its <code>op</code> member
              contains the value <code>readproperty</code>.
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion"
          id="core-profile-protocol-binding-properties-readproperty-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Property</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readproperty-4">
            In order to read the value of a property, a Consumer MUST send
            an HTTP request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-properties-readproperty-5">
	  <ul>
            <li>Method set to <code>GET</code></li>
            <li>URL set to the URL of the <code>Property</code> resource</li>
            <li><code>Accept</code> header set to <code>application/json
              </code></li>
          </ul>
	  </span>
          <pre class="example">
          GET /things/lamp/properties/on HTTP/1.1
          Host: mythingserver.com
          Accept: application/json
          </pre>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-properties-readproperty-6">
            If a Web Thing receives an HTTP request following the format
            above and the Consumer has permission to read the corresponding
            property, then upon successfully reading the value of the property
            it MUST send an HTTP response with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-properties-readproperty-7">
	  <ul>
            <li>Status code set to <code>200</code></li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body with the value of the property serialized in JSON</li>
          </ul>
	  </span>
          <pre class="example">
          HTTP/1.1 200 OK
          Content-Type: application/json
          false
          </pre>
        </section>
        <section id="http-baseline-profile-protocol-binding-writeproperty">
          <h5><code>writeproperty</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writeproperty-1">
            The URL of a <code>Property</code> resource to be used when writing
            the value of a property MUST be obtained from a Thing Description by
            locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the corresponding
            <a href="https://www.w3.org/TR/wot-thing-description/#propertyaffordance">
              <code>PropertyAffordance</code></a>
            for which:
	  </p>
	  <ul>
            <li>
              After defaults have been applied, its <code>op</code> member
              contains the value <code>writeproperty</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion" 
          id="core-profile-protocol-binding-properties-writeproperty-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Property</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writeproperty-4">
            In order to write the value of a property, a Consumer MUST send
            an HTTP request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writeproperty-5">
	  <ul>
            <li>Method set to <code>PUT</code></li>
            <li>URL set to the URL of the <code>Property</code> resource</li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body with a requested new value for the property serialized
              in JSON</li>
          </ul>
	  </span>
          <pre class="example">
          PUT /things/lamp/properties/on HTTP/1.1
          Host: mythingserver.com
          Content-Type: application/json
          true
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writeproperty-6">
            If a Web Thing receives an HTTP request following the format
            above and the Consumer has permission to write the corresponding
            property, then upon successfully writing the value of the
            property it MUST send an HTTP response with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writeproperty-7">
	  <ul>
            <li>Status code set to <code>204</code></li>
          </ul>
	  </span>
          <pre class="example">
          HTTP/1.1 204 No Content
          </pre>
        </section>
        <section id="http-baseline-profile-protocol-binding-readallproperties">
          <h5><code>readallproperties</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readallproperties-1">
            The URL of a <code>Properties</code> resource to be used when
            reading the value of all properties at once MUST be obtained from a
            Thing Description by locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the top level
            <a href="https://www.w3.org/TR/wot-thing-description/#form-serialization-json">
              <code>forms</code></a> member
            for which:
	  </p>
	  <ul>
            <li>
              Its <code>op</code> member contains the value
              <code>readallproperties</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readallproperties-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Properties</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readallproperties-3">
            In order to read the value of all properties, a Consumer MUST send
            an HTTP request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readallproperties-4">
	  <ul>
            <li>Method set to <code>GET</code></li>
            <li>URL set to the URL of the <code>Properties</code> resource
            </li>
            <li><code>Accept</code> header set to <code>application/json
              </code></li>
          </ul>
	  </span>
          <pre class="example">
          GET /things/lamp/properties HTTP/1.1
          Host: mythingserver.com
          Accept: application/json
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readallproperties-5">
            If a Web Thing receives an HTTP request following the format
            above, then upon successfully reading the values of all the
            readable properties to which the Consumer has permission to
            access, it MUST send an HTTP response with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-readallproperties-6">
	  <ul>
            <li>Status code set to <code>200</code></li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body with the values of all readable properties serialized
              in JSON, as an object keyed by property name</li>
          </ul>
	  </span>
          <pre class="example">
          HTTP/1.1 200 OK
          Content-Type: application/json
          {
            "on": false,
            "level": 100
          }
          </pre>
        </section>
        <section id="http-baseline-profile-protocol-binding-writemultipleproperties">
          <h5><code>writemultipleproperties</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writemultipleproperties-1">
            The URL of a <code>Properties</code> resource to be used when 
            writing the value of multiple properties at once MUST be obtained
            from a Thing Description by locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the top level
            <a href="https://www.w3.org/TR/wot-thing-description/#form-serialization-json">
              <code>forms</code></a> member
            for which:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writemultipleproperties-2">
	  <ul>
            <li>
              Its <code>op</code> member contains the value
              <code>writemultipleproperties</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writemultipleproperties-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Properties</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writemultipleproperties-4">
            In order to write the value of multiple properties at once, a
            Consumer MUST send an HTTP request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writemultipleproperties-5">
	  <ul>
            <li>Method set to <code>PUT</code></li>
            <li>URL set to the URL of the <code>Properties</code> resource
            </li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body with requested new values for the writable properties
              serialized in JSON, as an object keyed by property name</li>
          </ul>
	  </span>
          <pre class="example">
          PUT /things/lamp/properties HTTP/1.1
          Host: mythingserver.com
          Content-Type: application/json
          {
            "on": true,
            "level": 50
          }
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-properties-writemultipleproperties-6">
            If a Web Thing receives an HTTP request following the format
            above, then upon successfully writing the values of the requested
            writable properties it MUST send an HTTP response with:
            <ul>
              <li>Status code set to <code>204</code></li>
            </ul>
	  </span></p>
          <pre class="example">
          HTTP/1.1 204 No Content
          </pre>
        </section>
        <section class="ednote">
          <p>
            The <code>readmultipleproperties</code> operation is currently excluded due to
            the complexities of the request payload format and because it
            doesn't add much functionality over <code>readproperty</code> and
            <code>readallproperties</code>.
            <code>writeallproperties</code> is currently excluded because it
            is just a special case of <code>writemultipleproperties</code>.
          </p>
        </section>
      </section>
      <section id="http-baseline-profile-protocol-binding-actions">
        <h4>Actions</h4>
        <section id="http-baseline-profile-protocol-binding-invokeaction">
          <h5><code>invokeaction</code></h5>
	  <span class="rfc2119-assertion"
            id="http-baseline-profile-protocol-binding-invokeaction-1">
	  <p>
            The URL of an <code>Action</code> resource to be used when invoking
            an action MUST be obtained from a Thing Description by locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the corresponding
            <a href="https://www.w3.org/TR/wot-thing-description/#actionaffordance">
              <code>ActionAffordance</code></a>
            for which:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-invokeaction-2">
	 <ul>
            id="core-profile-protocol-binding-actions-invokeaction-2">
            <li>
              After defaults have been applied, the value of its
              <code>op</code> member is <code>invokeaction</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-invokeaction-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Action</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-invokeaction-4">
            In order to invoke an action on a Web Thing, a Consumer MUST send
            an HTTP request to the Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-invokeaction-5">
	  <ul>
            <li>Method set to <code>POST</code></li>
            <li>URL set to the URL of the <code>Action</code> resource</li>
            <li><code>Accept</code> header set to <code>application/json
              </code></li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body with an input to the action, if any, serialized in
              JSON</li>
          </ul>
	  </span>
          <pre class="example">
          POST /things/lamp/actions/fade HTTP/1.1
          Host: mythingserver.com
          Content-Type: application/json
          Accept: application/json
          {
            "level": 100,
            "duration": 5
          }
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-6">
            If a Web Thing receives an HTTP request following the format
            above then it MUST respond with one of three response formats:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-7">
          <ol>
            <li>
              <a href="#sync-action-response">Synchronous Action Response</a>
            </li>
            <li>
              <a href="#async-action-response">Asynchronous Action Response</a>
            </li>
            <li>
              <a href="#error-responses">Error Response</a>
            </li>
          </ol>
	  </span>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-8">
            For long-running actions which are not expected to finish executing
            within the timeout period of an HTTP request (e.g. 30 to 120
            seconds), it is RECOMMENDED that a Web Thing respond with an
            Asynchronous Action Response so that a Consumer may continue to
            monitor the status of an action request with a
            <code>queryaction</code> operation on a dynamically created
            <code>ActionStatus</code> resource, after the initial
            <code>invokeaction</code> response.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-9">
            For short-lived actions which are expected to finish executing
            within the timeout period of an HTTP request, a Web Thing MAY wait
            until the action has completed to send a Synchronous Action
            Response.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-10">
            If a Web Thing encounters an error in attempting to execute an
            action before responding to the <code>invokeaction</code> request,
            then it MUST send an Error Response.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-11">
            Conforming Consumers MUST support all three types of response 
            to the initial <code>invokeaction</code> request, but 
            support for subsequent operations on an <code>ActionStatus</code>
            resource is OPTIONAL.
	    <em>
	    FIX: this assertion combines mandatory and optional statements in 
	    a confusing way.  Should be reworded as two separte assertions.
	    </em>
	  </span></p>

          <h6 id="ActionStatus"><code>ActionStatus</code> object</h6>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-12">
            The status of an action invocation request is represented by an 
            <code>ActionStatus</code> object which includes the following 
            members:
	    <em>
	   FIX: use table assertions...
	    </em>
	  <span></p>

          <table class="def">
            <thead>
              <tr>
                <th>Member</th>
                <th>Description</th>
                <th>Assignment</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              <tr class="rfc2119-table-assertion">
                <td><code>status</code></td>
                <td>The status of the action request.</td>
                <td>mandatory</td>
                <td>
                  <a href="http://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#string">
                    <code>string</code></a> (one of <code>pending</code>,
                  <code>running</code>, <code>completed</code> or
                  <code>failed</code>)
                </td>
              </tr>
              <tr class="rfc2119-table-assertion">
                <td><code>output</code></td>
                <td>
                  The output data, if any, of a completed action which
                  MUST conform with the <code>output</code> data schema of the
                  corresponding
                  <a href="https://www.w3.org/TR/wot-thing-description/#actionaffordance">
                    <code>ActionAffordance</code></a>.
                </td>
                <td>optional</td>
                <td>any type</td>
              </tr>
              <tr class="rfc2119-table-assertion">
                <td><code>error</code></td>
                <td>
                  An error message, if any, associated with a failed action
                  which MUST use the JSON serialization of the Problem Details
                  format [[RFC7807]] (only needed in response to a
                  <a href="#http-baseline-profile-protocol-binding-queryaction"><code>queryaction</code></a>
                  operation).
                </td>
                <td>optional</td>
                <td><code>object</code></td>
              </tr>
              <tr class="rfc2119-table-assertion">
                <td><code>href</code></td>
                <td>
                  The [[URL]] of an <code>ActionStatus</code> resource which can
                  be polled with a <code>queryaction</code> operation to get
                  the latest status of the action, the
                  <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                    scheme</a> [[RFC3986]] of which MUST resolve to
                  <code>http</code> or <code>https</code> (only needed for an
                  <a href="#async-action-response">Asynchronous Action
                    Response</a>).
                </td>
                <td>optional</td>
                <td><code>string</code></td>
              </tr>
              <tr class="rfc2119-table-assertion">
                <td><code>timeRequested</code></td>
                <td>
                  A timestamp indicating the time at which the Thing received 
                  the request to execute the action, in ISO format [[ISO8601-1]]
                  (see <a href="#date-format">Date format</a> for additional 
                  constraints).
                </td>
                <td>optional</td>
                <td><code>string</code></td>
              </tr>
              <tr class="rfc2119-table-assertion">
                <td><code>timeEnded</code></td>
                <td>
                  A timestamp indicating the time at which the Thing
                  successfully completed executing the action, or failed to 
                  execute the action, in ISO format [[ISO8601-1]]
                  (see <a href="#date-format">Date format</a> for additional 
                  constraints).
                </td>
                <td>optional</td>
                <td><code>string</code></td>
              </tr>
            </tbody>
          </table>

          <p class="note">
            It is possible that a Thing's clock may not be set to the correct 
            time. If timings are important then a Consumer may therefore choose
            to treat the <code>timeEnded</code> member of an 
            <code>ActionStatus</code> object as being relative to the
            <code>timeRequested</code> member, but not necessarily as relative
            to its own internal clock, or the clocks of other Things.
          </p>

          <h6 id="sync-action-response">Synchronous Action Response</h6>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-13">
            If providing a Synchronous Action Response, a Web Thing MUST send 
            an HTTP response with:
	  </p>
          <ul>
            <li>Status code set to <code>200</code></li>
            <li><code>Content-Type</code> header set to
              <code>application/json</code>
            </li>
            <li>A body containing an <a href="#ActionStatus">
                <code>ActionStatus</code></a> object serialized
              in JSON</li>
          </ul>
	  </span>
          <pre class="example">
            HTTP/1.1 200 OK
            Content-Type: application/json
            {
              "status": "completed",
              "timeRequested": "2021-11-10T11:43:20.135Z",
              "timeEnded": "2021-11-10T11:43:25.135Z"
            }
          </pre>

          <h6 id="async-action-response">Asynchronous Action Response</h6>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-15">
            If providing an Asynchronous Action Response, a Web Thing MUST send 
            an HTTP response containing the URL of an <code>ActionStatus</code>
            resource, the
            <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
              scheme</a> [[RFC3986]] of which MUST resolve to <code>http</code>
            or <code>https</code>. The response MUST have:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-invokeaction-16">
	  <ul>
            <li>Status code set to <code>201</code></li>
            <li><code>Content-Type</code> header set to
              <code>application/json</code>
            </li>
            <li>
              <code>Location</code> header set to the URL of the
              <code>ActionStatus</code> resource
            </li>
            <li>A body containing an <a href="#ActionStatus">
                <code>ActionStatus</code></a> object serialized
              in JSON, with its <code>href</code> member set to the URL
              of the <code>ActionStatus</code> resource
            </li>
          </ul>
	  </span>
          <pre class="example">
            HTTP/1.1 201 CREATED
            Content-Type: application/json
            Location: /things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655
            {
              "status": "pending",
              "href": "/things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655",
              "timeRequested": "2021-11-10T11:43:19.135Z"
            }
          </pre>
        </section>

        <section id="http-baseline-profile-protocol-binding-queryaction">
          <h5><code>queryaction</code></h5>
          <p>
            A <code>queryaction</code> operation is used to query the current
            state of an ongoing action request.
          </p>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-1">
            A Web Thing which provides <a href="#async-action-response">
              Asynchronous Action Response</a>s to an <code>invokeaction</code>
            operation on an <code>Action</code> MUST also support
            <code>queryaction</code> operations on
            that same <code>Action</code>.
            A Web Thing which only provides <a href="#sync-action-response">
              Synchronous Action Response</a>s to an <code>invokeaction</code>
            operation on an <code>Action</code> SHOULD NOT support
            <code>queryaction</code> operations on that same
            <code>Action</code>.
	  </span></p>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-2">
            The URL of an <code>ActionStatus</code> resource to be used in a 
            <code>queryaction</code> operation MUST be obtained from the 
            <code>Location</code> header of an <a href="#async-action-response">
              Asynchronous Action Response</a>, or the <code>href</code> member of
            the <code>ActionStatus</code> object in its body.
	  </span></p>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-3">
            In order to query the status of an action request, a Consumer MUST 
            send an HTTP request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-4">
          <ul>
            <li>Method set to <code>GET</code></li>
            <li>
              URL set to the URL of the <code>ActionStatus</code> resource
            </li>
            <li>
              <code>Accept</code> header set to <code>application/json
              </code>
            </li>
          </ul>
	  </span>
          <pre class="example">
          GET /things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655
          Host: mythingserver.com
          Accept: application/json
          </pre>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-5">
            If a Web Thing receives an HTTP request following the format
            above and the Consumer has permission to query the corresponding
            <code>ActionStatus</code> resource, then upon successfully reading
            the status of the action request it MUST send an HTTP response
            with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-6">
          <ul>
            <li>Status code set to <code>200</code></li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body containing an <code>ActionStatus</code> object
              representing the current status of the action request, serialized
              in JSON</li>
          </ul>
	  </span>
          <pre class="example">
            HTTP/1.1 200 OK
            Content-Type: application/json
            {
              "status": "running",
              "timeRequested": "2021-11-10T11:43:19.135Z"
            }
          </pre>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-queryaction-7">
            If the queried action failed to execute, then the 
            <code>status</code> member of the <code>ActionStatus</code> object 
            MUST be set to <code>"failed"</code> and the <code>error</code>
            member may optionally provide additional error information
            conforming to the Problem Details format [[RFC7807]].
	  </span></p>
          <pre class="example">
            HTTP/1.1 200 OK
            Content-Type: application/json
            {
              "status": "failed",
              "error": {
                "type": "https://mythingserver.com/docs/errors/invalid-level",
                "title": "Invalid value for level provided",
                "invalid-params": [
                  {
                    "name": "level",
                    "reason": "Must be a valid number between 0 and 100"
                  }
                ]
              },
              "timeRequested": "2021-11-10T11:43:19.135Z",
              "timeEnded": "2021-11-10T11:43:20.513Z"
            }
          </pre>
        </section>

        <section id="http-baseline-profile-protocol-binding-cancelaction">
          <h5><code>cancelaction</code></h5>
          <p>
            A <code>cancelaction</code> operation is used to cancel an ongoing
            <code>Action</code> request.
          </p>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-cancelaction-1">
            A Web Thing which provides <a href="#async-action-response">
              Asynchronous Action Response</a>s to an <code>invokeaction</code>
            operation on an <code>Action</code> MAY also support
            <code>cancelaction</code> operations on
            that same <code>Action</code>.
            A Web Thing which only provides <a href="#sync-action-response">
              Synchronous Action Response</a>s to an <code>invokeaction</code>
            operation on an <code>Action</code> SHOULD NOT support
            <code>cancelaction</code> operations on that same
            <code>Action</code>.
	  </span></p>
	  <p><span> class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-cancelaction-2">
            The URL of an <code>ActionStatus</code> resource to be used in a 
            <code>cancelaction</code> operation MUST be obtained from the 
            <code>Location</code> header of an <a href="#async-action-response">
              Asynchronous Action Response</a>, or the <code>href</code> member of
            the <code>ActionStatus</code> object in its body.
	  </span></p>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-cancelaction-3">
            In order to cancel an action request, a Consumer MUST send an HTTP 
            request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-cancelaction-4">
          <ul>
            <li>Method set to <code>DELETE</code></li>
            <li>
              URL set to the URL of the <code>ActionStatus</code> resource
            </li>
          </ul>
	  </span>
          <pre class="example">
            DELETE /things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655 HTTP/1.1
            Host: mythingserver.com
          </pre>
	  <p><span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-cancelaction-5">
            If a Web Thing receives an HTTP request following the format
            above and the Consumer has permission to cancel the corresponding
            <code>Action</code> request, then upon successfully cancelling
            <code>Action</code> it MUST send an HTTP response with:
	  </span></p>
          <span class="rfc2119-assertion"
            id="core-profile-protocol-binding-actions-cancelaction-6">
          <ul>
            <li>Status code set to <code>204</code></li>
          </ul>
	  </span>
          <pre class="example">
            HTTP/1.1 204 No Content
          </pre>
        </section>

        <section id="queryallactions">
          <h5><code>queryallactions</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-queryallactions-1">
            The URL of an <code>Actions</code> resource to be used when
            querying the status of all ongoing action requests MUST be obtained
            from a Thing Description by locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the top level
            <a href="https://www.w3.org/TR/wot-thing-description/#form-serialization-json">
              <code>forms</code></a> member
            for which:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-queryallactions-2">
	  <ul>
            <li>
              Its <code>op</code> member contains the value
              <code>queryallactions</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-queryallactions-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Actions</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-queryallactions-4">
            In order to query the status of all ongoing action requests, a
            Consumer MUST send an HTTP request to a Web Thing with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-queryallactions-5">
	  <ul>
            <li>Method set to <code>GET</code></li>
            <li>URL set to the URL of the <code>Actions</code> resource
            </li>
            <li><code>Accept</code> header set to <code>application/json
              </code></li>
          </ul>
          </span>
          <pre class="example">
          GET /things/lamp/actions HTTP/1.1
          Host: mythingserver.com
          Accept: application/json
          </pre>
	  <span class="rfc2119-assertion" 
            id="http-baseline-profile-protocol-binding-queryallactions-6a">
	  <p>
            If a Web Thing receives an HTTP request following the format
            above, then upon successfully retreiving the status of all ongoing
            action requests to which the Consumer has permission to access, it
            MUST send an HTTP response with:
	  </span></p>
          <span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-actions-queryallactions-7">
          <ul>
            <li>Status code set to <code>200</code></li>
            <li><code>Content-Type</code> header set to <code>application/json
              </code></li>
            <li>A body containing an object, keyed by <code>Action</code> name,
              with the value of each object member being an array of 
              <a href="#ActionStatus"><code>ActionStatus</code></a> objects 
              representing the action requests, serialized in JSON. 
            </li>
          </ul>
          </span>
	  <p><span class="rfc2119-assertion" 
            id="http-baseline-profile-protocol-binding-queryallactions-6b">
	      Each array in the result object
              MUST be sorted in reverse chronological order such that the 
              most recent action request appears first.
          </span>
          <pre class="example">
          HTTP/1.1 200 OK
          Content-Type: application/json
          {
            "fade": [
              {
                "status": "completed",
                "href": "/things/lamp/actions/fade/123e4567-e89b-12d3-a456-426655",
                "timeRequested": "2021-11-10T11:43:19.135Z",
                "timeEnded": "2021-11-10T11:43:20.513Z"
              },
              {
                "status": "failed",
                "href": "/things/lamp/actions/fade/123e4567-e89b-12d3-a456-558329",
                "timeRequested": "2021-11-10T11:42:15.133Z",
                "timeEnded": "2021-11-10T11:42:22.524Z"
              },
              {
                "status": "running",
                "href": "/things/lamp/actions/fade/123e4567-e89b-12d3-a457-434656",
                "timeRequested": "2021-11-10T11:41:53.351Z"
              },
              {
                "status": "pending",
                "href": "/things/lamp/actions/fade/123e4567-e89b-12d3-a457-ea9519",
                "timeRequested": "2021-11-10T11:39:53.651Z"
              }
            ]
          }
          </pre>
        </section>

        <section class="note" title="Retention of ActionStatus objects">
          When an <code>Action</code> request is cancelled with a
          <code>cancelaction</code> operation, its <code>ActionStatus</code>
          object is deleted and need not be retained. For all other
          <code>Action</code> requests it is assumed that a Web Thing will
          store the <code>ActionStatus</code> object so that its status may
          later be queried with a <code>queryaction</code> or
          <code>queryallactions</code> operation. It is not expected that
          <code>ActionStatus</code> objects should be retained indefinitely,
          they may be stored in volatile memory and/or periodically pruned.
          The length of time for which to retain <code>ActionStatus</code>
          objects is expected to be implementation-specific and may depend on
          application-specific requirements or resource constraints.
        </section>
      </section>

      <section id="http-baseline-profile-error-responses">
        <h4 id="error-responses">Error Responses</h4>
        <p>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-1">
            If any of the operations defined above are unsuccessful then
            the Web Thing MUST send an HTTP response with an HTTP error code which
            describes the reason for the failure. It is RECOMMENDED that error
            responses use one of the following HTTP error codes:
          </span>
        </p>
        <ul>
          <li><code>400 Bad Request</code></li>
          <li><code>401 Unauthorized</code></li>
          <li><code>403 Forbidden</code></li>
          <li><code>404 Not Found</code></li>
          <li><code>500 Internal Server Error</code></li>
        </ul>
        <p>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-2">	      
	      A Web Thing MUST NOT issue any 3xx status codes.
	  </span>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-3">	      
	      A Consumer MAY treat all 3xx codes as errors that do not change the status or behavior 
	      of the consumer.
	  </span> 
	</p>
        <p>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-4">
          Web Things MAY respond with other valid HTTP error codes
          (e.g. <code>418 I'm a teapot</code>),
          </span>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-5">
          but Consumers MAY interpret those error codes as a generic <code>4xx</code> or <code>5xx</code>
          error with no special defined behaviour.
          </span>
        </p>
        <p class="ednote">
          <span id="profile-5.2.4-thing-protocol-binding-error-responses-6">
          TODO: If we define the finite set of error responses as above then we
          should also define what a Consumer should do if it receives a 3xx
          redirect type response.
          </span>
        </p>
        <p>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-7">
          If an HTTP error response contains a body, the content of that body
          MUST conform with with the Problem Details format [[RFC7807]].
          </span>
        </p>
      </section>
    </section>

    <!--  Security -->
    <section>
      <h2 id="http-baseline-profile-security">Security</h3>
      <p class="ednote" title="Restructure Assertion">
      This assertion has two keywords and needs to be broken into two
      statements.  The question is how to do it without repeating the list.
      </p>
      <span class="rfc2119-assertion" id="http-baseline-profile-security-1">
	      <p>
        Below is a list of <a href="https://w3c.github.io/wot-thing-description/#sec-security-vocabulary-definition">
        security schemes</a> [[wot-thing-description]] which conformant Web 
        Things MAY use and conformant Consumers MUST support:
      </p>
      <ul>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#nosecurityscheme">
            <code>NoSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#basicsecurityscheme">
            <code>BasicSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#digestsecurityscheme">
            <code>DigestSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#bearersecurityscheme">
            <code>BearerSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#oauth2securityscheme">
            <code>OAuth2SecurityScheme</code>
          </a>
        </li>
      </ul>
      </span>
      <p class="ednote">
        The list of security schemes to include in the HTTP Baseline Profile is
        still <a href="https://github.com/w3c/wot-profile/issues/6">under 
        discussion</a>.
      </p>
      <p><span class="rfc2119-assertion" id="http-baseline-profile-security-2">
        A Thing MAY implement multiple security schemes.
      </span></p>
      <p><span class="rfc2119-assertion" id="http-baseline-profile-security-3a">
        Security schemes MUST be applied using the top level <code>security</code>
        member of a 
        <a href="https://w3c.github.io/wot-thing-description/#thing">Thing</a>.
      </span></p>
      <p><span class="rfc2119-assertion" id="http-baseline-profile-security-3b">
        Security schemes 
        MUST NOT be applied to individual
        <a href="https://w3c.github.io/wot-thing-description/#form"></a><code>
        Form</code>s.
      </p>
      <p class="note">
        Please see <a href="https://w3c.github.io/wot-security-best-practices/">
        WoT Security Best Practices</a> for implementation advice.
      </p>
    </section>
  </section>
  </section>

  <section>
    <h1>HTTP SSE Profile</h1>
    <p>This section defines the HTTP SSE Profile, including a 
      <a href="#http-sse-profile-protocol-binding">Protocol Binding</a>
      for observing properties and listening for events using Server-Sent Events
      [[EVENTSOURCE]].</p>
      <p>This profile may be used in conjunction with the
      <a href="#http-baseline-profile">HTTP Baseline Profile</a> in order to
      provide operations to read and write properties and invoke, query and
      cancel actions.</p>
    <!-- Identifier -->
    <section id="http-sse-profile-identifier">
      <h2>Identifier</h2>
      <p class="rfc2119-assertion" id="http-sse-profile-1">
        In order to denote that a given
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
        conforms to the HTTP SSE Profile, its Thing Description MUST have a
        <a href="https://w3c.github.io/wot-thing-description/#thing">
        <code>profile</code></a> member [[wot-thing-description]] with a value
        of <code>https://www.w3.org/2022/wot/profile/http-sse/v1</code>.
      </p>
    </section>
    <section id="http-sse-profile-protocol-binding">
      <h2>Protocol Binding</h2>
      <p>
        This section defines a protocol binding which describes how a
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-consumer">Consumer</a>
        communicates with a
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
        [[wot-architecture11]] using Server-Sent Events [[EVENTSOURCE]].
      </p>
      <p>
        <span class="rfc2119-assertion" id="http-sse-profile-protocol-binding-1">
        A Consumer or Web Thing conforming to the HTTP SSE Profile
        MUST implement this protocol binding.
        </span>
      </p>
      <p>
        The examples provided throughout this section describe how a Consumer
        would communicate with a Web Thing which produces the following Thing
        Description:
      </p>
      <pre class="example">
        {
          "@context": "https://www.w3.org/2019/wot/td/v1",
          "id": "https://mywebthingserver.com/things/lamp",
          "profile": [
            "https://www.w3.org/2022/wot/profile/http-baseline/v1",
            "https://www.w3.org/2022/wot/profile/http-sse/v1",
          ],
          "base": "https://mywebthingserver.com/things/lamp/",
          "title": "My Lamp",
          "description": "A web connected lamp",
          "securityDefinitions": {
            "oauth2": {
              "scheme": "oauth2",
              "flow": "code",
              "authorization": "https://mywebthingserver.com/oauth/authorize",
              "token": "https://mywebthingserver.com/oauth/token"
            }
          },
          "security": "oauth2",
          "properties": {
            "on": {
              "type": "boolean",
              "title": "On/Off",
              "description": "Whether the lamp is turned on",
              "forms": [{"href": "properties/on"}]
            },
            "level" : {
              "type": "integer",
              "title": "Brightness",
              "description": "The level of light from 0-100",
              "unit": "percent",
              "minimum" : 0,
              "maximum" : 100,
              "forms": [{"href": "properties/level"}]
            }
          },
          "actions": {
            "fade": {
              "title": "Fade",
              "description": "Fade the lamp to a given level",
              "input": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 100,
                    "unit": "percent"
                  },
                  "duration": {
                    "type": "integer",
                    "minimum": 0,
                    "unit": "milliseconds"
                  }
                }
              },
              "forms": [{"href": "actions/fade"}]
            }
          },
          "events": {
            "overheated": {
              "title": "Overheated",
              "data": {
                "type": "number",
                "unit": "degree celsius"
              },
              "description": "The lamp has exceeded its safe operating temperature",
              "forms": [{
                "href": "events/overheated",
                "subprotocol": "sse"
              }]
            }
          },
          "forms": [
            {
              "op": ["readallproperties", "writemultipleproperties"],
              "href": "properties"
            },
            {
              "op": "queryallactions",
              "href": "actions"
            },
            {
              "op": ["subscribeallevents", "unsubscribeallevents"],
              "href": "events",
              "subprotocol": "sse"
            }
          ]
        }
      </pre>
      <section id="http-sse-profile-protocol-binding-events">
        <h3>Events</h3>
        <p>
          The HTTP SSE Profile uses Server-Sent Events [[EVENTSOURCE]] as a
          mechanism for Consumers to subscribe to events emitted by a Web Thing.
        </p>
        <p class="note">
          Please see <a href="https://w3c.github.io/wot-security-best-practices/">
            WoT Security Best Practices</a> for implementation advice.
        </p>
        <section id="subscribeevent">
          <h5><code>subscribeevent</code></h5>
	  <span class="rfc2119-assertion" 
            id="http-sse-profile-protocol-binding-subscribeevent-1">
		  <p>
            The URL of an <code>Event</code> resource to be used when 
            subscribing to an event MUST be obtained from a Thing Description 
            by locating a 
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
            <code>Form</code></a> inside the corresponding 
            <a href="https://www.w3.org/TR/wot-thing-description/#eventaffordance">
            <code>EventAffordance</code></a> for which:
	  </p>
          <ul>
            <li>
              After defaults have been applied, its <code>op</code> member 
              contains the value <code>subscribeevent</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
              scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
            <li>Its <code>subprotocol</code> member has a value of
              <code>"sse"</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeevent-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Event</code> resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeevent-4">
            In order to subscribe to an event, a Consumer MUST follow the 
            Server-Sent Events [[EVENTSOURCE]] specification to open a
            connection with the Web Thing at the URL of the <code>Event</code>
            resource.
	  </span></p>
          <p>
            This involves the Consumer sending an HTTP request to
            the Web Thing with:
          </p>
          <ul>
            <li>Method set to <code>GET</code></li>
            <li>URL set to the URL of the <code>Property</code> resource</li>
            <li>
              <code>Accept</code> header set to <code>text/event-stream</code>
            </li>
            <li>
              <code>Connection</code> header set to <code>keep-alive</code>
            </li>
          </ul>
          <pre class="example">
            GET /things/lamp/properties/level HTTP/1.1
            Host: mythingserver.com
            Accept: text/event-stream
            Connection: keep-alive
          </pre>
          <p class="note" title="Opening a connection using JavaScript">
            For Consumers implemented in JavaScript [[ECMASCRIPT]] and executed 
            in a runtime which exposes the
            <a href="https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
            <code>EventSource</code></a> interface, a Server-Sent Events 
            connection can be initiated using the <code>EventSource</code>
            constructor.
            <pre class="example">
              const levelSource = new EventSource('/things/lamp/properties/level');
            </pre>
          </p>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeevent-5">
            If a Web Thing receives an HTTP request following the format
            above and the Consumer has permission to subscribe to the 
            corresponding event, then it MUST follow the Server-Sent Events 
            [[EVENTSOURCE]] specification to maintain an open connection with 
            the Consumer and push event data to the Consumer as events of the 
            specified type are emitted.
	  </span></p>
          <p>
            This involves the Web Thing initially sending an HTTP 
            response to the Consumer with:
          </p>
          <ul>
            <li>Status code set to <code>200</code></li>
            <li>
              <code>Content-Type</code> header set to 
              <code>text/event-stream</code>
            </li>
          </ul>
          <pre class="example">
            HTTP/1.1 200 OK
            Content-Type: text/event-stream
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeevent-6">
            Whenever an event of the specified type occurs while the Web Thing 
            has an open connection with a Consumer, the Web Thing MUST 
            send event data to the Consumer using the event stream format in the 
            Server-Sent Events [[EVENTSOURCE]] specification. For each message 
            sent, the Web Thing MUST set the <code>event</code> field to the 
            name of the <code>EventAffordance</code> and populate the 
            <code>data</code> field with event data, if any. The 
            event data MUST follow the data schema specified in the
            <code>EventAffordance</code> and MUST be serialized in JSON.
            The <code>id</code> field SHOULD be set to a unique identifier for 
            the event, for use when re-establishing a dropped connection (see 
            below).
	    <em>FIX: this includes multiple RFC2119 keywords, mixes
		    mandatory and optional elements, AND refers to external
		    content.
            </em>
	  </span></p>
          <pre class="example">
            event: level\n
            data: 42\n
            id: 2021-11-17T15:33:20.827Z\n\n
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeevent-7">
            If the connection between the Consumer and Web Thing drops
            (except as a result of the <code>unsubscribe</code> operation 
            defined below), the Consumer MUST re-establish the connection 
            following the steps outlined in the Server-Sent Events specification
            [[EVENTSOURCE]]. 
	  </span>
	  <span class="rfc2119-assertion" 
            id="http-sse-profile-protocol-binding-subscribeevent-7b">
	    Once the connection is re-established the Web Thing
            SHOULD, if possible, send any missed events which occured since
            the last event specified by the Consumer in a 
            <code>Last-Event-ID</code> header.
	    <em>FIX: this includes multiple RFC2119 keywords and mixes
		    mandatory and optional elements.
            </em>
	  </span></p>
        </section>

        <section id="unsubscribeevent">
          <h5><code>unsubscribeevent</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-unsubscribeevent-1">
            In order to unsubscribe from an event, a Consumer MUST terminate 
            the corresponding Server-Sent Events connection with the Web Thing 
            as specified in the Server-Sent Events specification
            [[EVENTSOURCE]].
	  </span></p>
	  <p class="note" title="Terminating a connection using JavaScript">
            For Consumers implemented in JavaScript [[ECMASCRIPT]] and executed 
            in a runtime which exposes the
            <a href="https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
            <code>EventSource</code></a> interface, a Server-Sent Events 
            connection can be terminated using the <code>close()</code> method 
            on an <code>EventSource</code> [[EVENTSOURCE]] object.
	  </p>
            <pre class="example">
              levelSource.close();
            </pre>
        </section>

        <section id="subscribeallevents">
          <h5><code>subscribeallevents</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeallevents-1">
            The URL of an events resource to be used when subscribing to all
            events emitted by a Web Thing MUST be obtained from a Thing
            Description by locating a 
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
            <code>Form</code></a> inside the top level 
            <a href="https://www.w3.org/TR/wot-thing-description/#form-serialization-json"><code>forms</code></a>
            member of a Thing Description for which:
	  </p>
          <ul>
            <li>
              Its <code>op</code> member contains the value 
              <code>subscribeallevents</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
              scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
            <li>Its <code>subprotocol</code> member has a value of
              <code>sse</code>
            </li>
          </ul>
	  </span>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeallevents-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the events resource.
	  </span></p>
	  <p><span class="rfc2119-assertion" 
            id="http-sse-profile-protocol-binding-subscribeallevents-4">
            In order to subscribe to all events emitted by a Web Thing, a
            Consumer MUST follow the Server-Sent Events [[EVENTSOURCE]]
            specification to open a connection with the Web Thing at the URL of
            the events resource.
	  </span></p>
          <p>
            This involves the Consumer sending an HTTP request to
            the Web Thing with:
          </p>
          <ul>
            <li>Method set to <code>GET</code></li>
            <li>URL set to the URL of the events resource</li>
            <li>
              <code>Accept</code> header set to <code>text/event-stream</code>
            </li>
            <li>
              <code>Connection</code> header set to <code>keep-alive</code>
            </li>
          </ul>
          <pre class="example">
            GET /things/lamp/events HTTP/1.1
            Host: mythingserver.com
            Accept: text/event-stream
            Connection: keep-alive
          </pre>
          <p class="note" title="Opening a connection using JavaScript">
            For Consumers implemented in JavaScript [[ECMASCRIPT]] and executed
            in a runtime which exposes the
            <a href="https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
              <code>EventSource</code></a> interface, a Server-Sent Events
            connection can be initiated using the <code>EventSource</code>
            constructor.
          <pre class="example">
              const lampEventsSource = new EventSource('/things/lamp/events');
            </pre>
          </p>
	  <p><span class="rfc2119-assertion" 
          id="core-profile-protocol-binding-events-subscribeallevents-3">
            If a Web Thing receives an HTTP request following the format
            above then it MUST follow the Server-Sent Events
            [[EVENTSOURCE]] specification to maintain an open connection with
            the Consumer and push event data to the Consumer for all event
            types for which it has permission to subscribe.
	  </span></p>
          <p>
            This involves the Web Thing initially sending an HTTP
            response to the Consumer with:
          </p>
          <ul>
            <li>Status code set to <code>200</code></li>
            <li>
              <code>Content-Type</code> header set to
              <code>text/event-stream</code>
            </li>
          </ul>
          <pre class="example">
            HTTP/1.1 200 OK
            Content-Type: text/event-stream
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeallevents-4">
            Whenever an event occurs while the Web Thing has an open connection
            with a Consumer, the Web Thing MUST send event data to the Consumer
            using the event stream format in the Server-Sent Events
            [[EVENTSOURCE]] specification. For each message sent, the Web Thing
            MUST set the <code>event</code> field to the
            name of the <code>EventAffordance</code> and populate the
            <code>data</code> field with event data, if any. The
            event data MUST follow the data schema specified in the
            <code>EventAffordance</code> and MUST be serialized in JSON.
            The <code>id</code> field SHOULD be set to a unique identifier for
            the event, for use when re-establishing a dropped connection (see
            below).
	    <em>FIX...</em>
	  </span></p>
          <pre class="example">
            event: overheated\n
            data: 90\n
            id: 12345\n\n
          </pre>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-subscribeallevents-5">
            If the connection between the Consumer and Web Thing drops
            (except as a result of the <code>unsubscribeallevents</code>
            operation defined below), the Consumer MUST re-establish the
            connection following the steps outlined in the Server-Sent Events
            specification [[EVENTSOURCE]]. Once the connection is re-established
            the Web Thing SHOULD, if possible, send any missed events which
            occured since the last event specified by the Consumer in a
            <code>Last-Event-ID</code> header.
	  </span></p>
        </section>

        <section id="http-sse-profile-protocol-binding-events-unsubscribeallevents">
          <h5><code>unsubscribeallevents</code></h5>
	  <p><span class="rfc2119-assertion" 
            id="core-profile-protocol-binding-events-unsubscribeallevents-1">
            In order to unsubscribe from all events, a Consumer MUST terminate 
            the corresponding Server-Sent Events connection with the events 
            endpoint of the Web Thing, following the steps specified in the 
            Server-Sent Events specification [[EVENTSOURCE]].
	  </span></p>
	  <p class="note" title="Terminating a connection using JavaScript">
            For Consumers implemented in JavaScript [[ECMASCRIPT]] and executed 
            in a runtime which exposes the
            <a href="https://html.spec.whatwg.org/multipage/server-sent-events.html#the-eventsource-interface">
              <code>EventSource</code></a> interface, a Server-Sent Events
            connection can be terminated using the <code>close()</code> method
            on an <code>EventSource</code> [[EVENTSOURCE]] object.
          <pre class="example">
              lampEventsSource.close();
            </pre>
	  </p>
        </section>
      </section>
    </section>
  </section>

      <section id="error-responses">
        <h4>Error Responses</h4>
        <p>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-1">
          If any of the operations defined above are unsuccessful then
          the Web Thing MUST send an HTTP response with an HTTP error code which
          describes the reason for the failure. It is RECOMMENDED that error
          responses use one of the following HTTP error codes:
	  <em>FIX...</em>
          </span>
        </p>

        <p class="ednote">
          <!-- TODO -->
          TODO: The example needs more work on the data and dataResponse schemas.
        </p>

        <figure id="sequence-diagram-webhook">
          <img src="images/Sequence Diagram - WebHook.png" class="wot-profiles"
            alt="Webhook example - sequence diagram" />
          <figcaption>HTTP Webhook Profile - Sequence of operations and notifications</figcaption>
        </figure>


        <p>The following example contains a snippet from a TD that illustrates how a Webhook event can be described.</p>
        <pre class="example">
            ...
    
            {
                "events": {
                    "fireAlarm": {
                        "title": "Fire Alarm"
                        "description": "Critical Condition - Fire!",
                        "subscription": {
                            "type": "object",
                            "properties": {
                              "callbackURL": {
                                  "type": "string",
                                  "format": "uri",
                                  "description": "Callback URL provided by subscriber for Webhook notifications.",
                                  "writeOnly": true
                              },
                              ...
                            }
                        "data": {
                            "type": "boolean",
                            "description": "true, if the alert button has been pushed, false, if the button was armed again."
                        },
                        "dataResponse": {
                            "type": "string",
                            "description": "sprinkler status"
                        },
            
                        "cancellation": {
                          "type": "object",
                          "properties": {
                              "subscriptionID": {
                                  "type": "integer",
                                  "description": "subscription ID to cancel",
                                  "writeOnly": true
                              }
                          }
                      },
                      "forms": [
                            {
                                "op": "subscribeevent",
                                "href": "http://192.168.0.124:8080/events/fireAlarm/subscribe",
                                "contentType": "application/json",
                                "htv:methodName": "POST"
                            },
                            {
                                "op": "unsubscribeevent",
                                "href": "http://192.168.0.124:8080/events/fireAlarm/unsubscribe",
                                "htv:methodName": "POST"
                            }
                        ]
                    },
                    "batteryLow": {
                        ...
                    }
                }
            }
            </pre>
      </section>
    </section>
    <!-- Identifier -->
    <section id="http-webhook-profile-identifier">
      <h2>Identifier</h2>
      <p class="rfc2119-assertion" id="http-webhook-profile-1">
        In order to denote that a given
        <a href="https://www.w3.org/TR/wot-architecture/#dfn-thing">Web Thing</a>
        conforms to the HTTP Webhook Profile, its Thing Description MUST have a
        <a href="https://w3c.github.io/wot-thing-description/#thing">
          <code>profile</code></a> member [[wot-thing-description]] with a value
        of <code>https://www.w3.org/2022/wot/profile/http-webhook/v1</code>.
      </p>
      <section class="note">
        <p>Note that the <code>profile</code> member is an array that may contain multiple
          profile entries, which indicates that a Web Thing conforms to all of the profiles in that array.</p>
      </section>
    </section>

    <section id="sec-http-webhook-profile-message-format">
      <h3>Message Format</h3>
      <p>
        This section defines a JSON object format for events.
      </p>
    <p class="rfc2119-assertion" id="http-webhook-profile-message-format-1">
        Event notification messages MUST comply with the following data schema.
      </p>

        <p>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-2">
          Web Things MAY respond with other valid HTTP error codes
          (e.g. <code>418 I'm a teapot</code>),
          </span>
          <span class="rfc2119-assertion" id="profile-5.2.4-thing-protocol-binding-error-responses-3">
          but Consumers MAY interpret those error codes as a generic <code>4xx</code> or <code>5xx</code>
          error with no special defined behaviour.
	  <em>FIX... incomplete statement</em>
          </span>
        </p>
        <p class="ednote">
          <span id="profile-5.2.4-thing-protocol-binding-error-responses-4">
          TODO: If we define the finite set of error responses as above then we
          should also define what a Consumer SHOULD do if it receives a 3xx
          redirect type response.
          </span>
        </p>
        <p>
          An event message contains a set of metadata properties and an optional data payload.
          The metadata fields allow to determine the type and source of the event as well as
          a timestamp indicating when the event occured and an optional data payload.
        </p>
        <p>
          <span class="rfc2119-assertion" id="profile-json-event-payload">
            The following constraints MUST be
            applied to the event payload:
          </span>
        </p>
      </section>
    </section>

    <!--  Security -->
    <section>
      <h2 id="security">Security</h3>
      <p><span class="rfc2119-assertion" id="core-profile-security-1">
        Below is a list of <a href="https://w3c.github.io/wot-thing-description/#sec-security-vocabulary-definition">
        security schemes</a> [[wot-thing-description]] which conformant Web 
        Things MAY use and conformant Consumers MUST support:
	<em>FIX... incomplete.</em>
      </span></p>
      <ul>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#nosecurityscheme">
            <code>NoSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#basicsecurityscheme">
            <code>BasicSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#digestsecurityscheme">
            <code>DigestSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#bearersecurityscheme">
            <code>BearerSecurityScheme</code>
          </a>
        </li>
        <li>
          <a href="https://w3c.github.io/wot-thing-description/#oauth2securityscheme">
            <code>OAuth2SecurityScheme</code>
          </a>
        </li>
      </ul>
      <p class="ednote">
        The list of security schemes to include in the Core Profile is still 
        <a href="https://github.com/w3c/wot-profile/issues/6">under 
        discussion</a>.
      </p>
      <p><span class="rfc2119-assertion" id="core-profile-security-2">
        A Thing MAY implement multiple security schemes.
      </span></p>
      <p><span class="rfc2119-assertion" id="core-profile-security-3">
        Security schemes MUST be applied using the top level <code>security</code>
        member of a 
        <a href="https://w3c.github.io/wot-thing-description/#thing">Thing</a>
        and MUST NOT be applied to individual
        <a href="https://w3c.github.io/wot-thing-description/#form"></a><code>
        Form</code>s.
        <em>FIX: multiple RFC2119 keywords used.  Split up.</em>
      </span></p>
      <p class="note">
        Please see <a href="https://w3c.github.io/wot-security-best-practices/">
        WoT Security Best Practices</a> for implementation advice.
      </p>

      <section id="http-webhook-profile-protocol-binding-events">
        <h3>Operations</h3>

        <section id="http-webhook-profile-protocol-binding-subscribeevent">
          <h4><code>subscribeevent</code></h4>
          <p class="rfc2119-assertion" id="http-baseline-profile-protocol-binding-subscribeevent-1">
            The URL of an <code>Event</code> resource to be used when
            subscribing to an event MUST be obtained from a Thing Description
            by locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the corresponding
            <a href="https://www.w3.org/TR/wot-thing-description/#eventaffordance">
              <code>EventAffordance</code></a> for which:
          </p>
          <ul class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeevent-2">
            <li>
              After defaults have been applied, its <code>op</code> member
              contains the value <code>subscribeevent</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
            <li>Its <code>subprotocol</code> member has a value of
              <code>"webhook"</code>
            </li>
          </ul>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeevent-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the <code>Event</code> resource.
          </p>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeevent-4">
            In order to subscribe to an event, a Consumer MUST
            provide the listener URL in the data payload of the
            <code>subscribe</code> operation of the <code>Event</code> resource.
          </p>
          <p>
            This involves the Consumer sending an HTTP request to
            the Web Thing with:
          </p>
          <ul>
            <li>Method set to <code>POST</code></li>
            <li>URL set to the URL of the <code>Event</code> resource</li>
            <li>
              <code>Accept</code> header set to <code>application/json</code>
            </li>
            <li>
              A body with a subscription payload, serialized in JSON.
            </li>

            <p class="ednote">
              <!-- TODO --> TODO: Define subscription payload.
            </p>

          </ul>
          <pre class="example">
              POST /things/lamp/events/overheated HTTP/1.1
              Host: mythingserver.com
              Accept: application/json
              
              {
                "properties": {
                  ...
                  listener: uri,
                  ...
                }
              }
              </pre>

          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeevent-5">
            If a Web Thing receives an HTTP request following the format
            above and the Consumer has permission to subscribe to the
            corresponding event, then it MUST send <em>event messages</em>
            to the Consumer as events of the specified type are emitted.
          </p>

          <p>
            This involves the Web Thing initially sending an HTTP
            response to the Consumer with:
          </p>
          <ul>
            <li>Status code set to <code>200</code></li>
            <li>
              <code>Content-Type</code> header set to
              <code>application/json</code>
            </li>
            <li></li>
          </ul>
          <pre class="example">
              HTTP/1.1 200 OK
              Content-Type: application/json
    
              {
                  subscriptionId: 1234-4544-1211
              }
    
              </pre>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeevent-6">
            Whenever an event of the specified type occurs, the Web Thing MUST
            send event data to the Consumer using the event payload format defined in section
            ["#sec-http-webhook-profile-protocol-binding-events-notification"].
          </p>

        </section>

        <section id="http-webhook-profile-protocol-binding-events-unsubscribeevent">
          <h4><code>unsubscribeevent</code></h4>

          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeevent-4">
            In order to unsubscribe to an event, a Consumer MUST
            provide the <code>subscriptionID</code> in the data payload of the
            <code>unsubscribe</code> operation of the <code>Event</code> resource.
          </p>
          <p>
            This involves the Consumer sending an HTTP request to
            the Web Thing with:
          </p>
          <ul>
            <li>Method set to <code>POST</code></li>
            <li>URL set to the URL of the <code>Event</code> resource</li>
            <li>
              <code>Accept</code> header set to <code>application/json</code>
            </li>
            <li>
              <code>Request Payload</code> contains a <code>JSON</code>
              object with a valid <code>subscriptionId</code>.
            </li>
            <p class="ednote">
            <!-- TODO: define subscriptionId format - urn? -->
            TODO: define subscriptionId format - urn?
            </p>
          </ul>
        </section>

        <section id="http-webhook-profile-protocol-binding-events-subscribeallevents">
          <h4><code>subscribeallevents</code></h4>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-1">
            The URL of an <code>Events</code> resource to be used when subscribing to all
            events emitted by a Web Thing MUST be obtained from a Thing
            Description by locating a
            <a href="https://www.w3.org/TR/wot-thing-description/#form">
              <code>Form</code></a> inside the top level
            <a href="https://www.w3.org/TR/wot-thing-description/#form-serialization-json"><code>forms</code></a>
            member of a Thing Description for which:
          </p>
          <ul class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-2">
            <li>
              Its <code>op</code> member contains the value
              <code>subscribeallevents</code>
            </li>
            <li>
              After being resolved against a base URL where applicable, the
              <a href="https://tools.ietf.org/html/rfc3986#section-3.1">URI
                scheme</a> [[RFC3986]] of the value of its <code>href</code>
              member is <code>http</code> or <code>https</code>
            </li>
            <li>Its <code>subprotocol</code> member has a value of
              <code>"sse"</code>
            </li>
          </ul>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-3">
            The resolved value of the <code>href</code> member MUST then be used
            as the URL of the events resource.
          </p>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-4">
            In order to subscribe to <em>all</em> events emitted by a Web Thing, a
            Consumer MUST send an HTTP request to the Web Thing with:
          </p>
          <ul>
            <li>Method set to <code>POST</code></li>
            <li>URL set to the URL of the events resource</li>
            <li>
              <code>Accept</code> header set to <code>text/event-stream</code>
            </li>
            <li>
              <code>Request Payload</code> contains a <code>JSON</code>
              object with a subscription payload.
            </li>
          </ul>
          <pre class="example">
                POST /things/lamp/events/overheated HTTP/1.1
                Host: mythingserver.com
                Accept: application/json
                
                {
                  "properties": {
                    ...
                    listener: uri,
                    ...
                  }
                }
                </pre>

          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-5">
            If a Web Thing receives an HTTP request following the format
            above, then it MUST send <em>event messages</em>
            to the Consumer for all event
            types for which it has permission to subscribe.
          </p>
          <p>
            This involves the Web Thing initially sending an HTTP
            response to the Consumer with:
          </p>
          <ul>
            <li>Status code set to <code>200</code></li>
            <li>
              <code>Content-Type</code> header set to
              <code>application/json</code>
            </li>
            <li>Response payload contains a JSON object with a <code>subscriptionId</code>.</li>
          </ul>

          <pre class="example">
                HTTP/1.1 200 OK
                Content-Type: text/event-stream
    
                {
                  subscriptionId: 1234-4544-1211
                }
    
              </pre>

          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-6">
            Whenever an event occurs, the Web Thing MUST send event data to the Consumer
            using the event payload format defined in section <a href="sec-http-webhook-profile-message-format">Message Format</a>.

          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-7">
            If the connection between the Web Thing and the Consumer drops,
            the Web Thing MUST re-establish the connection.
          </p>

          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-subscribeallevents-8">
            Once the connection is re-established the Web Thing
            SHOULD, if possible, send any missed events which occured since
            the last succesful event notification.
          </p>
        </section>

        <section id="http-webhook-profile-protocol-binding-events-unsubscribeallevents">
          <h4><code>unsubscribeallevents</code></h4>
          <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-unsubscribeallevents-1">
            In order to unsubscribe from all events, a Consumer MUST invoke the
            <code>unsubscribe</code> operation of the <code>Event</code> resource.
          </p>

          <p>
            This involves the Consumer sending an HTTP request to
            the Web Thing with:
          </p>
          <ul>
            <li>Method set to <code>POST</code></li>
            <li>URL set to the URL of the <code>Event</code> resource</li>
            <li>
              <code>Accept</code> header set to <code>application/json</code>
            </li>
            <li>
              <code>Request Payload</code> contains a <code>JSON</code>
              object with a valid <code>subscriptionId</code>.
            </li>
          </ul>
          <p class="ednote">
            <!-- TODO -->
            TODO: define subscription id format - urn?
          </p>
        </section>
      </section>

      <section id="sec-http-webhook-profile-protocol-binding-event-listeners">
        <h4>Event Connections</h4>

        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-1">
          A HTTP(s) connection to the event listener of a Consumer MUST be initiated and managed by the Web Thing.
        </p>

        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-2">
          A Consumer MUST terminate the subscription with the events endpoint of the Web Thing.</p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-3">
          If a Consumer becomes unavailable and the Web Thing cannot successfully transmit
          event messages to the consumer, it SHOULD attempt several retries at increasing intervals.</p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-4">
          After the maximum number of retries was reached, the Web Thing MAY terminate the subscription
          without having received an <code>unsubscribe</code> or <code>unsubscribeall</code> operation.</p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding--event-connections-5">
          If the connection between the Web Thing and the Consumer drops,
          the Web Thing MUST attempt to re-establish the connection.
        </p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-6">
          Once the connection is re-established, the Web Thing
          SHOULD, if possible, send any missed events which occured since
          the last succesful event notification.
        </p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-7">
          The Web Thing MAY reuse an existing connection to a listener for subsequent message traffic,
          or it MAY establish a new connection for each message.
        </p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding--event-connections-8">
          When an event message has been received, the Consumer MUST respond with a "HTTP 200 OK" message.
        </p>
        <p class="rfc2119-assertion" id="http-webhook-profile-protocol-binding-event-connections-9">
          An (optional) JSON payload MAY be provided to return a response back to the Web Thing
          via the same communication channel.
        </p>
      </section>
    </section>
  </section> 

  <!---------------------------------------------------------------->


  <section id="baseline-profile-json-schema" class="appendix normative">
    <h1>JSON Schema of the Baseline Profile</h1>
    <p>
      A Thing Description can be syntactically validated with the JSON Schema [[?JSON-SCHEMA]] for compliance with
      the baseline profile.
    </p>
    <p class="ednote">
      <!-- TODO --> TODO: Define a JSON-SCHEMA.
    </p>
  </section>
  <section id="open-issues">
    <h3>Open Issues</h3>
    <ul>
      <li>define a JSON schema</li>
      <li>Examples</li>
    </ul>
  </section>

</body>

</html>